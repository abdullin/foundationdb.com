<!DOCTYPE html>
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
<head>


<script type="text/javascript" src="/static/js/analytics.js"></script>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app4.us.archive.org";archive_analytics.values.server_ms=1363;</script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>


<title>

Data Modeling

&mdash; FoundationDB
</title>
<meta charset='utf-8'>
<meta content=' foundationdb, database, nosql, scalable, fault tolerant, acid, transactions' name='keywords'>
<meta content='FoundationDB is a database that combines NoSQL scalability with true multikey ACID transactions.' name='description'>
<meta content='FoundationDB' name='author'>
<meta content='IE=edge' http-equiv='x-ua-compatible'>
<meta content='173350679' property='twitter:account_id'>
<meta content='FoundationDB' property='og:title'>
<meta content='https://foundationdb.com' property='og:url'>
<meta content='https://foundationdb.com/images/stacks.png' property='og:image'>
<meta content='FoundationDB is a database that combines NoSQL scalability with true multikey ACID transactions.' name='og:description'>
<meta content='2j_g9LCoS3SGSPULb2MLPGk2raKkFd4hPOuWWM5AsVw' name='google-site-verification'>
<link href='https://foundationdb.com/key-value-store/documentation/data-modeling.html' rel='canonical'>
<!--[if lt IE 9]>
<script src='/web/20150325003224/https://html5shiv.googlecode.com/svn/trunk/html5.js'></script>
<![endif]-->
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<link href="/web/20150325003224im_/https://d3glfbbr3jeumb.cloudfront.net/assets/favicon-eea8382cf5c35e23f9fb4273c134b2c0.png" rel="shortcut icon" type="image/png" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="kvEXMD51MFFITMeEqdUREQ8wfRKT5HJRQ/R9A33xfUI=" name="csrf-token" />
<link href="/web/20150325003224cs_/https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Gentium+Book+Basic:400,400italic" media="screen" rel="stylesheet" type="text/css" />
<link href="/web/20150325003224cs_/https://d3glfbbr3jeumb.cloudfront.net/assets/application-5cc81fa97aedacb1157cce0e30895a04.css" media="all" rel="stylesheet" type="text/css" />

</head>
<body class='show' id='documentation'>


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(imgWidth,imgHeight,yearImgWidth,monthImgWidth){
var wbPrefix = "/web/";
var wbCurrentUrl = "https://foundationdb.com/key-value-store/documentation/data-modeling.html";

var firstYear = 1996;
var displayDay = "25";
var displayMonth = "Mar";
var displayYear = "2015";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})(525, 27, 25, 2);//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>
<div id="wm-ipp" lang="en" style="display:none;">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="/web/" title="Wayback Machine home page"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0" /></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="https://foundationdb.com/key-value-store/documentation/data-modeling.html" style="width:400px;" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20150325003224" /><input type="submit" value="Go" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="/web/20150108054715/https://foundationdb.com/key-value-store/documentation/data-modeling.html" title="8 Jan 2015">JAN</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 0:32:24 Mar 25, 2015">MAR</td>
		<td class="f" nowrap="nowrap">
		
		    <a href="/web/20150428231543/https://foundationdb.com/key-value-store/documentation/data-modeling.html" title="28 Apr 2015"><strong>APR</strong></a>
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="/web/20150108054715/https://foundationdb.com/key-value-store/documentation/data-modeling.html" title="5:47:15 Jan 8, 2015"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 0:32:24 Mar 25, 2015">25</td>
	       <td class="f" nowrap="nowrap">
               
		   <a href="/web/20150325011254/http://foundationdb.com/key-value-store/documentation/data-modeling.html" title="1:12:54 Mar 25, 2015"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a>
	       
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   2014
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 0:32:24 Mar 25, 2015">2015</td>
	       <td class="f" nowrap="nowrap">
               
                   2016
               
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="/web/20150325003224*/https://foundationdb.com/key-value-store/documentation/data-modeling.html" title="See a list of every capture for this URL">8 captures</a>
           <div class="r" title="Timespan for captures of this URL">8 Jan 15 - 27 Sep 15</div>
       </td>
       <td class="k">
       <a href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines"
		 onmouseover="__wm.st(1)" onmouseout="__wm.st(0)"
		 onmousemove="__wm.mv(event,this)"
		 width="525"
		 height="27"
		 border="0"
		 src="/web/jsp/graph.jsp?graphdata=525_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000000_2011:-1:000000000000_2012:-1:000000000000_2013:-1:000000000000_2014:-1:000000000000_2015:2:104100101000_2016:-1:000000000000" />
       </div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>
<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->

<header id='header'>
<div class='container'>
<a href='/web/20150325003224/https://foundationdb.com/' id='logo'></a>
<a id='mobile-nav-toggle'><img alt="Hamburger" src="/web/20150325003224im_/https://d3glfbbr3jeumb.cloudfront.net/assets/icons/hamburger-bbd9560947385da4445b540086f10c9b.png" /></a>
<a id='mobile-auth-toggle'>
<i class='icon-user'></i>
</a>
<div id='auth-links'></div>
</div>
</header>
<nav id='nav'>
<div class='container'>
<ul>
<li class=''>
<a href="/web/20150325003224/https://foundationdb.com/"><span>H</span>ome</a>
</li>
<li class='active with-subnav'>
<a href="/web/20150325003224/https://foundationdb.com/key-value-store"><span>K</span>ey-Value Store</a>
<ul class='subnav'>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store">Overview</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation">Documentation</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/performance">Performance</a></li>
</ul>
</li>
<li class='with-subnav'>
<a href="/web/20150325003224/https://foundationdb.com/layers/sql"><span>S</span>QL Layer</a>
<ul class='subnav'>
<li><a href="/web/20150325003224/https://foundationdb.com/layers/sql">Overview</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/layers/sql/documentation">Documentation</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/layers/sql/performance">Performance</a></li>
</ul>
</li>
<li class='with-subnav'>
<a href="/web/20150325003224/https://foundationdb.com/community"><span>R</span>esources</a>
<ul class='subnav'>
<li><a href="/web/20150325003224/http://community.foundationdb.com/">Community</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/courses">Education</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/videos">Videos</a></li>
</ul>
</li>
<li class='with-subnav'>
<a href="/web/20150325003224/https://foundationdb.com/about"><span>C</span>ompany</a>
<ul class='subnav'>
<li><a href="/web/20150325003224/https://foundationdb.com/about">About Us</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/contact">Contact Us</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/jobs">Jobs</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id='flash'>
<div class='notice'></div>
<div class='alert'></div>
</div>
<div id='documentation-inner'>
<div id='docs-global-nav-content'>
<ul>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/index.html">Summary</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/getting-started.html">Getting Started</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/tutorials.html">Tutorials</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/developer-guide.html">Developer Guide</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/data-modeling.html" class="active">Data Modeling</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/recipes">Design Recipes</a></li>
<li>
<a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/api-reference.html">API Reference</a>
<ul>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/api-python.html">Python API</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/api-ruby.html">Ruby API</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/api-node.html">Node.js API</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/api-php.html">PHP API</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/javadoc/index.html">Java API</a></li>
<li><a href="/web/20150325003224/http://godoc.org/github.com/FoundationDB/fdb-go/fdb">Go API</a></li>
<li><a href="/web/20150325003224/https://github.com/Doxense/foundationdb-dotnet-client">.NET API</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/api-c.html">C API</a></li>
</ul>
</li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/building-cluster.html">Building a Cluster</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/configuration.html">Configuration</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/administration.html">Administration</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/command-line-interface.html">Command Line Interface</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/mr-status.html">Machine-Readable Status</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/tls.html">Transport Layer Security</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/backups.html">Backup and Restoration</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/known-limitations.html">Known Limitations</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/platforms.html">Platform Issues</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/release-notes.html">Release Notes</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/documentation/older">Older Versions</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/key-value-store/white-papers">White Papers</a></li>
</ul>
</div>

<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
  	URL_ROOT:    '',
  	VERSION:     '3.0.7',
  	COLLAPSE_INDEX: false,
  	FILE_SUFFIX: '.html',
  	HAS_SOURCE:  true
  };
</script>

<div id="breadcrumbs" class="container">
  <div id="breadcrumbs-inner">
    
    <a href="index.html">FoundationDB 3.0</a> &raquo;
    <a href="building-with-the-api.html">Building with the API</a> &raquo;
    
    <a id="mobile-search-link" href="/web/20150325003224/https://foundationdb.com/documentation/latest/search.html">
      <img alt="Magnifying-glass" src="/web/20150325003224im_/https://d3glfbbr3jeumb.cloudfront.net/assets/icons/magnifying-glass-1e869de9fc6b47eca22fbd10a9d914a3.png" />
    </a>
  </div>
</div>
<div id="documentation" class="container">
  <div class="body sphinx">
    
  <span class="target" id="module-fdb"></span><div class="section" id="data-modeling">
<h1>Data Modeling<a class="headerlink" href="#data-modeling" title="Permalink to this headline">∞</a></h1>
<p>FoundationDB&#8217;s core provides a simple data model coupled with powerful transactions. This combination allows building richer data models and libraries that inherit the scalability, performance, and integrity of the database. The goal of data modeling is to design a mapping of data to keys and values that enables effective storage and retrieval. Good decisions will yield an extensible, efficient abstraction. This document covers the fundamentals of data modeling with FoundationDB.</p>
<ul class="simple">
<li>For general guidance on application development using FoundationDB, see <a class="reference internal" href="developer-guide.html"><em>Developer Guide</em></a>.</li>
<li>For detailed API documentation specific to each supported language, see <a class="reference internal" href="api-reference.html"><em>API Reference</em></a>.</li>
</ul>
<div class="section" id="modeling-with-layers">
<h2>Modeling with layers<a class="headerlink" href="#modeling-with-layers" title="Permalink to this headline">∞</a></h2>
<p>Before we dive into details, it&#8217;s worth noting that not all data modeling in FoundationDB needs to be done from scratch. FoundationDB makes available a <a class="reference external" href="/web/20150325003224/https://github.com/FoundationDB/python-layers">number of layers</a>, many of which implement common data models, exposing them as APIs. One of the most commonly used layers, the tuple layer, is discussed below. The <a class="reference internal" href="largeval.html"><em>blob layer</em></a> is useful for managing very large values, such as binary large objects. For an overview of our layers, see our <a class="reference external" href="/web/20150325003224/https://foundationdb.com/layers">layers catalog</a>.</p>
</div>
<div class="section" id="the-core-data-model">
<h2>The core data model<a class="headerlink" href="#the-core-data-model" title="Permalink to this headline">∞</a></h2>
<p>FoundationDB&#8217;s core data model is an ordered key-value store. Also known as an ordered associative array, map, or dictionary, this is a common data structure composed of a collection of key-value pairs in which all keys are unique. Starting with this simple model, an application can create higher-level data models by mapping their elements to individual keys and values.</p>
<p>In FoundationDB, both keys and values are simple byte strings. Apart from storage and retrieval, the database does not interpret or depend on the content of values. In contrast, keys are treated as members of a total order, the lexicographic order over the underlying bytes, in which keys are sorted by each byte in order. For example:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">'0'</span></tt> is sorted before <tt class="docutils literal"><span class="pre">'1'</span></tt></li>
<li><tt class="docutils literal"><span class="pre">'apple'</span></tt> is sorted before <tt class="docutils literal"><span class="pre">'banana'</span></tt></li>
<li><tt class="docutils literal"><span class="pre">'apple'</span></tt> is sorted before <tt class="docutils literal"><span class="pre">'apple123'</span></tt></li>
<li>keys starting with <tt class="docutils literal"><span class="pre">'mytable\'</span></tt> are sorted together (e.g. <tt class="docutils literal"><span class="pre">'mytable\row1'</span></tt>, <tt class="docutils literal"><span class="pre">'mytable\row2'</span></tt>, ...)</li>
</ul>
<p>The ordering of keys is especially relevant for range operations. An application should structure keys to produce an ordering that allows efficient data retrieval with range reads.</p>
</div>
<div class="section" id="encoding-data-types">
<span id="id1"></span><h2>Encoding data types<a class="headerlink" href="#encoding-data-types" title="Permalink to this headline">∞</a></h2>
<p>Because keys and values in FoundationDB are always byte strings, an application developer must serialize other data types (e.g., integers, floats, arrays) before storing them in the database. For values, the main concerns for serialization are simply CPU and space efficiency. For keys, there&#8217;s an additional consideration: it&#8217;s often important for keys to preserve the order of the data types (whether primitive or composite) they encode. For example:</p>
<div class="section" id="integers">
<h3>Integers<a class="headerlink" href="#integers" title="Permalink to this headline">∞</a></h3>
<ul class="simple">
<li>The standard tuple layer provides an order-preserving, signed, variable length encoding.</li>
<li>For positive integers, a big-endian fixed length encoding is order-preserving.</li>
<li>For signed integers, a big-endian fixed length two&#8217;s-complement encoding with the most significant (sign) bit inverted is order-preserving.</li>
</ul>
</div>
<div class="section" id="unicode-strings">
<h3>Unicode strings<a class="headerlink" href="#unicode-strings" title="Permalink to this headline">∞</a></h3>
<ul class="simple">
<li>For unicode strings ordered lexicographically by unicode code point, use UTF-8 encoding.  (This approach is used by the tuple layer.)</li>
<li>For unicode strings ordered by a particular collation (for example, a case insensitive ordering for a particular language), use an appropriate string collation transformation and then apply UTF-8 encoding.  Internationalization or &#8220;locale&#8221; libraries in most environments and programming languages provide a string collation transformation, for example <a class="reference external" href="/web/20150325003224/http://pubs.opengroup.org/onlinepubs/7908799/xsh/wcsxfrm.html">C</a>, <a class="reference external" href="/web/20150325003224/http://www.cplusplus.com/reference/std/locale/collate/transform/">C++</a>, <a class="reference external" href="/web/20150325003224/http://docs.python.org/py3k/library/locale.html#locale.strxfrm">Python</a>, <a class="reference external" href="/web/20150325003224/https://github.com/ninjudd/icunicode#readme">Ruby</a>, <a class="reference external" href="/web/20150325003224/http://docs.oracle.com/javase/1.5.0/docs/api/java/text/Collator.html#getCollationKey(java.lang.String)">Java</a>, the <a class="reference external" href="/web/20150325003224/http://icu-project.org/apiref/icu4c/classCollator.html#ae524fd43a06d4429e2c76bef35874d4c">ICU</a> library, etc.  Usually the output of this function is a unicode string, which needs to be further encoded in a code-point ordered encoding such as UTF-8 to get a byte string.</li>
</ul>
</div>
<div class="section" id="floating-point-numbers">
<h3>Floating point numbers<a class="headerlink" href="#floating-point-numbers" title="Permalink to this headline">∞</a></h3>
<p>IEEE floating point numbers in a big-endian encoding with the most significant bit inverted have a total ordering which is more or less compatible with the mathematical one, except that -0 and +0 are not equal, and NaN values will be treated differently than by the IEEE standard comparisons (which are not a total ordering).</p>
</div>
<div class="section" id="composite-types">
<h3>Composite types<a class="headerlink" href="#composite-types" title="Permalink to this headline">∞</a></h3>
<p>An application&#8217;s data is often represented using composite types, such as structures or records with multiple fields. It&#8217;s very useful for the application to use <em>composite</em> keys to store such data. In FoundationDB, composite keys can be conveniently represented as <em>tuples</em> that are mapped to individual keys for storage.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the purpose of illustration, we&#8217;ll use the FoundationDB&#8217;s Python language binding, including the <a class="reference internal" href="api-python.html#fdb.transactional" title="fdb.transactional"><tt class="xref py py-func docutils literal"><span class="pre">&#64;fdb.transactional</span></tt></a> decorator described in <a class="reference internal" href="api-python.html"><em>Python API</em></a>. The design patterns illustrated are applicable to all of the <a class="reference internal" href="api-reference.html"><em>languages</em></a> supported by FoundationDB.</p>
</div>
</div>
</div>
<div class="section" id="tuples">
<span id="data-modeling-tuples"></span><h2>Tuples<a class="headerlink" href="#tuples" title="Permalink to this headline">∞</a></h2>
<p>FoundationDB&#8217;s keys are ordered, making tuples a particularly useful tool for data modeling. FoundationDB provides a <a class="reference internal" href="api-python.html#api-python-tuple-layer"><em>tuple layer</em></a> (available in each language binding) that encodes tuples into keys. This layer lets you store data using a tuple like <tt class="docutils literal"><span class="pre">(state,</span> <span class="pre">county)</span></tt> as a key. Later, you can perform reads using a prefix like <tt class="docutils literal"><span class="pre">(state,)</span></tt>. The layer works by preserving the natural ordering of the tuples.</p>
<p>You could implement a naive encoding of tuples of strings into keys by using a tab character as a simple delimiter. You could do this with the following Python code:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">tuple_to_key_with_tab</span><span class="p">(</span><span class="n">tup</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tup</span><span class="p">)</span>

<span class="c"># Example: Order first by state, then by county</span>
<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">set_county_population</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">county</span><span class="p">,</span> <span class="n">pop</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">tuple_to_key_with_tab</span><span class="p">((</span><span class="n">state</span><span class="p">,</span> <span class="n">county</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, population figures for the United States are stored using keys formed from the tuple of state and county.</p>
<p>Of course, this encoding would only work if all the bytes in the individual keys in the tuple were greater than the delimiter byte. Therefore, FoundationDB&#8217;s built-in tuple layer implements a more robust encoding supporting elements of various data types: byte strings, unicode strings, 64-bit signed integers, and null values.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The tuple layer&#8217;s encoding is compatible between languages, although some languages are limited in what data types they support. For language-specific documentation of the tuple layer, see the corresponding <a class="reference internal" href="api-reference.html"><em>API Reference</em></a> documentation.</p>
</div>
<p>Because of its ordering of keys, FoundationDB supports efficient range reads on any set of keys that share a prefix. The tuple layer preserves the ordering of tuples sorted by element from left to right; as a result, the leftmost elements of a tuple will always represent a prefix in keyspace and can be used for range reads. A basic principle of data modeling with the tuple layer is to order tuple elements to facilitate such range reads. The examples below illustrate this principle.</p>
<p>Sometimes data attributes will have a natural order of containment imposed by your domain. A common example is geographic attributes, such as state and county in the Unites States. By constructing keys from tuples of the form <tt class="docutils literal"><span class="pre">(state,</span> <span class="pre">county)</span></tt>, where state is the first tuple element, all data for states will be stored in an adjacent range of keys. This ordering allows you to retrieve the populations for all counties in a given state with a single range read. You could use the tuple layer with the following functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">set_county_population</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">county</span><span class="p">,</span> <span class="n">pop</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">fdb</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">state</span><span class="p">,</span> <span class="n">county</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_county_populations_in_state</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">state</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">pop</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">fdb</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">state</span><span class="p">,))]]</span>
</pre></div>
</div>
<p>Date/timestamp attributes form another example with a natural containment order. If you have attributes of year, month, day, hour, minute, and/or second, you can order them from larger to smaller units in your keys. As a result, you&#8217;ll be able to retrieve temporally contiguous data with range reads, as above.</p>
</div>
<div class="section" id="a-few-simple-models">
<h2>A few simple models<a class="headerlink" href="#a-few-simple-models" title="Permalink to this headline">∞</a></h2>
<p>Let&#8217;s begin with a few examples of simple data models built on tuples with <a class="reference internal" href="developer-guide.html#developer-guide-sub-keyspaces"><em>subspaces</em></a>.</p>
<div class="section" id="arrays">
<h3>Arrays<a class="headerlink" href="#arrays" title="Permalink to this headline">∞</a></h3>
<p>You can easily map arrays to the key-value store using tuples. To model a named, one-dimensional array, you can construct a key for each array element using the array name as the subspace and the array index as the second tuple element.</p>
<p>For example, suppose you have a <tt class="docutils literal"><span class="pre">'temps2012'</span></tt> array containing a year&#8217;s worth of daily temperature averages. The temperatures are indexed by an integer ranging from 1 to 365 representing the day. Your keys would then be constructed from tuples of the form <tt class="docutils literal"><span class="pre">('temps2012',</span> <span class="pre">day)</span></tt>.</p>
<p>To set and get array elements with this technique, you can use Python functions such as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">array_set</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">array_space</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">array_space</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">array_get</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">array_space</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tr</span><span class="p">[</span><span class="n">array_space</span><span class="p">[</span><span class="n">index</span><span class="p">]]</span>

<span class="n">temp_array</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;temps2012&#39;</span><span class="p">,))</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_temp</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
    <span class="n">array_set</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">temp_array</span><span class="p">,</span> <span class="n">day</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_temp</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">day</span><span class="p">):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">array_get</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">temp_array</span><span class="p">,</span> <span class="n">day</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">val</span><span class="o">.</span><span class="n">present</span><span class="p">():</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
<p>This approach has a few nice properties:</p>
<ul class="simple">
<li>It can be extended to multidimensional arrays simply by adding additional array indexes to the tuples.</li>
<li>Unassigned elements consume no storage, so sparse arrays are stored efficiently.</li>
</ul>
<p>The tuple layer makes these properties easy to achieve, and most well-designed data models using tuples will share them.</p>
<p>An array can only have a single value for each index. Likewise, the key-value store can only have a single value for each key. The simple mapping above takes advantage of this correspondence to store the array value as a physical value. In contrast, some data structures are designed to store multiple values. In these cases, data models can store the logical values within the key itself, as illustrated next.</p>
</div>
<div class="section" id="multimaps">
<h3>Multimaps<a class="headerlink" href="#multimaps" title="Permalink to this headline">∞</a></h3>
<p>A multimap is a generalization of an associative array in which each key may be associated with multiple values. Multimaps are often implemented as associative arrays in which the values are sets rather than primitive data types.</p>
<p>Suppose you have a multimap that records student enrollment in classes, with students as keys and classes as values. Each student can be enrolled in more than one class, so you need to map the key-value pairs of the multimap (with their multiple values) to the database.</p>
<p>A simple approach is to use the multimap name (say, <tt class="docutils literal"><span class="pre">'enroll'</span></tt>) as the subspace and construct a key from a tuple of the form <tt class="docutils literal"><span class="pre">('enroll',</span> <span class="pre">student,</span> <span class="pre">class_name)</span></tt> for each class in which a student is enrolled. Each class will generate a unique key, allowing as many classes as needed. Moreover, all the data in the multimap will be captured in the key, so you can just use an empty string for its value. Using this approach, you can add a class for a student or get all the student&#8217;s classes with the Python functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">multi_set</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">multi_space</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">multi_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">))]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">multi_get</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">multi_space</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">pairs</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="n">multi_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">index</span><span class="p">,))]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">multi_space</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">pairs</span><span class="p">]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">multi_is_element</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">multi_space</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="n">multi_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">))]</span>
    <span class="k">return</span> <span class="n">val</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

<span class="n">enroll_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;enroll&#39;</span><span class="p">,))</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_class</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">student</span><span class="p">,</span> <span class="n">class_name</span><span class="p">):</span>
    <span class="n">multi_set</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">enroll_space</span><span class="p">,</span> <span class="n">student</span><span class="p">,</span> <span class="n">class_name</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_classes</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">student</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">multi_get</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">enroll_space</span><span class="p">,</span> <span class="n">student</span><span class="p">)</span>
</pre></div>
</div>
<p>The <tt class="docutils literal"><span class="pre">range()</span></tt> method in <tt class="xref py py-func docutils literal"><span class="pre">multi_get()</span></tt> returns all keys in the subspace that encode tuples with the specified tuple as a prefix. The <tt class="docutils literal"><span class="pre">[-1]</span></tt> extracts the last element of the tuple unpacked from the key, which in this case will encode a class.</p>
<p>As this model for multimaps illustrates, data that is treated as a value at one level may be mapped to a key in the database. (The reverse may also occur, as shown in the discussion of indirection below.) Data modeling in FoundationDB is not dictated by how your data is represented in your programming language.</p>
</div>
<div class="section" id="tables">
<span id="data-modeling-tables"></span><h3>Tables<a class="headerlink" href="#tables" title="Permalink to this headline">∞</a></h3>
<p>You can easily use tuples to store data in tabular form with rows and columns. The simplest data model for a table is to make each cell in the table a key-value pair. To do this, you construct a key from a tuple containing the row and column identifiers. As with the array model, unassigned cells in tables constructed using this technique will consume no storage, so sparse tables can be stored efficiently. As a result, a table can safely have a very large number of columns.</p>
<p>You can make your model row-oriented or column-oriented by placing either the row or column first in the tuple, respectively. Because the lexicographic order sorts tuple elements from left to right, access is optimized for the element placed first. Placing the row first makes it efficient to read all the cells in a particular row; reversing the order makes reading a column more efficient.</p>
<p>Using the table name as the subspace, we could implement the common row-oriented version in Python as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_set_cell</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">table_space</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">table_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_get_cell</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">table_space</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tr</span><span class="p">[</span><span class="n">table_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">))]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_set_row</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">table_space</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">cols</span><span class="p">):</span>
    <span class="k">del</span> <span class="n">tr</span><span class="p">[</span><span class="n">table_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">row</span><span class="p">,))]</span>
    <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">cols</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
        <span class="n">table_set_cell</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">table_space</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_get_row</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">table_space</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">table_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">row</span><span class="p">,))]:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">table_space</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">cols</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">cols</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="entity-relationship-models">
<span id="data-modeling-entity-relationship"></span><h2>Entity-relationship models<a class="headerlink" href="#entity-relationship-models" title="Permalink to this headline">∞</a></h2>
<p>Entity-relationship models are often used to describe a database at various levels of abstraction. In this methodology, a <em>logical</em> data model consisting of entities, attributes, and relationships is defined before mapping it to a <em>physical</em> data models specifying keys and other implementation features. Entity-relationship models can be easily modeled in FoundationDB using tuples.</p>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">∞</a></h3>
<p>Suppose you&#8217;re storing entity-relationship data for users in an <tt class="docutils literal"><span class="pre">'ER'</span></tt> subspace. You might identify each entity with a unique identifier and define a key for each attribute with the tuple <tt class="docutils literal"><span class="pre">('ER',</span> <span class="pre">entity_ID,</span> <span class="pre">attribute)</span></tt>. You could then store the user&#8217;s region using the Python functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">ER_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;ER&#39;</span><span class="p">,))</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_attribute_value</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">entity_ID</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">ER_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">entity_ID</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_attribute_value</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">entity_ID</span><span class="p">,</span> <span class="n">attribute</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tr</span><span class="p">[</span><span class="n">ER_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">entity_ID</span><span class="p">,</span> <span class="n">attribute</span><span class="p">))]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_user_region</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="n">add_attribute_value</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">,</span> <span class="s">&#39;region&#39;</span><span class="p">,</span> <span class="n">region</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="relationships">
<h3>Relationships<a class="headerlink" href="#relationships" title="Permalink to this headline">∞</a></h3>
<p>Using the pattern we saw above with multimaps, you can store relationships and related entities as an element of the key and use an empty string as the physical value. Suppose your users can belong to one or more groups. To add a user to a group or retrieve all groups to which a user belongs, you can use the Python functions:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_relationship</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">ER_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">relationship</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">))]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_relationships</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">relationship</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ER_space</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="o">.</span><span class="n">get_range_startswith</span><span class="p">(</span><span class="n">ER_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">relationship</span><span class="p">,)),</span>
                                        <span class="n">streaming_mode</span><span class="o">=</span><span class="n">fdb</span><span class="o">.</span><span class="n">StreamingMode</span><span class="o">.</span><span class="n">want_all</span><span class="p">)]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_related_entities</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="n">ER_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">relationship</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">))]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">ER_space</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">is_related_entity</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">relationship</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tr</span><span class="p">[</span><span class="n">ER_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">relationship</span><span class="p">,</span> <span class="n">primary_key</span><span class="p">,</span> <span class="n">foreign_key</span><span class="p">))]</span><span class="o">.</span><span class="n">present</span><span class="p">()</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_user_to_group</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">,</span> <span class="n">group_name</span><span class="p">):</span>
    <span class="n">add_relationship</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="s">&#39;belongs_to&#39;</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">,</span> <span class="n">group_name</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_users_groups</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">get_related_entities</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="s">&#39;belongs_to&#39;</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">)</span>
</pre></div>
</div>
<p>You can extend this code by adding indexes for the related entities (see below) and enforcement of relationship cardinalities (one-to-many, etc.).</p>
</div>
</div>
<div class="section" id="indexes">
<span id="data-modeling-indexes"></span><h2>Indexes<a class="headerlink" href="#indexes" title="Permalink to this headline">∞</a></h2>
<p>A common technique is to store the same data in different ways to allow efficient retrieval for multiple use cases, creating indexes. This technique is especially useful when there are many more reads than writes. For example, you may find it most convenient to store user data based on <tt class="docutils literal"><span class="pre">user_ID</span></tt> but sometimes need to retrieve users based on their region. An index allows this retrieval to be performed efficiently.</p>
<p>An index can have a very simple tuple structure consisting of an unique subspace, the relationship being indexed, and a value: <tt class="docutils literal"><span class="pre">(subspace_for_index,</span> <span class="pre">relationship,</span> <span class="pre">value)</span></tt>. Placing the relationship before the value is what allows efficient retrieval of all the associated values with a single range read.</p>
<p>With FoundationDB&#8217;s transactions, you can easily build an index and guarantee that it stays in sync with the data: just update the index in the same transaction that updates the data.</p>
<p>For example, suppose you&#8217;d like to add an index to efficiently look up users by region. You can augment the Python function <tt class="xref py py-func docutils literal"><span class="pre">add_user()</span></tt> with the index and add a new function for retrieval:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">user_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;user&#39;</span><span class="p">,))</span>
<span class="n">region_index</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;region_idx&#39;</span><span class="p">,))</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_user</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">user_ID</span><span class="p">,</span> <span class="n">region</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">region_index</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">region</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">))]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_users_in_region</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">region</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="n">region_index</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">region</span><span class="p">,))]</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">region_index</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">items</span><span class="p">]</span>
</pre></div>
</div>
<p>To apply this technique to a real use case, you would add code to your update transaction to delete outdated index entries. Note that this approach lets you add as many indexes as desired by updating all the indexes in the same transaction.</p>
</div>
<div class="section" id="composite-models">
<h2>Composite models<a class="headerlink" href="#composite-models" title="Permalink to this headline">∞</a></h2>
<p>Most of the techniques we&#8217;ve discussed can be freely combined. Let&#8217;s look at adding indexes to our basic data model for tables.</p>
<p>We&#8217;ve already seen a way to store tabular data in a row-oriented order using table names as subspaces. You can extend this model by simultaneously storing the table in both row-oriented and column-oriented layouts, allowing efficient retrieval of either an entire row or an entire column. We&#8217;ll create nested subspaces for the indexes using the subscripting syntax we saw above:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">table_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;table&#39;</span><span class="p">,))</span>
<span class="n">row_index</span> <span class="o">=</span> <span class="n">table_space</span><span class="p">[</span><span class="s">&#39;row_idx&#39;</span><span class="p">]</span>
<span class="n">col_index</span> <span class="o">=</span> <span class="n">table_space</span><span class="p">[</span><span class="s">&#39;col_idx&#39;</span><span class="p">]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_set_cell</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">row_index</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">col_index</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">column</span><span class="p">,</span> <span class="n">row</span><span class="p">))]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_get_cell</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">tr</span><span class="p">[</span><span class="n">row_index</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">))]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_get_row</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">row_index</span><span class="p">,</span> <span class="n">row</span><span class="p">):</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">row_index</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">row</span><span class="p">,))]:</span>
        <span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">row_index</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">cols</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">cols</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">table_get_col</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">col_index</span><span class="p">,</span> <span class="n">col</span><span class="p">):</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">col_index</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">col</span><span class="p">,))]:</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">r</span> <span class="o">=</span> <span class="n">col_index</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
        <span class="n">rows</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
    <span class="k">return</span> <span class="n">rows</span>
</pre></div>
</div>
</div>
<div class="section" id="graphs">
<span id="data-modeling-graphs"></span><h2>Graphs<a class="headerlink" href="#graphs" title="Permalink to this headline">∞</a></h2>
<p>Your application might support the ability for users to connect with one another to receive status updates. If connection requests must be accepted and are mutual, then they form an undirected graph. Because the connection relationship is symmetric, the data model can store the connection information in both users&#8217; profiles:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">user_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;user&#39;</span><span class="p">,))</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">add_friend</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">,</span> <span class="n">user_ID2</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">user_ID</span><span class="p">,</span> <span class="s">&#39;friends_with&#39;</span><span class="p">,</span> <span class="n">user_ID2</span><span class="p">))]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">user_ID2</span><span class="p">,</span> <span class="s">&#39;friends_with&#39;</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">))]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</pre></div>
</div>
<p>To retrieve first-degree connections (&#8220;friends&#8221;) and second-degree connections (&#8220;friends of friends&#8221;), you can use:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_friends</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">fdb</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">user_ID</span><span class="p">,</span> <span class="s">&#39;friends_with&#39;</span><span class="p">))]]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_friends_of_friends</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">):</span>
    <span class="n">second_degree</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">get_friends</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">):</span>
        <span class="n">second_degree</span> <span class="o">=</span> <span class="n">second_degree</span> <span class="o">+</span> <span class="n">get_friends</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
    <span class="n">second_degree</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">second_degree</span><span class="p">))</span>
    <span class="n">second_degree</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">user_ID</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">second_degree</span>
</pre></div>
</div>
<p>Alternately, your application might allow a user to &#8220;follow&#8221; other users without their necessarily reciprocating, resulting in a directed graph. To model this graph while allowing efficient retrieval in either link direction, you can store distinct relationships for <tt class="docutils literal"><span class="pre">'has_followed'</span></tt> and <tt class="docutils literal"><span class="pre">'followed_by'</span></tt>:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">follow_user</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">,</span> <span class="n">user_ID2</span><span class="p">):</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">user_ID</span><span class="p">,</span> <span class="s">&#39;has_followed&#39;</span><span class="p">,</span> <span class="n">user_ID2</span><span class="p">))]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
    <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">user_ID2</span><span class="p">,</span> <span class="s">&#39;followed_by&#39;</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">))]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_has_followed</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">fdb</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">user_ID</span><span class="p">,</span> <span class="s">&#39;has_followed&#39;</span><span class="p">))]]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_followed_by</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">user_ID</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">fdb</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">user_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">user_ID</span><span class="p">,</span> <span class="s">&#39;followed_by&#39;</span><span class="p">))]]</span>
</pre></div>
</div>
</div>
<div class="section" id="hierarchies">
<span id="data-modeling-hierarchies"></span><h2>Hierarchies<a class="headerlink" href="#hierarchies" title="Permalink to this headline">∞</a></h2>
<p>Many applications work with hierarchical data represented by nested dictionaries or similar composite data types. Such data is often serialized to or deserialized from a format such as JSON or XML. Looking at a hierarchical object as a tree, you can use a tuple to represent the full path to each leaf (sometimes called  a &#8220;materialized path&#8221;). By storing each full path as a key, you get an index for each leaf. FoundationDB can then efficiently retrieve any individual piece of data or entire sub-tree.</p>
<p>For example, suppose you have hierarchical data such as the following nested dictionaries and lists:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">{</span><span class="s">&#39;user&#39;</span><span class="p">:</span> <span class="p">{</span>  <span class="s">&#39;jones&#39;</span><span class="p">:</span>
            <span class="p">{</span>   <span class="s">&#39;friendOf&#39;</span><span class="p">:</span> <span class="s">&#39;smith&#39;</span><span class="p">,</span>
                <span class="s">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;sales&#39;</span><span class="p">,</span> <span class="s">&#39;service&#39;</span><span class="p">]},</span>
            <span class="s">&#39;smith&#39;</span><span class="p">:</span>
            <span class="p">{</span>   <span class="s">&#39;friendOf&#39;</span><span class="p">:</span> <span class="s">&#39;jones&#39;</span><span class="p">,</span>
                <span class="s">&#39;group&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;dev&#39;</span><span class="p">,</span> <span class="s">&#39;research&#39;</span><span class="p">]}}}</span>
</pre></div>
</div>
<p>To distinguish the list elements from dictionary elements and preserve the order of the lists, you can just include the index of each list element before it in the tuple. Using this technique, the data above would be converted to the following tuples:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;jones&#39;</span><span class="p">,</span> <span class="s">&#39;friendOf&#39;</span><span class="p">,</span> <span class="s">&#39;smith&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;jones&#39;</span><span class="p">,</span> <span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;sales&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;jones&#39;</span><span class="p">,</span> <span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;service&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;smith&#39;</span><span class="p">,</span> <span class="s">&#39;friendOf&#39;</span><span class="p">,</span> <span class="s">&#39;jones&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;smith&#39;</span><span class="p">,</span> <span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;dev&#39;</span><span class="p">),</span>
<span class="p">(</span><span class="s">&#39;user&#39;</span><span class="p">,</span> <span class="s">&#39;smith&#39;</span><span class="p">,</span> <span class="s">&#39;group&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;research&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>Suppose you&#8217;d like to use this representation to implement a nested keyspace, i.e., a key-value store in which values can themselves be nested dictionaries or lists. Your application receives a stream of serialized JSON objects in which different objects may contain data about the same entities, so you&#8217;d like to store the data in a common nested keyspace.</p>
<p>You can deserialize the data using Python&#8217;s standard <tt class="docutils literal"><span class="pre">json</span></tt> module, generate the corresponding set of paths as tuples, and store each tuple in a <tt class="docutils literal"><span class="pre">'hier'</span></tt> subspace:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">json</span><span class="o">,</span> <span class="nn">itertools</span>

<span class="n">hier_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;hier&#39;</span><span class="p">,))</span>

<span class="n">EMPTY_OBJECT</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">EMPTY_ARRAY</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

<span class="k">def</span> <span class="nf">to_tuples</span><span class="p">(</span><span class="n">item</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">item</span> <span class="o">==</span> <span class="p">{}:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">EMPTY_OBJECT</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="n">item</span> <span class="o">==</span> <span class="p">[]:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">EMPTY_ARRAY</span><span class="p">,</span> <span class="bp">None</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">dict</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sub</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">item</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">to_tuples</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,)</span> <span class="o">+</span> <span class="n">sub</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="k">for</span> <span class="n">sub</span> <span class="ow">in</span> <span class="n">to_tuples</span><span class="p">(</span><span class="n">v</span><span class="p">)]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">item</span><span class="p">,)]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">insert_hier</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">hier</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">hier</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">hier</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">hier</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">to_tuples</span><span class="p">(</span><span class="n">hier</span><span class="p">):</span>
        <span class="n">tr</span><span class="p">[</span><span class="n">hier_space</span><span class="o">.</span><span class="n">pack</span><span class="p">(</span><span class="n">tup</span><span class="p">)]</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
</pre></div>
</div>
<p>You can then retrieve any sub-tree from the nested keyspace by giving the partial path to its root. The partial path will just be a tuple that your query function uses as a key prefix for a range read. For example, to retrieve the data for <tt class="docutils literal"><span class="pre">'smith'</span></tt> from the hierarchy above, you would use <tt class="docutils literal"><span class="pre">('user',</span> <span class="pre">'smith')</span></tt>.</p>
<p>The retrieved data will be a list of tuples. The final step before returning the data is to convert it back to a nested data structure:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">def</span> <span class="nf">from_tuples</span><span class="p">(</span><span class="n">tuples</span><span class="p">):</span>
    <span class="n">first</span> <span class="o">=</span> <span class="n">tuples</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># The first tuple will tell us what kind of object we have</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">first</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="k">return</span> <span class="n">first</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c"># Primitive value</span>
    <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="p">(</span><span class="n">EMPTY_OBJECT</span><span class="p">,</span><span class="bp">None</span><span class="p">):</span> <span class="k">return</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">first</span> <span class="o">==</span> <span class="p">(</span><span class="n">EMPTY_ARRAY</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span> <span class="k">return</span> <span class="p">[]</span>

    <span class="c"># For an object or array, we need to group the tuples by their first element</span>
    <span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">tuples</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>

    <span class="k">if</span> <span class="n">first</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>   <span class="c"># array</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">from_tuples</span><span class="p">([</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">g</span><span class="p">])</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>    <span class="c"># object</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">from_tuples</span><span class="p">([</span><span class="n">t</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">g</span><span class="p">]))</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_sub_hier</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">prefix</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">from_tuples</span><span class="p">([</span><span class="n">hier_space</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">hier_space</span><span class="o">.</span><span class="n">range</span><span class="p">(</span><span class="n">prefix</span><span class="p">)]])</span>
</pre></div>
</div>
</div>
<div class="section" id="documents">
<span id="data-modeling-documents"></span><h2>Documents<a class="headerlink" href="#documents" title="Permalink to this headline">∞</a></h2>
<p>Suppose you&#8217;d like to use the above representation to implement a simple document-oriented data model. As before, your application receives serialized data in JSON, only now you&#8217;d like to store each JSON object as an independent document. To do so, you just need to ensure that each tuple created for that object is stored with a unique identifier for the document. If a <tt class="docutils literal"><span class="pre">doc_id</span></tt> has not already been supplied, you can randomly generate one.</p>
<p>To store a path, you can construct a composite key in a <tt class="docutils literal"><span class="pre">'doc'</span></tt> subspace, with the <tt class="docutils literal"><span class="pre">doc_id</span></tt> as the next element, followed by the remainder of the path. You can store the leaf (the last element of the tuple) as the value, which enables storage of larger data sizes (see <a class="reference internal" href="#data-modeling-performance-guidelines"><em>Key and value sizes</em></a>):</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">random</span>

<span class="n">doc_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;doc&#39;</span><span class="p">,))</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">insert_doc</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">doc</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">doc</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;doc_id&#39;</span> <span class="ow">in</span> <span class="n">doc</span><span class="p">:</span>
        <span class="n">doc</span><span class="p">[</span><span class="s">&#39;doc_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100000000</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tup</span> <span class="ow">in</span> <span class="n">to_tuples</span><span class="p">(</span> <span class="n">doc</span> <span class="p">):</span>
        <span class="n">tr</span><span class="p">[</span><span class="n">doc_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">doc</span><span class="p">[</span><span class="s">&#39;doc_id&#39;</span><span class="p">],)</span> <span class="o">+</span> <span class="n">tup</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]</span> <span class="o">=</span> <span class="n">fdb</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">tup</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],))</span>
    <span class="k">return</span> <span class="n">doc</span><span class="p">[</span><span class="s">&#39;doc_id&#39;</span><span class="p">]</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">get_doc</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">doc_id</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">from_tuples</span><span class="p">([</span><span class="n">doc_space</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">fdb</span><span class="o">.</span><span class="n">tuple</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
                        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">tr</span><span class="p">[</span><span class="n">doc_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">doc_id</span><span class="p">,))]])</span>
</pre></div>
</div>
</div>
<div class="section" id="indirection">
<span id="data-modeling-indirection"></span><h2>Indirection<a class="headerlink" href="#indirection" title="Permalink to this headline">∞</a></h2>
<p>It is sometimes beneficial to add a level of indirection to a data model. Instead of using key-value pairs to directly store application data, you can instead store a reference to that data. This approach can be used to model any data structure that would normally use references. You just need to perform any modifications to the data structure in a transaction that leaves it in a consistent state.</p>
<p>Suppose you want to maintain data in a singly linked list. The application data can use a tuple structure like those of single-valued relationships. Links will be similar but will use node identifiers as their values. Here is an example of removing the next node from the list:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">node_space</span> <span class="o">=</span> <span class="n">Subspace</span><span class="p">((</span><span class="s">&#39;node&#39;</span><span class="p">,))</span>

<span class="nd">@fdb.transactional</span>
<span class="k">def</span> <span class="nf">remove_next_node</span><span class="p">(</span><span class="n">tr</span><span class="p">,</span> <span class="n">node_ID</span><span class="p">):</span>
    <span class="n">next_ID</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="n">node_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">node_ID</span><span class="p">,</span> <span class="s">&#39;next&#39;</span><span class="p">))]</span>
    <span class="k">if</span> <span class="n">next_ID</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">next_next_ID</span> <span class="o">=</span> <span class="n">tr</span><span class="p">[</span><span class="n">node_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">next_ID</span><span class="p">,</span> <span class="s">&#39;next&#39;</span><span class="p">))]</span>
        <span class="n">tr</span><span class="p">[</span><span class="n">node_space</span><span class="o">.</span><span class="n">pack</span><span class="p">((</span><span class="n">node_ID</span><span class="p">,</span> <span class="s">&#39;next&#39;</span><span class="p">))]</span> <span class="o">=</span> <span class="n">next_next_ID</span>
        <span class="k">del</span> <span class="n">tr</span><span class="p">[</span><span class="n">node_space</span><span class="o">.</span><span class="n">range</span><span class="p">((</span><span class="n">next_ID</span><span class="p">,))]</span>
</pre></div>
</div>
<p>FoundationDB&#8217;s transactional guarantees ensure that, even when multiple clients are concurrently modifying the same linked list, the structure will be maintained in a consistent way.</p>
</div>
<div class="section" id="key-and-value-sizes">
<span id="data-modeling-performance-guidelines"></span><h2>Key and value sizes<a class="headerlink" href="#key-and-value-sizes" title="Permalink to this headline">∞</a></h2>
<p>How you map your application data to keys and values can have a dramatic impact on performance. Below are some guidelines to consider as you design a data model. (For more general discussion of performance considerations, see <a class="reference internal" href="developer-guide.html#developer-guide-peformance-considerations"><em>Performance considerations</em></a>.)</p>
<ul>
<li><p class="first">Structure keys so that range reads can efficiently retrieve the most frequently accessed data.</p>
<blockquote>
<div><ul class="simple">
<li>If you perform a range read that is, in total, much more than 1 kB, try to restrict your range as much as you can while still retrieving the needed data.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Structure keys so that no single key needs to be updated too frequently, which can cause transaction conflicts.</p>
<blockquote>
<div><ul class="simple">
<li>If a key is updated more than 10-100 times per second, try to split it into multiple keys.</li>
<li>For example, if a key is storing a counter, split the counter into N separate counters that are randomly incremented by clients. The total value of the counter can then read by adding up the N individual ones.</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Keep key sizes small.</p>
<blockquote>
<div><ul class="simple">
<li>Try to keep key sizes below 1 kB. (Performance will be best with key sizes below 32 bytes and <em>cannot</em> be more than 10 kB.)</li>
<li>When using the tuple layer to encode keys (as is recommended), select short strings or small integers for tuple elements. Small integers will encode to just two bytes.</li>
<li>If your key sizes are above 1 kB, try either to move data from the key to the value, split the key into multiple keys, or encode the parts of the key more efficiently (remembering to preserve any important ordering).</li>
</ul>
</div></blockquote>
</li>
<li><p class="first">Keep value sizes moderate.</p>
<blockquote>
<div><ul class="simple">
<li>Try to keep value sizes below 10 kB. (Value sizes <em>cannot</em> be more than 100 kB.)</li>
<li>If your value sizes are above 10 kB, consider splitting the value across multiple keys.</li>
<li>If you read values with sizes above 1 kB but use only a part of each value, consider splitting the values using multiple keys.</li>
<li>If you frequently perform individual reads on a set of values that total to fewer than 200 bytes, try either to combine the values into a single value or to store the values in adjacent keys and use a range read.</li>
</ul>
</div></blockquote>
</li>
</ul>
<div class="section" id="large-values-and-blobs">
<h3>Large Values and Blobs<a class="headerlink" href="#large-values-and-blobs" title="Permalink to this headline">∞</a></h3>
<p>If your keys or values are much larger than the above guidelines, it may be difficult to find a data model that resizes them appropriately. Unstructured data, such as binary large objects, can be especially challenging to segment manually. In this case, a good option is to use our blob layer. See our tutorial on <a class="reference internal" href="largeval.html"><em>Managing Large Values and Blobs</em></a> for further discussion.</p>
</div>
</div>
<div class="section" id="data-modeling-examples-tutorials">
<h2>Data modeling examples: tutorials<a class="headerlink" href="#data-modeling-examples-tutorials" title="Permalink to this headline">∞</a></h2>
<p>The <a class="reference internal" href="tutorials.html"><em>Tutorials</em></a> provide examples of data modeling using the tuple layer. They use techniques applicable to all of the <a class="reference internal" href="api-reference.html"><em>languages</em></a> supported by FoundationDB.</p>
</div>
</div>


  </div>
  <div id="search-documentation">
    <form action="search.html" method="get">
      <input type="text" name="q" class="search-query" placeholder="Search Documentation" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <div id="docs-page-nav">
      <h3>Navigate this page</h3>
      <ul><li><a class="reference internal" href="#">Data Modeling</a><ul><li><a class="reference internal" href="#modeling-with-layers">Modeling with layers</a></li><li><a class="reference internal" href="#the-core-data-model">The core data model</a></li><li><a class="reference internal" href="#encoding-data-types">Encoding data types</a><ul><li><a class="reference internal" href="#integers">Integers</a></li><li><a class="reference internal" href="#unicode-strings">Unicode strings</a></li><li><a class="reference internal" href="#floating-point-numbers">Floating point numbers</a></li><li><a class="reference internal" href="#composite-types">Composite types</a></li></ul></li><li><a class="reference internal" href="#tuples">Tuples</a></li><li><a class="reference internal" href="#a-few-simple-models">A few simple models</a><ul><li><a class="reference internal" href="#arrays">Arrays</a></li><li><a class="reference internal" href="#multimaps">Multimaps</a></li><li><a class="reference internal" href="#tables">Tables</a></li></ul></li><li><a class="reference internal" href="#entity-relationship-models">Entity-relationship models</a><ul><li><a class="reference internal" href="#attributes">Attributes</a></li><li><a class="reference internal" href="#relationships">Relationships</a></li></ul></li><li><a class="reference internal" href="#indexes">Indexes</a></li><li><a class="reference internal" href="#composite-models">Composite models</a></li><li><a class="reference internal" href="#graphs">Graphs</a></li><li><a class="reference internal" href="#hierarchies">Hierarchies</a></li><li><a class="reference internal" href="#documents">Documents</a></li><li><a class="reference internal" href="#indirection">Indirection</a></li><li><a class="reference internal" href="#key-and-value-sizes">Key and value sizes</a><ul><li><a class="reference internal" href="#large-values-and-blobs">Large Values and Blobs</a></li></ul></li><li><a class="reference internal" href="#data-modeling-examples-tutorials">Data modeling examples: tutorials</a></li></ul></li></ul>
    </div>
    <div id="docs-global-nav">
      <h3>Navigate All Docs</h3>
    </div>
  </div>
</div>


</div>
<footer id='footer'>
<div class='container'>
<ul>
<li>
<h3>Get Help</h3>
<ul id='get-help-list'>
<li><a href="/web/20150325003224/https://foundationdb.com/contact">Contact Us</a></li>
</ul>
</li>
<li>
<h3>Social</h3>
<ul>
<li><a href="/web/20150325003224/https://twitter.com/foundationdb">Twitter</a></li>
</ul>
</li>
<li>
<h3>Legal</h3>
<ul>
<li><a href="/web/20150325003224/https://foundationdb.com/legal/privacy">Privacy Policy</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/legal/terms">Terms of Service</a></li>
<li><a href="/web/20150325003224/https://foundationdb.com/legal/trademark">Trademark Disclaimer</a></li>
</ul>
</li>
</ul>
</div>
<div id='copyright'>&copy; 2015 FoundationDB</div>
</footer>
<div class='modal' id='login-modal'>
<div class='cover'></div>
<div class='inner'>
<h2>FoundationDB Log In</h2>
<div class='content'>
<div id='explanation'></div>
<form>
<fieldset>
<div class='errors'></div>
<ul>
<li>
<label for="email">Email Address</label>
<input id='email' type='email' value=''>
</li>
<li>
<label for="password">Password</label>
<input id='password' type='password'>
</li>
<li class='actions'>
<button>
Log In
<span class='spinner'></span>
</button>
<a href="#signup">Need an account?</a>
<a href="#reset-password" id="login-reset-link">Need to reset your password?</a>
</li>
</ul>
</fieldset>
</form>
</div>
<a class='close' href='#close'>
<i class='icon-cancel'></i>
</a>
</div>
</div>
<div class='modal' id='reset-password-modal'>
<div class='cover'></div>
<div class='inner'>
<h2>Reset Your Password</h2>
<div class='content'>
<form>
<p class='note'>Enter your email address below and we'll send you password reset instructions.</p>
<fieldset>
<div class='errors'></div>
<ul>
<li>
<label for="email">Email Address</label>
<input autocapitalize="false" id="email" name="email" type="email" value="" />
</li>
<li class='actions'>
<button>
Send Instructions
<span class='spinner'></span>
</button>
<a href="#cancel">Cancel</a>
</li>
</ul>
</fieldset>
</form>
<div id='done'>
<p>Please check your email. Your password reset instructions have been emailed to you.</p>
</div>
</div>
<a class='close' href='#close'>
<i class='icon-cancel'></i>
</a>
</div>
</div>
<div class='modal' id='video-modal'>
<div class='cover'></div>
<div class='inner'>
<iframe></iframe>
<a class='close' href='#close'>
<i class='icon-cancel'></i>
</a>
</div>
</div>

<script src="/web/20150325003224js_/https://d3glfbbr3jeumb.cloudfront.net/assets/application-a7f51eff68dda15563d95dd6b13ee7ae.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
<![endif]-->

</body>
</html>





<!--
     FILE ARCHIVED ON 0:32:24 Mar 25, 2015 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 10:28:11 Sep 23, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
