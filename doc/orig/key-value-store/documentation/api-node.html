<!DOCTYPE html>
<html lang='en' xml:lang='en' xmlns='http://www.w3.org/1999/xhtml'>
<head>


<script type="text/javascript" src="/static/js/analytics.js"></script>
<script type="text/javascript">archive_analytics.values.server_name="wwwb-app16.us.archive.org";archive_analytics.values.server_ms=228;</script>
<link type="text/css" rel="stylesheet" href="/static/css/banner-styles.css"/>


<title>

Node.js API

&mdash; FoundationDB
</title>
<meta charset='utf-8'>
<meta content=' foundationdb, database, nosql, scalable, fault tolerant, acid, transactions' name='keywords'>
<meta content='FoundationDB is a database that combines NoSQL scalability with true multikey ACID transactions.' name='description'>
<meta content='FoundationDB' name='author'>
<meta content='IE=edge' http-equiv='x-ua-compatible'>
<meta content='173350679' property='twitter:account_id'>
<meta content='FoundationDB' property='og:title'>
<meta content='https://foundationdb.com' property='og:url'>
<meta content='https://foundationdb.com/images/stacks.png' property='og:image'>
<meta content='FoundationDB is a database that combines NoSQL scalability with true multikey ACID transactions.' name='og:description'>
<meta content='2j_g9LCoS3SGSPULb2MLPGk2raKkFd4hPOuWWM5AsVw' name='google-site-verification'>
<link href='https://foundationdb.com/key-value-store/documentation/api-node.html' rel='canonical'>
<!--[if lt IE 9]>
<script src='/web/20150325003226/https://html5shiv.googlecode.com/svn/trunk/html5.js'></script>
<![endif]-->
<meta content='width=device-width, initial-scale=1.0' name='viewport'>
<link href="/web/20150325003226im_/https://d3glfbbr3jeumb.cloudfront.net/assets/favicon-eea8382cf5c35e23f9fb4273c134b2c0.png" rel="shortcut icon" type="image/png" />
<meta content="authenticity_token" name="csrf-param" />
<meta content="a29oON0Kb5PtHqT2xBucXcxspcp8dQuIWGGmDq2vjqI=" name="csrf-token" />
<link href="/web/20150325003226cs_/https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Gentium+Book+Basic:400,400italic" media="screen" rel="stylesheet" type="text/css" />
<link href="/web/20150325003226cs_/https://d3glfbbr3jeumb.cloudfront.net/assets/application-5cc81fa97aedacb1157cce0e30895a04.css" media="all" rel="stylesheet" type="text/css" />

</head>
<body class='show' id='documentation'>


<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script type="text/javascript" src="/static/js/disclaim-element.js" ></script>
<script type="text/javascript" src="/static/js/graph-calc.js" ></script>
<script type="text/javascript">//<![CDATA[
var __wm = (function(imgWidth,imgHeight,yearImgWidth,monthImgWidth){
var wbPrefix = "/web/";
var wbCurrentUrl = "https://foundationdb.com/key-value-store/documentation/api-node.html";

var firstYear = 1996;
var displayDay = "25";
var displayMonth = "Mar";
var displayYear = "2015";
var prettyMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
var $D=document,$=function(n){return document.getElementById(n)};
var trackerVal,curYear = -1,curMonth = -1;
var yearTracker,monthTracker;
function showTrackers(val) {
  if (val===trackerVal) return;
  var $ipp=$("wm-ipp");
  var $y=$("displayYearEl"),$m=$("displayMonthEl"),$d=$("displayDayEl");
  if (val) {
    $ipp.className="hi";
  } else {
    $ipp.className="";
    $y.innerHTML=displayYear;$m.innerHTML=displayMonth;$d.innerHTML=displayDay;
  }
  yearTracker.style.display=val?"inline":"none";
  monthTracker.style.display=val?"inline":"none";
  trackerVal = val;
}
function trackMouseMove(event,element) {
  var eventX = getEventX(event);
  var elementX = getElementX(element);
  var xOff = Math.min(Math.max(0, eventX - elementX),imgWidth);
  var monthOff = xOff % yearImgWidth;

  var year = Math.floor(xOff / yearImgWidth);
  var monthOfYear = Math.min(11,Math.floor(monthOff / monthImgWidth));
  // 1 extra border pixel at the left edge of the year:
  var month = (year * 12) + monthOfYear;
  var day = monthOff % 2==1?15:1;
  var dateString = zeroPad(year + firstYear) + zeroPad(monthOfYear+1,2) +
    zeroPad(day,2) + "000000";

  $("displayYearEl").innerHTML=year+firstYear;
  $("displayMonthEl").innerHTML=prettyMonths[monthOfYear];
  // looks too jarring when it changes..
  //$("displayDayEl").innerHTML=zeroPad(day,2);
  var url = wbPrefix + dateString + '/' +  wbCurrentUrl;
  $("wm-graph-anchor").href=url;

  if(curYear != year) {
    var yrOff = year * yearImgWidth;
    yearTracker.style.left = yrOff + "px";
    curYear = year;
  }
  if(curMonth != month) {
    var mtOff = year + (month * monthImgWidth) + 1;
    monthTracker.style.left = mtOff + "px";
    curMonth = month;
  }
}
function hideToolbar() {
  $("wm-ipp").style.display="none";
}
function bootstrap() {
  var $spk=$("wm-ipp-sparkline");
  yearTracker=$D.createElement('div');
  yearTracker.className='yt';
  with(yearTracker.style){
    display='none';width=yearImgWidth+"px";height=imgHeight+"px";
  }
  monthTracker=$D.createElement('div');
  monthTracker.className='mt';
  with(monthTracker.style){
    display='none';width=monthImgWidth+"px";height=imgHeight+"px";
  }
  $spk.appendChild(yearTracker);
  $spk.appendChild(monthTracker);

  var $ipp=$("wm-ipp");
  $ipp&&disclaimElement($ipp);
}
return{st:showTrackers,mv:trackMouseMove,h:hideToolbar,bt:bootstrap};
})(525, 27, 25, 2);//]]>
</script>
<style type="text/css">
body {
  margin-top:0 !important;
  padding-top:0 !important;
  min-width:800px !important;
}
</style>
<div id="wm-ipp" lang="en" style="display:none;">

<div style="position:fixed;left:0;top:0;width:100%!important">
<div id="wm-ipp-inside">
   <table style="width:100%;"><tbody><tr>
   <td id="wm-logo">
       <a href="/web/" title="Wayback Machine home page"><img src="/static/images/toolbar/wayback-toolbar-logo.png" alt="Wayback Machine" width="110" height="39" border="0" /></a>
   </td>
   <td class="c">
       <table style="margin:0 auto;"><tbody><tr>
       <td class="u" colspan="2">
       <form target="_top" method="get" action="/web/form-submit.jsp" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="https://foundationdb.com/key-value-store/documentation/api-node.html" style="width:400px;" onfocus="this.focus();this.select();" /><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20150325003226" /><input type="submit" value="Go" /><span id="wm_tb_options" style="display:block;"></span></form>
       </td>
       <td class="n" rowspan="2">
           <table><tbody>
           <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
           <tr class="m">
           	<td class="b" nowrap="nowrap">
		
		    <a href="/web/20140828195022/https://foundationdb.com/key-value-store/documentation/api-node.html" title="28 Aug 2014">AUG</a>
		
		</td>
		<td class="c" id="displayMonthEl" title="You are here: 0:32:26 Mar 25, 2015">MAR</td>
		<td class="f" nowrap="nowrap">
		
		    <a href="/web/20150706060458/https://foundationdb.com/key-value-store/documentation/api-node.html" title="6 Jul 2015"><strong>JUL</strong></a>
		
                </td>
	    </tr>
           <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
           <tr class="d">
               <td class="b" nowrap="nowrap">
               
                   <a href="/web/20140828195022/https://foundationdb.com/key-value-store/documentation/api-node.html" title="19:50:22 Aug 28, 2014"><img src="/static/images/toolbar/wm_tb_prv_on.png" alt="Previous capture" width="14" height="16" border="0" /></a>
               
               </td>
               <td class="c" id="displayDayEl" style="width:34px;font-size:24px;" title="You are here: 0:32:26 Mar 25, 2015">25</td>
	       <td class="f" nowrap="nowrap">
               
		   <a href="/web/20150325010105/https://foundationdb.com/key-value-store/documentation/api-node.html" title="1:01:05 Mar 25, 2015"><img src="/static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a>
	       
	       </td>
           </tr>
           <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
           <tr class="y">
	       <td class="b" nowrap="nowrap">
               
                   2014
               
               </td>
               <td class="c" id="displayYearEl" title="You are here: 0:32:26 Mar 25, 2015">2015</td>
	       <td class="f" nowrap="nowrap">
               
                   2016
               
	       </td>
           </tr>
           </tbody></table>
       </td>
       </tr>
       <tr>
       <td class="s">
           <a class="t" href="/web/20150325003226*/https://foundationdb.com/key-value-store/documentation/api-node.html" title="See a list of every capture for this URL">6 captures</a>
           <div class="r" title="Timespan for captures of this URL">28 Aug 14 - 24 Sep 15</div>
       </td>
       <td class="k">
       <a href="" id="wm-graph-anchor">
       <div id="wm-ipp-sparkline" title="Explore captures for this URL">
	 <img id="sparklineImgId" alt="sparklines"
		 onmouseover="__wm.st(1)" onmouseout="__wm.st(0)"
		 onmousemove="__wm.mv(event,this)"
		 width="525"
		 height="27"
		 border="0"
		 src="/web/jsp/graph.jsp?graphdata=525_27_1996:-1:000000000000_1997:-1:000000000000_1998:-1:000000000000_1999:-1:000000000000_2000:-1:000000000000_2001:-1:000000000000_2002:-1:000000000000_2003:-1:000000000000_2004:-1:000000000000_2005:-1:000000000000_2006:-1:000000000000_2007:-1:000000000000_2008:-1:000000000000_2009:-1:000000000000_2010:-1:000000000000_2011:-1:000000000000_2012:-1:000000000000_2013:-1:000000000000_2014:-1:000000010000_2015:2:003000101000_2016:-1:000000000000" />
       </div>
       </a>
       </td>
       </tr></tbody></table>
   </td>
   <td class="r">
       <a href="#close" onclick="__wm.h();return false;" style="background-image:url(/static/images/toolbar/wm_tb_close.png);top:5px;" title="Close the toolbar">Close</a>
       <a href="http://faq.web.archive.org/" style="background-image:url(/static/images/toolbar/wm_tb_help.png);bottom:5px;" title="Get some help using the Wayback Machine">Help</a>
   </td>
   </tr></tbody></table>
</div>
</div>
</div>
<script type="text/javascript">__wm.bt();</script>
<!-- END WAYBACK TOOLBAR INSERT -->

<header id='header'>
<div class='container'>
<a href='/web/20150325003226/https://foundationdb.com/' id='logo'></a>
<a id='mobile-nav-toggle'><img alt="Hamburger" src="/web/20150325003226im_/https://d3glfbbr3jeumb.cloudfront.net/assets/icons/hamburger-bbd9560947385da4445b540086f10c9b.png" /></a>
<a id='mobile-auth-toggle'>
<i class='icon-user'></i>
</a>
<div id='auth-links'></div>
</div>
</header>
<nav id='nav'>
<div class='container'>
<ul>
<li class=''>
<a href="/web/20150325003226/https://foundationdb.com/"><span>H</span>ome</a>
</li>
<li class='active with-subnav'>
<a href="/web/20150325003226/https://foundationdb.com/key-value-store"><span>K</span>ey-Value Store</a>
<ul class='subnav'>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store">Overview</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation">Documentation</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/performance">Performance</a></li>
</ul>
</li>
<li class='with-subnav'>
<a href="/web/20150325003226/https://foundationdb.com/layers/sql"><span>S</span>QL Layer</a>
<ul class='subnav'>
<li><a href="/web/20150325003226/https://foundationdb.com/layers/sql">Overview</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/layers/sql/documentation">Documentation</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/layers/sql/performance">Performance</a></li>
</ul>
</li>
<li class='with-subnav'>
<a href="/web/20150325003226/https://foundationdb.com/community"><span>R</span>esources</a>
<ul class='subnav'>
<li><a href="/web/20150325003226/http://community.foundationdb.com/">Community</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/courses">Education</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/videos">Videos</a></li>
</ul>
</li>
<li class='with-subnav'>
<a href="/web/20150325003226/https://foundationdb.com/about"><span>C</span>ompany</a>
<ul class='subnav'>
<li><a href="/web/20150325003226/https://foundationdb.com/about">About Us</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/contact">Contact Us</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/jobs">Jobs</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id='flash'>
<div class='notice'></div>
<div class='alert'></div>
</div>
<div id='documentation-inner'>
<div id='docs-global-nav-content'>
<ul>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/index.html">Summary</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/getting-started.html">Getting Started</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/tutorials.html">Tutorials</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/developer-guide.html">Developer Guide</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/data-modeling.html">Data Modeling</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/recipes">Design Recipes</a></li>
<li>
<a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/api-reference.html">API Reference</a>
<ul>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/api-python.html">Python API</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/api-ruby.html">Ruby API</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/api-node.html" class="active">Node.js API</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/api-php.html">PHP API</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/javadoc/index.html">Java API</a></li>
<li><a href="/web/20150325003226/http://godoc.org/github.com/FoundationDB/fdb-go/fdb">Go API</a></li>
<li><a href="/web/20150325003226/https://github.com/Doxense/foundationdb-dotnet-client">.NET API</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/api-c.html">C API</a></li>
</ul>
</li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/building-cluster.html">Building a Cluster</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/configuration.html">Configuration</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/administration.html">Administration</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/command-line-interface.html">Command Line Interface</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/mr-status.html">Machine-Readable Status</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/tls.html">Transport Layer Security</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/backups.html">Backup and Restoration</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/known-limitations.html">Known Limitations</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/platforms.html">Platform Issues</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/release-notes.html">Release Notes</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/documentation/older">Older Versions</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/key-value-store/white-papers">White Papers</a></li>
</ul>
</div>

<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
  	URL_ROOT:    '',
  	VERSION:     '3.0.7',
  	COLLAPSE_INDEX: false,
  	FILE_SUFFIX: '.html',
  	HAS_SOURCE:  true
  };
</script>

<div id="breadcrumbs" class="container">
  <div id="breadcrumbs-inner">
    
    <a href="index.html">FoundationDB 3.0</a> &raquo;
    <a href="building-with-the-api.html">Building with the API</a> &raquo;
    <a href="api-reference.html">API Reference</a> &raquo;
    
    <a id="mobile-search-link" href="/web/20150325003226/https://foundationdb.com/documentation/latest/search.html">
      <img alt="Magnifying-glass" src="/web/20150325003226im_/https://d3glfbbr3jeumb.cloudfront.net/assets/icons/magnifying-glass-1e869de9fc6b47eca22fbd10a9d914a3.png" />
    </a>
  </div>
</div>
<div id="documentation" class="container">
  <div class="body sphinx">
    
  <div class="section" id="node-js-api">
<h1>Node.js API<a class="headerlink" href="#node-js-api" title="Permalink to this headline">∞</a></h1>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">∞</a></h2>
<p>The FoundationDB Node.js API is distributed as the <tt class="docutils literal"><span class="pre">fdb</span></tt> package at the <a class="reference external" href="/web/20150325003226/http://npmjs.org/">npm Registry</a>. For example, to install on Linux:</p>
<div class="highlight-javascript"><div class="highlight"><pre>user@host$ npm install fdb
</pre></div>
</div>
<p>The npm Registry documents the <a class="reference external" href="/web/20150325003226/https://npmjs.org/doc/install.html">npm install process</a> for both remote and local installations.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The Node.js package is not pure JavaScript. When installing from the npm Registry, your machine must have a minimum development environment for your platform. (For example, Linux and OS X require <tt class="docutils literal"><span class="pre">make</span></tt> and a C++ compiler. Windows requires Visual Studio 2012+.)</p>
</div>
<p>You can also download the FoundationDB Node.js API directly from <a class="reference external" href="/web/20150325003226/https://foundationdb.com/get">Get FoundationDB</a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For the language binding to function, FoundationDB client binaries whose version is at least as recent
must be installed. If you upgrade a language binding to a new version, you may need to upgrade the FoundationDB client binaries as well. See <a class="reference internal" href="api-general.html#installing-client-binaries"><em>Installing FoundationDB client binaries</em></a>.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you have a project with automatic dependency installation and have expressed a dependency on foundationdb, it may automatically install the lastest version of the language binding when you deploy your project to a new machine. If you have not also upgraded the Foundation client binary, an unplanned upgrade of the language binding may encounter an incompatibility. You should therefore configure any project dependency on foundationdb in coordination with your overall upgrade strategy.</p>
</div>
</div>
<div class="section" id="api-versioning">
<h2>API versioning<a class="headerlink" href="#api-versioning" title="Permalink to this headline">∞</a></h2>
<p>When you require the <tt class="docutils literal"><span class="pre">fdb</span></tt> module, it exposes only one useful symbol:</p>
<dl class="function">
<dt id="apiVersion">
<tt class="descname">apiVersion</tt><big>(</big><em>version</em><big>)</big><a class="headerlink" href="#apiVersion" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the FoundationDB module corresponding with a particular API version. This allows future versions of FoundationDB to make API changes without breaking existing programs. The current version of the API is 300.</p>
<blockquote>
<div><p>For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">fdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fdb&#39;</span><span class="p">).</span><span class="nx">apiVersion</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<div class="line-block">
<div class="line"><strong>Throws</strong> an error if the specified version is not supported.</div>
<div class="line"><strong>Throws</strong> an error if <tt class="docutils literal"><span class="pre">apiVersion</span></tt> has been called previously with a different version.</div>
</div>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You must call <tt class="docutils literal"><span class="pre">apiVersion(...)</span></tt> to get access to the fdb module.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">FoundationDB encapsulates multiple versions of its interface by requiring the client to explicitly specify the version of the API it uses. The purpose of this design is to allow you to upgrade the server, client libraries, or bindings without having to modify client code. The client libraries support all previous versions of the API. The API version specified by the client is used to control the behavior of the binding. You can therefore upgrade to more recent packages (and thus receive various improvements) without having to change your code.</p>
</div>
<p>For API changes between version 14 and 300 (for the purpose of porting older programs), see <a class="reference internal" href="release-notes.html"><em>Release Notes</em></a>.</p>
</div>
<div class="section" id="opening-a-database">
<h2>Opening a database<a class="headerlink" href="#opening-a-database" title="Permalink to this headline">∞</a></h2>
<p>After importing the <tt class="docutils literal"><span class="pre">fdb</span></tt> module and selecting an API version, you probably want to open a <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a>. The simplest way of doing this is using <a class="reference internal" href="#fdb.open" title="fdb.open"><tt class="xref js js-func docutils literal"><span class="pre">fdb.open()</span></tt></a></p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">fdb</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fdb&#39;</span><span class="p">).</span><span class="nx">apiVersion</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>
</pre></div>
</div>
<dl class="function">
<dt id="fdb.open">
<tt class="descclassname">fdb.</tt><tt class="descname">open</tt><big>(</big><span class="optional">[</span><em>clusterFile</em>, <em>dbName</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#fdb.open" title="Permalink to this definition">∞</a></dt>
<dd><p>Initializes the FoundationDB API, connects to the cluster specified by the <a class="reference internal" href="administration.html#foundationdb-cluster-file"><em>cluster file</em></a>, and opens the database with the specified name. This function is often called without any parameters, using only the defaults. If no cluster file is passed, FoundationDB automatically <a class="reference internal" href="administration.html#specifying-a-cluster-file"><em>determines a cluster file</em></a> with which to connect to a cluster.</p>
<p>Returns a <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a> object.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this release, dbName must be &#8220;DB&#8221;.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="docutils literal"><span class="pre">fdb.open()</span></tt> combines the effect of <a class="reference internal" href="#fdb.init" title="fdb.init"><tt class="xref js js-func docutils literal"><span class="pre">fdb.init()</span></tt></a>, <a class="reference internal" href="#fdb.createCluster" title="fdb.createCluster"><tt class="xref js js-func docutils literal"><span class="pre">fdb.createCluster()</span></tt></a>, and <a class="reference internal" href="#Cluster.openDatabase" title="Cluster.openDatabase"><tt class="xref js js-func docutils literal"><span class="pre">Cluster.openDatabase()</span></tt></a>.</p>
</div>
<p><strong>Throws</strong> an error if the network was unable to be initialized, the cluster could not be created, or the database could not be opened. However, a database that is unavailable does <em>not</em> cause an error to be thrown.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.init">
<tt class="descclassname">fdb.</tt><tt class="descname">init</tt><big>(</big><big>)</big><a class="headerlink" href="#fdb.init" title="Permalink to this definition">∞</a></dt>
<dd><p>Initializes the FoundationDB API, creating a thread for the FoundationDB client and initializing the client&#8217;s networking engine. <a class="reference internal" href="#fdb.init" title="fdb.init"><tt class="xref js js-func docutils literal"><span class="pre">fdb.init()</span></tt></a>  can only be called once. If called subsequently or after <a class="reference internal" href="#fdb.open" title="fdb.open"><tt class="xref js js-func docutils literal"><span class="pre">fdb.open()</span></tt></a> , it will raise a <tt class="docutils literal"><span class="pre">client_invalid_operation</span></tt> error.</p>
<p><strong>Throws</strong> an error if the network was unable to be initialized.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.createCluster">
<tt class="descclassname">fdb.</tt><tt class="descname">createCluster</tt><big>(</big><span class="optional">[</span><em>clusterFile</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#fdb.createCluster" title="Permalink to this definition">∞</a></dt>
<dd><p>Connects to the cluster specified by <a class="reference internal" href="administration.html#foundationdb-cluster-file"><em>clusterFile</em></a>, or by a <a class="reference internal" href="administration.html#default-cluster-file"><em>default cluster file</em></a> if <tt class="docutils literal"><span class="pre">clusterFile</span></tt> is null or undefined.</p>
<p>Returns a <a class="reference internal" href="#Cluster" title="Cluster"><tt class="xref js js-class docutils literal"><span class="pre">Cluster()</span></tt></a> object.</p>
<p><strong>Throws</strong> an error if the cluster could not be created.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.options">
<tt class="descclassname">fdb.</tt><tt class="descname">options</tt><a class="headerlink" href="#fdb.options" title="Permalink to this definition">∞</a></dt>
<dd><p>A singleton providing options which affect the entire FoundationDB client.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is an error to set these options after the first call to <a class="reference internal" href="#fdb.open" title="fdb.open"><tt class="xref js js-func docutils literal"><span class="pre">fdb.open()</span></tt></a> or <a class="reference internal" href="#fdb.init" title="fdb.init"><tt class="xref js js-func docutils literal"><span class="pre">fdb.init()</span></tt></a> anywhere in your application.</p>
</div>
<dl class="function">
<dt id="fdb.options.setTraceEnable">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTraceEnable</tt><big>(</big><em>outputDirectory</em><big>)</big><a class="headerlink" href="#fdb.options.setTraceEnable" title="Permalink to this definition">∞</a></dt>
<dd><p>Enables trace file generation on this FoundationDB client. Trace files will be generated in the specified output directory. If the directory is specified as <tt class="docutils literal"><span class="pre">null</span></tt> or <tt class="docutils literal"><span class="pre">undefined</span></tt>, then the output directory will be the current working directory.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The specified output directory must be unique to this client. In the present release, trace logging does not allow two clients to share a directory.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="fdb.options.setTraceMaxLogsSize">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTraceMaxLogsSize</tt><big>(</big><em>bytes</em><big>)</big><a class="headerlink" href="#fdb.options.setTraceMaxLogsSize" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the maximum size in bytes for the sum of this FoundationDB client&#8217;s trace output files in a single log directory.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.options.setTraceRollSize">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTraceRollSize</tt><big>(</big><em>bytes</em><big>)</big><a class="headerlink" href="#fdb.options.setTraceRollSize" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the maximum size in bytes of a single trace output file for this FoundationDB client.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The following options are only used when connecting to a <a class="reference internal" href="tls.html"><em>TLS-enabled cluster</em></a>.</p>
</div>
<dl class="function">
<dt id="fdb.options.setTLSPlugin">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTLSPlugin</tt><big>(</big><em>pluginPathOrName</em><big>)</big><a class="headerlink" href="#fdb.options.setTLSPlugin" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the <a class="reference internal" href="tls.html#configuring-tls-plugin"><em>TLS plugin</em></a> to load. This option, if used, must be set before any other TLS options.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.options.setTLSCertPath">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTLSCertPath</tt><big>(</big><em>pathToFile</em><big>)</big><a class="headerlink" href="#fdb.options.setTLSCertPath" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the path for the file from which the <a class="reference internal" href="tls.html#tls-certificate-file"><em>certificate chain</em></a> will be loaded.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.options.setTLSKeyPath">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTLSKeyPath</tt><big>(</big><em>pathToFile</em><big>)</big><a class="headerlink" href="#fdb.options.setTLSKeyPath" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the path for the file from which to load the <a class="reference internal" href="tls.html#tls-key-file"><em>private key</em></a> corresponding to your own certificate.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.options.setTLSVerifyPeers">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTLSVerifyPeers</tt><big>(</big><em>criteria</em><big>)</big><a class="headerlink" href="#fdb.options.setTLSVerifyPeers" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the <a class="reference internal" href="tls.html#tls-verify-peers"><em>peer certificate field verification criteria</em></a>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.options.setTLSCertBytes">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTLSCertBytes</tt><big>(</big><em>bytes</em><big>)</big><a class="headerlink" href="#fdb.options.setTLSCertBytes" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the certificate chain.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.options.setTLSKeyBytes">
<tt class="descclassname">fdb.options.</tt><tt class="descname">setTLSKeyBytes</tt><big>(</big><em>bytes</em><big>)</big><a class="headerlink" href="#fdb.options.setTLSKeyBytes" title="Permalink to this definition">∞</a></dt>
<dd><p>Set the private key corresponding to your own certificate.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="cluster-objects">
<h2>Cluster objects<a class="headerlink" href="#cluster-objects" title="Permalink to this headline">∞</a></h2>
<dl class="class">
<dt id="Cluster">
<em class="property">class </em><tt class="descname">Cluster</tt><big>(</big><big>)</big><a class="headerlink" href="#Cluster" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="Cluster.openDatabase">
<tt class="descclassname">Cluster.</tt><tt class="descname">openDatabase</tt><big>(</big><span class="optional">[</span><em>name=&quot;DB&quot;</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Cluster.openDatabase" title="Permalink to this definition">∞</a></dt>
<dd><blockquote>
<div><p>Opens a database with the given name.</p>
<p>Returns a <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a> object.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In this release, name <strong>must</strong> be &#8220;DB&#8221;.</p>
</div>
</div></blockquote>
<p><strong>Throws</strong> an error if the database could not be opened.</p>
</dd></dl>

</div>
<div class="section" id="keys-and-values">
<span id="datatypes"></span><span id="api-node-keys"></span><h2>Keys and values<a class="headerlink" href="#keys-and-values" title="Permalink to this headline">∞</a></h2>
<p>Keys and values in FoundationDB are byte arrays stored in <a class="reference external" href="/web/20150325003226/http://nodejs.org/api/buffer.html">Node.js Buffers</a>. Functions which take keys and values as arguments can also accept JavaScript strings, which will be encoded using the UTF-8 encoding, or ArrayBuffers. The <tt class="docutils literal"><span class="pre">fdb</span></tt> module also provides some convenience methods for converting to and from Buffers in <a class="reference internal" href="#fdb.buffer" title="fdb.buffer"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.buffer</span></tt></a>.</p>
<p>To encode other data types, see <a class="reference internal" href="data-modeling.html#encoding-data-types"><em>Encoding data types</em></a> and the <a class="reference internal" href="#api-node-tuple-layer"><em>tuple layer</em></a>.</p>
<div class="section" id="asfoundationdbkey-and-asfoundationdbvalue">
<h3><tt class="docutils literal"><span class="pre">asFoundationDBKey</span></tt> and <tt class="docutils literal"><span class="pre">asFoundationDBValue</span></tt><a class="headerlink" href="#asfoundationdbkey-and-asfoundationdbvalue" title="Permalink to this headline">∞</a></h3>
<p>In some cases, you may have objects that are used to <em>represent</em> specific keys or values (for example, see <a class="reference internal" href="#fdb.Subspace" title="fdb.Subspace"><tt class="xref js js-class docutils literal"><span class="pre">Subspace</span></tt></a>). As a convenience, the language binding API can work seamlessly with such objects if they implement the <tt class="xref js js-func docutils literal"><span class="pre">asFoundationDBKey()</span></tt> or <tt class="xref js js-func docutils literal"><span class="pre">asFoundationDBValue()</span></tt> methods, respectively. API methods that accept a key will alternately accept an object that implements the <tt class="xref js js-func docutils literal"><span class="pre">asFoundationDBKey()</span></tt> method. Likewise, API methods accepting a value will also accept an object that implements the <tt class="xref js js-func docutils literal"><span class="pre">asFoundationDBValue()</span></tt> method.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last"><tt class="xref js js-func docutils literal"><span class="pre">asFoundationDBKey()</span></tt> and <tt class="xref js js-func docutils literal"><span class="pre">asFoundationDBValue()</span></tt> are not intended to implement serialization protocols for object storage. Use these functions only when your object represents a specific key or value.</p>
</div>
</div>
</div>
<div class="section" id="buffer-conversion">
<h2>Buffer conversion<a class="headerlink" href="#buffer-conversion" title="Permalink to this headline">∞</a></h2>
<p>FoundationDB uses Node.js Buffers for all <a class="reference internal" href="#datatypes"><em>keys and values</em></a>. The <tt class="docutils literal"><span class="pre">fdb.buffer</span></tt> functions provide some utilities for converting other data types to and from Node.js Buffers.</p>
<dl class="function">
<dt id="fdb.buffer">
<tt class="descclassname">fdb.</tt><tt class="descname">buffer</tt><big>(</big><em>obj</em><big>)</big><a class="headerlink" href="#fdb.buffer" title="Permalink to this definition">∞</a></dt>
<dd><p>Converts <tt class="docutils literal"><span class="pre">obj</span></tt> to a Node.js Buffer, assuming it is of an appropriate type. This is called automatically for any key or value passed to the <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> functions. The supported types are:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Buffer</span></tt> - <tt class="docutils literal"><span class="pre">obj</span></tt> is returned unchanged</li>
<li><tt class="docutils literal"><span class="pre">ArrayBuffer</span></tt> - <tt class="docutils literal"><span class="pre">obj</span></tt> is copied to a new <tt class="docutils literal"><span class="pre">Buffer</span></tt></li>
<li><tt class="docutils literal"><span class="pre">Uint8Array</span></tt> - <tt class="docutils literal"><span class="pre">obj</span></tt> is copied to a new <tt class="docutils literal"><span class="pre">Buffer</span></tt></li>
<li><tt class="docutils literal"><span class="pre">string</span></tt> - <tt class="docutils literal"><span class="pre">obj</span></tt> is encoded using UTF-8 and returned as a <tt class="docutils literal"><span class="pre">Buffer</span></tt></li>
</ul>
</dd></dl>

<dl class="function">
<dt id="fdb.buffer.fromByteLiteral">
<tt class="descclassname">fdb.buffer.</tt><tt class="descname">fromByteLiteral</tt><big>(</big><em>str</em><big>)</big><a class="headerlink" href="#fdb.buffer.fromByteLiteral" title="Permalink to this definition">∞</a></dt>
<dd><p>Attempts to interpret the string <tt class="docutils literal"><span class="pre">str</span></tt> as a byte-literal string by converting each character to its one-byte character code using <tt class="docutils literal"><span class="pre">str.charCodeAt()</span></tt>. Returns the result as a Node.js <tt class="docutils literal"><span class="pre">Buffer</span></tt>.</p>
<p><strong>Throws</strong> an error if <tt class="docutils literal"><span class="pre">str</span></tt> contains any multi-byte characters.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This should not be used for encoding unicode strings. Instead, use <tt class="docutils literal"><span class="pre">new</span> <span class="pre">Buffer(str)</span></tt> or consider using the <a class="reference internal" href="#fdb.tuple" title="fdb.tuple"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.tuple</span></tt></a> layer.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="fdb.buffer.toByteLiteral">
<tt class="descclassname">fdb.buffer.</tt><tt class="descname">toByteLiteral</tt><big>(</big><em>buffer</em><big>)</big><a class="headerlink" href="#fdb.buffer.toByteLiteral" title="Permalink to this definition">∞</a></dt>
<dd><p>Converts a Node.js <tt class="docutils literal"><span class="pre">Buffer</span></tt> to a byte-literal string by converting each byte to a character using <tt class="docutils literal"><span class="pre">String.fromCharCode()</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This should not be used for decoding unicode strings. Instead, use <tt class="docutils literal"><span class="pre">buffer.toString()</span></tt> or consider using the <a class="reference internal" href="#fdb.tuple" title="fdb.tuple"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.tuple</span></tt></a> layer.</p>
</div>
</dd></dl>

</div>
<div class="section" id="key-value-pairs">
<span id="keyvaluepairs"></span><h2>Key-value pairs<a class="headerlink" href="#key-value-pairs" title="Permalink to this headline">∞</a></h2>
<dl class="class">
<dt id="KeyValuePair">
<em class="property">class </em><tt class="descname">KeyValuePair</tt><big>(</big><big>)</big><a class="headerlink" href="#KeyValuePair" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p>A class that holds the key and value of a single entry in the database. Each of the <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> range query function returns a <a class="reference internal" href="#LazyIterator" title="LazyIterator"><tt class="xref js js-class docutils literal"><span class="pre">LazyIterator()</span></tt></a> of key-value pairs.</p>
<dl class="attribute">
<dt id="key">
<tt class="descname">key</tt><a class="headerlink" href="#key" title="Permalink to this definition">∞</a></dt>
<dd><p>A <a class="reference internal" href="#datatypes"><em>Buffer</em></a> containing the key.</p>
</dd></dl>

<dl class="attribute">
<dt id="value">
<tt class="descname">value</tt><a class="headerlink" href="#value" title="Permalink to this definition">∞</a></dt>
<dd><p>A <a class="reference internal" href="#datatypes"><em>Buffer</em></a> containing the value.</p>
</dd></dl>

</div>
<div class="section" id="key-selectors">
<h2>Key selectors<a class="headerlink" href="#key-selectors" title="Permalink to this headline">∞</a></h2>
<p>FoundationDB&#8217;s lexicographically ordered data model permits finding keys based on their order (for example, finding the first key in the database greater than a given key). Key selectors represent a description of a key in the database that could be resolved to an actual key by <a class="reference internal" href="#Transaction.getKey" title="Transaction.getKey"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getKey()</span></tt></a> or used directly as the beginning or end of a range in <a class="reference internal" href="#Transaction.getRange" title="Transaction.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRange()</span></tt></a>.</p>
<p>For more about how key selectors work, see <a class="reference internal" href="developer-guide.html#key-selectors"><em>Key selectors</em></a>.</p>
<dl class="class">
<dt id="fdb.KeySelector">
<em class="property">class </em><tt class="descclassname">fdb.</tt><tt class="descname">KeySelector</tt><big>(</big><em>key</em>, <em>orEqual</em>, <em>offset</em><big>)</big><a class="headerlink" href="#fdb.KeySelector" title="Permalink to this definition">∞</a></dt>
<dd><p>Creates a key selector with the given reference <a class="reference internal" href="#datatypes"><em>key</em></a>, equality flag, and offset. It is usually more convenient to obtain a key selector with one of the following methods:</p>
<dl class="function">
<dt id="fdb.KeySelector.lastLessThan">
<tt class="descclassname">fdb.KeySelector.</tt><tt class="descname">lastLessThan</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#fdb.KeySelector.lastLessThan" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key selector referencing the last (greatest) key in the database less than the specified <a class="reference internal" href="#datatypes"><em>key</em></a>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.KeySelector.lastLessOrEqual">
<tt class="descclassname">fdb.KeySelector.</tt><tt class="descname">lastLessOrEqual</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#fdb.KeySelector.lastLessOrEqual" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key selector referencing the last (greatest) key less than or equal to the specified <a class="reference internal" href="#datatypes"><em>key</em></a>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.KeySelector.firstGreaterThan">
<tt class="descclassname">fdb.KeySelector.</tt><tt class="descname">firstGreaterThan</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#fdb.KeySelector.firstGreaterThan" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key selector referencing the first (least) key greater than the specified <a class="reference internal" href="#datatypes"><em>key</em></a>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.KeySelector.firstGreaterOrEqual">
<tt class="descclassname">fdb.KeySelector.</tt><tt class="descname">firstGreaterOrEqual</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#fdb.KeySelector.firstGreaterOrEqual" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key selector referencing the first key greater than or equal to the specified <a class="reference internal" href="#datatypes"><em>key</em></a>.</p>
</dd></dl>

</dd></dl>

<p><tt class="docutils literal"><span class="pre">KeySelector</span></tt> objects have the following members:</p>
<dl class="function">
<dt id="KeySelector.next">
<tt class="descclassname">KeySelector.</tt><tt class="descname">next</tt><big>(</big><big>)</big><a class="headerlink" href="#KeySelector.next" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key selector referencing the key after the one referenced by this key selector.</p>
</dd></dl>

<dl class="function">
<dt id="KeySelector.prev">
<tt class="descclassname">KeySelector.</tt><tt class="descname">prev</tt><big>(</big><big>)</big><a class="headerlink" href="#KeySelector.prev" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key selector referencing the key before the one referenced by this key selector.</p>
</dd></dl>

<dl class="function">
<dt id="KeySelector.add">
<tt class="descclassname">KeySelector.</tt><tt class="descname">add</tt><big>(</big><em>addOffset</em><big>)</big><a class="headerlink" href="#KeySelector.add" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key selector referencing the key with offset <tt class="docutils literal"><span class="pre">addOffset</span></tt> relative to this one.</p>
</dd></dl>

</div>
<div class="section" id="database-objects">
<h2>Database objects<a class="headerlink" href="#database-objects" title="Permalink to this headline">∞</a></h2>
<dl class="class">
<dt id="Database">
<em class="property">class </em><tt class="descname">Database</tt><big>(</big><big>)</big><a class="headerlink" href="#Database" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p>A <tt class="docutils literal"><span class="pre">Database</span></tt> represents a FoundationDB database &#8212; a mutable, lexicographically ordered mapping from binary keys to binary values. Although <tt class="docutils literal"><span class="pre">Database</span></tt> provides convenience methods for reading and writing, modifications to a database are usually via transactions, which are usually created and committed automatically by <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a>.</p>
<dl class="function">
<dt id="Database.doTransaction">
<tt class="descclassname">Database.</tt><tt class="descname">doTransaction</tt><big>(</big><em>func</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.doTransaction" title="Permalink to this definition">∞</a></dt>
<dd><p>Executes the provided function <tt class="docutils literal"><span class="pre">func</span></tt> with a new transaction, commits the transaction, retries the function as necessary in response to retryable database errors, and calls <tt class="docutils literal"><span class="pre">callback</span></tt> with the result produced by <tt class="docutils literal"><span class="pre">func</span></tt>. This is the recommended way to do operations transactionally.</p>
<p><tt class="docutils literal"><span class="pre">func</span></tt> must take a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> as its first argument and an inner <a class="reference internal" href="#callbacks"><em>callback</em></a> as its second argument.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the <tt class="docutils literal"><span class="pre">callback</span></tt> passed to <tt class="xref js js-func docutils literal"><span class="pre">doTransaction()</span></tt> and the inner callback passed to <tt class="docutils literal"><span class="pre">func</span></tt> are distinct.</p>
</div>
<p><tt class="docutils literal"><span class="pre">Database.doTransaction</span></tt> is asynchronous. When the transaction has been committed, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the result produced by <tt class="docutils literal"><span class="pre">func</span></tt>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result. Without suppling a <tt class="docutils literal"><span class="pre">callback</span></tt> to <tt class="xref js js-func docutils literal"><span class="pre">doTransaction()</span></tt> or its resulting future, the calling code cannot determine if the transaction resulted in an error or even finished.</p>
<p>The inner callback passed to <tt class="docutils literal"><span class="pre">func</span></tt> must be called for the transaction to commit or retry on errors. In particular, this inner callback requires the following:</p>
<ul class="simple">
<li>Any FoundationDB API error encountered within <tt class="docutils literal"><span class="pre">func</span></tt> must be passed to the inner callback as its first argument. Calling the inner callback with any other error will cancel the transaction and pass the error to the outer level.</li>
<li>If no errors are encountered, then any result produced by <tt class="docutils literal"><span class="pre">func</span></tt> must be passed to the inner callback as its second argument. If <tt class="docutils literal"><span class="pre">func</span></tt> is not intended to produce a result, the inner callback must be called with no arguments.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In some failure scenarios, it is possible that your transaction will be executed twice. See <a class="reference internal" href="developer-guide.html#developer-guide-unknown-results"><em>Transactions with unknown results</em></a> for more information.</p>
</div>
<p>Here is an example of the use of <tt class="xref js js-func docutils literal"><span class="pre">doTransaction()</span></tt>, where <tt class="docutils literal"><span class="pre">db</span></tt> is a <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">db</span><span class="p">.</span><span class="nx">doTransaction</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">tr</span><span class="p">,</span> <span class="nx">innerCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">tr</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>

        <span class="c1">//Errors must be passed back to the callback for retry logic to work!</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">innerCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

        <span class="nx">tr</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
        <span class="nx">innerCallback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;transaction failed: &#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;finished transaction: &#39;</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The above will get the value at key <tt class="docutils literal"><span class="pre">'a'</span></tt> and set it at key <tt class="docutils literal"><span class="pre">'b'</span></tt> in the database. Once the transaction has committed, it will print &#8216;finished transaction: &lt;value&gt;&#8217;.</p>
<p>Functions can be made to automatically invoke <tt class="xref js js-func docutils literal"><span class="pre">doTransaction()</span></tt> by using the <a class="reference internal" href="#fdb.transactional" title="fdb.transactional"><tt class="xref js js-func docutils literal"><span class="pre">fdb.transactional()</span></tt></a> function.</p>
</dd></dl>

<dl class="function">
<dt id="Database.createTransaction">
<tt class="descclassname">Database.</tt><tt class="descname">createTransaction</tt><big>(</big><big>)</big><a class="headerlink" href="#Database.createTransaction" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a new <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> object.  Consider using the <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> or <a class="reference internal" href="#fdb.transactional" title="fdb.transactional"><tt class="xref js js-func docutils literal"><span class="pre">fdb.transactional()</span></tt></a> functions to create transactions instead, since they will automatically provide you with appropriate retry behavior.</p>
<p><strong>Throws</strong> an error if the transaction could not be created.</p>
</dd></dl>

<dl class="function">
<dt id="Database.get">
<tt class="descclassname">Database.</tt><tt class="descname">get</tt><big>(</big><em>key</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.get" title="Permalink to this definition">∞</a></dt>
<dd><p>Gets a value associated with the specified <a class="reference internal" href="#datatypes"><em>key</em></a> in the database. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with a Buffer containing the requested value or <tt class="docutils literal"><span class="pre">null</span></tt> if the key does not exist. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Database.getKey">
<tt class="descclassname">Database.</tt><tt class="descname">getKey</tt><big>(</big><em>keySelector</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.getKey" title="Permalink to this definition">∞</a></dt>
<dd><p>Gets the key referenced by the specified <a class="reference internal" href="#fdb.KeySelector" title="fdb.KeySelector"><tt class="xref js js-class docutils literal"><span class="pre">KeySelector()</span></tt></a>. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>The key is cached, providing a potential performance benefit. However, the
value of the key is also retrieved, using network bandwidth.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with a Buffer containing the requested key. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Database.getRange">
<tt class="descclassname">Database.</tt><tt class="descname">getRange</tt><big>(</big><em>begin</em>, <em>end</em><span class="optional">[</span>, <em>options</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.getRange" title="Permalink to this definition">∞</a></dt>
<dd><p>Gets all keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <tt class="docutils literal"><span class="pre">begin</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">end</span></tt> and their associated values as an array of <a class="reference internal" href="#keyvaluepairs"><em>key-value pairs</em></a>. Note the exclusion of <tt class="docutils literal"><span class="pre">end</span></tt> from the range. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>Each of <tt class="docutils literal"><span class="pre">begin</span></tt> and <tt class="docutils literal"><span class="pre">end</span></tt> may be a <a class="reference internal" href="#datatypes"><em>key</em></a> or a <a class="reference internal" href="#fdb.KeySelector" title="fdb.KeySelector"><tt class="xref js js-class docutils literal"><span class="pre">KeySelector()</span></tt></a>. Note that in the case of a <tt class="xref js js-class docutils literal"><span class="pre">KeySelector()</span></tt>, the exclusion of <tt class="docutils literal"><span class="pre">end</span></tt> from the range still applies.</p>
<p>If the <tt class="docutils literal"><span class="pre">options</span></tt> object is specified, it can have the following optional parameters:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">options.limit</span></tt></dt>
<dd>Only the first <tt class="docutils literal"><span class="pre">limit</span></tt> keys (and their values) in the range will be returned. If unspecified, defaults to having no limit.</dd>
<dt><tt class="docutils literal"><span class="pre">options.reverse</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">true</span></tt>, then the keys in the range will be returned in reverse order. If unspecified, defaults to <tt class="docutils literal"><span class="pre">false</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">options.streamingMode</span></tt></dt>
<dd>A value from <a class="reference internal" href="#fdb.streamingMode" title="fdb.streamingMode"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode</span></tt></a> which provides a hint to FoundationDB about how to retrieve the specified range. This option should generally not be specified, allowing FoundationDB to retrieve the full range very efficiently.</dd>
</dl>
</div></blockquote>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with an array containing the requested <a class="reference internal" href="#keyvaluepairs"><em>key-value pairs</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Database.getRangeStartsWith">
<tt class="descclassname">Database.</tt><tt class="descname">getRangeStartsWith</tt><big>(</big><em>prefix</em><span class="optional">[</span>, <em>options</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.getRangeStartsWith" title="Permalink to this definition">∞</a></dt>
<dd><p>Gets all keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <tt class="docutils literal"><span class="pre">k</span></tt> begins with <a class="reference internal" href="#datatypes"><em>keyPrefix</em></a>, and their associated values, as an array of <a class="reference internal" href="#keyvaluepairs"><em>key-value pairs</em></a>. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>If the <tt class="docutils literal"><span class="pre">options</span></tt> object is specified, it can have the following optional parameters:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">options.limit</span></tt></dt>
<dd>Only the first <tt class="docutils literal"><span class="pre">limit</span></tt> keys (and their values) in the range will be returned. If unspecified, defaults to having no limit.</dd>
<dt><tt class="docutils literal"><span class="pre">options.reverse</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">true</span></tt>, then the keys in the range will be returned in reverse order. If unspecified, defaults to <tt class="docutils literal"><span class="pre">false</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">options.streamingMode</span></tt></dt>
<dd>A value from <a class="reference internal" href="#fdb.streamingMode" title="fdb.streamingMode"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode</span></tt></a> which provides a hint to FoundationDB about how to retrieve the specified range. This option should generally not be specified, allowing FoundationDB to retrieve the full range very efficiently.</dd>
</dl>
</div></blockquote>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with an array containing the requested <a class="reference internal" href="#keyvaluepairs"><em>key-value pairs</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Database.set">
<tt class="descclassname">Database.</tt><tt class="descname">set</tt><big>(</big><em>key</em>, <em>value</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.set" title="Permalink to this definition">∞</a></dt>
<dd><p>Associates the given <a class="reference internal" href="#datatypes"><em>key</em></a> and <a class="reference internal" href="#datatypes"><em>value</em></a> and commits the result.  Overwrites any prior value associated with <tt class="docutils literal"><span class="pre">key</span></tt>. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called once the transaction has been committed. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to wait for completion.</p>
</dd></dl>

<dl class="function">
<dt id="Database.clear">
<tt class="descclassname">Database.</tt><tt class="descname">clear</tt><big>(</big><em>key</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.clear" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes the specified <a class="reference internal" href="#datatypes"><em>key</em></a> (and any associated value) if it exists and commits the result. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called once the transaction has been committed. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to wait for completion.</p>
</dd></dl>

<dl class="function">
<dt id="Database.clearRange">
<tt class="descclassname">Database.</tt><tt class="descname">clearRange</tt><big>(</big><em>begin</em>, <em>end</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.clearRange" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes all keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <a class="reference internal" href="#datatypes"><em>begin</em></a> &lt;= k &lt; <a class="reference internal" href="#datatypes"><em>end</em></a>, and their associated values, and commits the result. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike in the case of <a class="reference internal" href="#Database.getRange" title="Database.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Database.getRange()</span></tt></a>, <tt class="docutils literal"><span class="pre">begin</span></tt> and <tt class="docutils literal"><span class="pre">end</span></tt> must be <a class="reference internal" href="#datatypes"><em>keys</em></a>, not <a class="reference internal" href="#fdb.KeySelector" title="fdb.KeySelector"><tt class="xref js js-class docutils literal"><span class="pre">KeySelector()s</span></tt></a>.</p>
</div>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called once the transaction has been committed. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to wait for completion.</p>
</dd></dl>

<dl class="function">
<dt id="Database.clearRangeStartsWith">
<tt class="descclassname">Database.</tt><tt class="descname">clearRangeStartsWith</tt><big>(</big><em>prefix</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.clearRangeStartsWith" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes all the keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <tt class="docutils literal"><span class="pre">k</span></tt> begins with <a class="reference internal" href="#datatypes"><em>keyPrefix</em></a>, and their associated values, and commits the result. This operation will be executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called once the transaction has been committed. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to wait for completion.</p>
</dd></dl>

<dl class="function">
<dt id="Database.getAndWatch">
<tt class="descclassname">Database.</tt><tt class="descname">getAndWatch</tt><big>(</big><em>key</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.getAndWatch" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns an object <tt class="docutils literal"><span class="pre">{value,</span> <span class="pre">watch}</span></tt>, where <tt class="docutils literal"><span class="pre">value</span></tt> is the value associated with <tt class="docutils literal"><span class="pre">key</span></tt> or <tt class="docutils literal"><span class="pre">null</span></tt> if the key does not exist, and <tt class="docutils literal"><span class="pre">watch</span></tt> is a <a class="reference internal" href="#nodefutures"><em>future</em></a> that will become ready after <tt class="docutils literal"><span class="pre">value</span></tt> changes.</p>
<p>See <a class="reference internal" href="#Transaction.watch" title="Transaction.watch"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.watch()</span></tt></a> for a general description of watches and their limitations.</p>
<p>This function is asynchronous. When the watch has been committed, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with an object <tt class="docutils literal"><span class="pre">{value,</span> <span class="pre">watch}</span></tt> containing the value stored at <tt class="docutils literal"><span class="pre">key</span></tt> along with the watch <a class="reference internal" href="#nodefutures"><em>future</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<span class="target" id="api-node-setandwatch"></span><dl class="function">
<dt id="Database.setAndWatch">
<tt class="descclassname">Database.</tt><tt class="descname">setAndWatch</tt><big>(</big><em>key</em>, <em>value</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.setAndWatch" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets <tt class="docutils literal"><span class="pre">key</span></tt> to <tt class="docutils literal"><span class="pre">value</span></tt> and returns an object <tt class="docutils literal"><span class="pre">{watch}</span></tt>, where <tt class="docutils literal"><span class="pre">watch</span></tt> is a <a class="reference internal" href="#nodefutures"><em>future</em></a> that will become ready after a subsequent change to <tt class="docutils literal"><span class="pre">value</span></tt>.</p>
<p>See <a class="reference internal" href="#Transaction.watch" title="Transaction.watch"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.watch()</span></tt></a> for a general description of watches and their limitations.</p>
<p>This function is asynchronous. When the watch has been committed, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with an object <tt class="docutils literal"><span class="pre">{watch}</span></tt> containing the watch <a class="reference internal" href="#nodefutures"><em>future</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Database.clearAndWatch">
<tt class="descclassname">Database.</tt><tt class="descname">clearAndWatch</tt><big>(</big><em>key</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Database.clearAndWatch" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes <tt class="docutils literal"><span class="pre">key</span></tt> (and any associated value) if it exists and returns an object <tt class="docutils literal"><span class="pre">{watch}</span></tt>, where <tt class="docutils literal"><span class="pre">watch</span></tt> is a <a class="reference internal" href="#nodefutures"><em>future</em></a> that will become ready after the value is subsequently set.</p>
<p>See <a class="reference internal" href="#Transaction.watch" title="Transaction.watch"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.watch()</span></tt></a> for a general description of watches and their limitations.</p>
<p>This function is asynchronous. When the watch has been committed, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with an object <tt class="docutils literal"><span class="pre">{watch}</span></tt> containing the watch <a class="reference internal" href="#nodefutures"><em>future</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Database.add">
<tt class="descclassname">Database.</tt><tt class="descname">add</tt><big>(</big><em>key</em>, <em>param</em>, <em>callback</em><big>)</big><a class="headerlink" href="#Database.add" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="Database.bit_and">
<tt class="descclassname">Database.</tt><tt class="descname">bit_and</tt><big>(</big><em>key</em>, <em>param</em>, <em>callback</em><big>)</big><a class="headerlink" href="#Database.bit_and" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="Database.bit_or">
<tt class="descclassname">Database.</tt><tt class="descname">bit_or</tt><big>(</big><em>key</em>, <em>param</em>, <em>callback</em><big>)</big><a class="headerlink" href="#Database.bit_or" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="Database.bit_xor">
<tt class="descclassname">Database.</tt><tt class="descname">bit_xor</tt><big>(</big><em>key</em>, <em>param</em>, <em>callback</em><big>)</big><a class="headerlink" href="#Database.bit_xor" title="Permalink to this definition">∞</a></dt>
<dd><p>Executes the <a class="reference internal" href="#api-node-transaction-atomic-operations"><em>associated atomic operation</em></a> on a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> and commits the result. These operations are each executed in a <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> error retry loop.</p>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called once the transaction has been committed. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to wait for completion.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that since some atomic operations are not idempotent, the implicit use of <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> could interact with a <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>commit_unknown_result</em></a> error in unpredictable ways. For more information, see <a class="reference internal" href="developer-guide.html#developer-guide-unknown-results"><em>Transactions with unknown results</em></a>.</p>
</div>
</dd></dl>

<div class="section" id="database-options">
<h3>Database options<a class="headerlink" href="#database-options" title="Permalink to this headline">∞</a></h3>
<p>Database options alter the behavior of FoundationDB databases.</p>
<dl class="function">
<dt id="Database.options.setLocationCacheSize">
<tt class="descclassname">Database.options.</tt><tt class="descname">setLocationCacheSize</tt><big>(</big><em>size</em><big>)</big><a class="headerlink" href="#Database.options.setLocationCacheSize" title="Permalink to this definition">∞</a></dt>
<dd><p>Set the size of the client location cache. Raising this value can boost performance in very large databases where clients access data in a near-random pattern. This value must be an integer in the range [0, 2<sup>31</sup>-1]. Defaults to 100000.</p>
</dd></dl>

<dl class="function">
<dt id="Database.options.setMaxWatches">
<tt class="descclassname">Database.options.</tt><tt class="descname">setMaxWatches</tt><big>(</big><em>maxWatches</em><big>)</big><a class="headerlink" href="#Database.options.setMaxWatches" title="Permalink to this definition">∞</a></dt>
<dd><p>Set the maximum number of watches allowed to be outstanding on a database connection. Increasing this number could result in increased resource usage. Reducing this number will not cancel any outstanding watches. Defaults to 10000 and cannot be larger than 1000000.</p>
</dd></dl>

<dl class="function">
<dt id="Database.options.setMachineId">
<tt class="descclassname">Database.options.</tt><tt class="descname">setMachineId</tt><big>(</big><em>id</em><big>)</big><a class="headerlink" href="#Database.options.setMachineId" title="Permalink to this definition">∞</a></dt>
<dd><p>Specify the machine ID of a server to be preferentially used for database operations. ID must be a string of up to 16 hexadecimal digits that was used to configure <a class="reference internal" href="configuration.html#foundationdb-conf-fdbserver"><em>fdbserver processes</em></a>. Load balancing uses this option for location-awareness, attempting to send database operations first to servers on a specified machine, then a specified datacenter, then returning to its default algorithm.</p>
</dd></dl>

<dl class="function">
<dt id="Database.options.setDatacenterId">
<tt class="descclassname">Database.options.</tt><tt class="descname">setDatacenterId</tt><big>(</big><em>id</em><big>)</big><a class="headerlink" href="#Database.options.setDatacenterId" title="Permalink to this definition">∞</a></dt>
<dd><p>Specify the datacenter ID to be preferentially used for database operations. ID must be a string of up to 16 hexadecimal digits that was used to configure <a class="reference internal" href="configuration.html#foundationdb-conf-fdbserver"><em>fdbserver processes</em></a>. Load balancing uses this option for location-awareness, attempting to send database operations first to servers on a specified machine, then a specified datacenter, then returning to its default algorithm.</p>
</dd></dl>

</div>
</div>
<div class="section" id="transactional-decoration">
<h2>Transactional decoration<a class="headerlink" href="#transactional-decoration" title="Permalink to this headline">∞</a></h2>
<dl class="function">
<dt id="fdb.transactional">
<tt class="descclassname">fdb.</tt><tt class="descname">transactional</tt><big>(</big><em>func</em><big>)</big><a class="headerlink" href="#fdb.transactional" title="Permalink to this definition">∞</a></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">fdb.transactional</span></tt> decorator wraps a function <tt class="docutils literal"><span class="pre">func</span></tt> with logic to automatically create a transaction and retry until success, producing a transactional function.</p>
<p>Here is an example use:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">//Gets the value at key1 and sets it at key2. Returns the value that was set</span>
<span class="kd">var</span> <span class="nx">transactionalFunction</span> <span class="o">=</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">transactional</span><span class="p">(</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">tr</span><span class="p">,</span> <span class="nx">key1</span><span class="p">,</span> <span class="nx">key2</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tr</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">key1</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>

            <span class="c1">//Errors must be passed back to the callback for retry logic to work!</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">callback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>

            <span class="nx">tr</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">key2</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
            <span class="nx">callback</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">});</span>
</pre></div>
</div>
<p>Any function <tt class="docutils literal"><span class="pre">func</span></tt> decorated by <tt class="docutils literal"><span class="pre">fdb.transactional</span></tt> must take a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> as its first argument and a <a class="reference internal" href="#callbacks"><em>callback</em></a> as its last. The callback must be called for the transaction to commit or retry on errors. In particular, this callback requires that:</p>
<ul class="simple">
<li>Any FoundationDB API error encountered within <tt class="docutils literal"><span class="pre">func</span></tt> must be passed to the callback as its first argument. Calling the callback with any other error will cancel the transaction and pass the error to the outer level.</li>
<li>If no errors are encountered, then any result produced by <tt class="docutils literal"><span class="pre">func</span></tt> must be passed to the callback as its second argument. If <tt class="docutils literal"><span class="pre">func</span></tt> is not intended to produce a result, the callback must be called with no arguments.</li>
</ul>
<p>There are several options for invoking the transactional function produced by <tt class="docutils literal"><span class="pre">fdb.transactional</span></tt>.</p>
<ul class="simple">
<li>The transactional function can be passed a <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a> as its first argument. In this case, a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> will be created, passed to <tt class="docutils literal"><span class="pre">func</span></tt>, and be committed before returning to the caller. Any <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">retryable</span> <span class="pre">error</span></tt></a> must be passed to the callback by <tt class="docutils literal"><span class="pre">func</span></tt> as described above, allowing <tt class="docutils literal"><span class="pre">func</span></tt> to be retried until the transaction successfully commits.</li>
<li>The transactional function can be passed a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> as its first argument. In this case, the transactional function will not attempt to commit or retry the transaction on error. Rather, commit and retry are the responsibility of the caller that owns the transaction. This option allows transactional functions to be freely composed.</li>
<li>The transactional function can be invoked without a callback argument. In this case, it will return a <a class="reference internal" href="#nodefutures"><em>Future</em></a>.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">In some failure scenarios, it is possible that your transaction will be executed twice. See <a class="reference internal" href="developer-guide.html#developer-guide-unknown-results"><em>Transactions with unknown results</em></a> for more information.</p>
</div>
</dd></dl>

</div>
<div class="section" id="transaction-objects">
<h2>Transaction objects<a class="headerlink" href="#transaction-objects" title="Permalink to this headline">∞</a></h2>
<dl class="class">
<dt id="Transaction">
<em class="property">class </em><tt class="descname">Transaction</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p>A <tt class="docutils literal"><span class="pre">Transaction</span></tt> object represents a FoundationDB database transaction. All operations on FoundationDB take place, explicitly or implicitly, through a <tt class="docutils literal"><span class="pre">Transaction</span></tt>.</p>
<p>In FoundationDB, a transaction is a mutable snapshot of a database. All read and write operations on a transaction see and modify an otherwise-unchanging version of the database and only change the underlying database if and when the transaction is committed. Read operations do see the effects of previous write operations on the same transaction. Committing a transaction usually succeeds in the absence of <a class="reference internal" href="developer-guide.html#conflict-ranges"><em>conflicts</em></a>.</p>
<p>Transactions group operations into a unit with the properties of <em>atomicity</em>, <em>isolation</em>, and <em>durability</em>. Transactions also provide the ability to maintain an application&#8217;s invariants or integrity constraints, supporting the property of <em>consistency</em>. Together these properties are known as <a class="reference internal" href="developer-guide.html#acid"><em>ACID</em></a>.</p>
<p>Transactions are also causally consistent: once a transaction has been successfully committed, all subsequently created transactions will see the modifications made by it.</p>
<p>The most convenient way to use transactions is to use either the <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> function or the <a class="reference internal" href="#fdb.transactional" title="fdb.transactional"><tt class="xref js js-func docutils literal"><span class="pre">fdb.transactional()</span></tt></a> decorator function.</p>
<div class="section" id="attributes">
<h3>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">∞</a></h3>
<dl class="attribute">
<dt id="Transaction.db">
<tt class="descclassname">Transaction.</tt><tt class="descname">db</tt><a class="headerlink" href="#Transaction.db" title="Permalink to this definition">∞</a></dt>
<dd><p>The <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a> that this transaction is interacting with.</p>
</dd></dl>

</div>
<div class="section" id="reading-data">
<h3>Reading data<a class="headerlink" href="#reading-data" title="Permalink to this headline">∞</a></h3>
<dl class="function">
<dt id="Transaction.get">
<tt class="descclassname">Transaction.</tt><tt class="descname">get</tt><big>(</big><em>key</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.get" title="Permalink to this definition">∞</a></dt>
<dd><p>Gets a value associated with the specified <a class="reference internal" href="#datatypes"><em>key</em></a> in the database.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with a Buffer containing the requested value or <tt class="docutils literal"><span class="pre">null</span></tt> if the key does not exist. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.getKey">
<tt class="descclassname">Transaction.</tt><tt class="descname">getKey</tt><big>(</big><em>keySelector</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.getKey" title="Permalink to this definition">∞</a></dt>
<dd><p>Gets the key referenced by the specified <a class="reference internal" href="#fdb.KeySelector" title="fdb.KeySelector"><tt class="xref js js-class docutils literal"><span class="pre">KeySelector()</span></tt></a>.</p>
<p>By default, the key is cached for the duration of the transaction, providing
a potential performance benefit. However, the value of the key is also retrieved,
using network bandwidth. Invoking <a class="reference internal" href="#Transaction.options.setReadYourWritesDisable" title="Transaction.options.setReadYourWritesDisable"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.options.setReadYourWritesDisable()</span></tt></a> will avoid
both the caching and the increased network bandwidth.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with a Buffer containing the requested key. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.getRange">
<tt class="descclassname">Transaction.</tt><tt class="descname">getRange</tt><big>(</big><em>begin</em>, <em>end</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.getRange" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns all keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <tt class="docutils literal"><span class="pre">begin</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">end</span></tt> and their associated values as a <a class="reference internal" href="#LazyIterator" title="LazyIterator"><tt class="xref js js-class docutils literal"><span class="pre">LazyIterator()</span></tt></a> of <a class="reference internal" href="#keyvaluepairs"><em>key-value pairs</em></a>. Note the exclusion of <tt class="docutils literal"><span class="pre">end</span></tt> from the range.</p>
<p>Each of <tt class="docutils literal"><span class="pre">begin</span></tt> and <tt class="docutils literal"><span class="pre">end</span></tt> may be a <a class="reference internal" href="#datatypes"><em>key</em></a> or a <a class="reference internal" href="#fdb.KeySelector" title="fdb.KeySelector"><tt class="xref js js-class docutils literal"><span class="pre">KeySelector()</span></tt></a>. Note that in the case of a <tt class="xref js js-class docutils literal"><span class="pre">KeySelector()</span></tt>, the exclusion of <tt class="docutils literal"><span class="pre">end</span></tt> from the range still applies.</p>
<p>If the <tt class="docutils literal"><span class="pre">options</span></tt> object is specified, it can have the following optional parameters:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">options.limit</span></tt></dt>
<dd>Only the first <tt class="docutils literal"><span class="pre">limit</span></tt> keys (and their values) in the range will be returned. If unspecified, defaults to having no limit.</dd>
<dt><tt class="docutils literal"><span class="pre">options.reverse</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">true</span></tt>, then the keys in the range will be returned in reverse order. If unspecified, defaults to <tt class="docutils literal"><span class="pre">false</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">options.streamingMode</span></tt></dt>
<dd>A value from <a class="reference internal" href="#fdb.streamingMode" title="fdb.streamingMode"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode</span></tt></a> which provides a hint to FoundationDB about how the returned iterator is likely to be used.  If unspecified, defaults to <a class="reference internal" href="#fdb.streamingMode.iterator" title="fdb.streamingMode.iterator"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode.iterator</span></tt></a>.</dd>
</dl>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="Transaction.getRangeStartsWith">
<tt class="descclassname">Transaction.</tt><tt class="descname">getRangeStartsWith</tt><big>(</big><em>keyPrefix</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.getRangeStartsWith" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns all keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <tt class="docutils literal"><span class="pre">k</span></tt> begins with <a class="reference internal" href="#datatypes"><em>keyPrefix</em></a>, and their associated values, as a <a class="reference internal" href="#LazyIterator" title="LazyIterator"><tt class="xref js js-class docutils literal"><span class="pre">LazyIterator()</span></tt></a> of <a class="reference internal" href="#keyvaluepairs"><em>key-value pairs</em></a>.</p>
<p>If the <tt class="docutils literal"><span class="pre">options</span></tt> object is specified, it can have the following optional parameters:</p>
<blockquote>
<div><dl class="docutils">
<dt><tt class="docutils literal"><span class="pre">options.limit</span></tt></dt>
<dd>Only the first <tt class="docutils literal"><span class="pre">limit</span></tt> keys (and their values) in the range will be returned. If unspecified, defaults to having no limit.</dd>
<dt><tt class="docutils literal"><span class="pre">options.reverse</span></tt></dt>
<dd>If <tt class="docutils literal"><span class="pre">true</span></tt>, then the keys in the range will be returned in reverse order. If unspecified, defaults to <tt class="docutils literal"><span class="pre">false</span></tt>.</dd>
<dt><tt class="docutils literal"><span class="pre">options.streamingMode</span></tt></dt>
<dd>A value from <a class="reference internal" href="#fdb.streamingMode" title="fdb.streamingMode"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode</span></tt></a> which provides a hint to FoundationDB about how the returned iterator is likely to be used.  If unspecified, defaults to <a class="reference internal" href="#fdb.streamingMode.iterator" title="fdb.streamingMode.iterator"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode.iterator</span></tt></a>.</dd>
</dl>
</div></blockquote>
</dd></dl>

</div>
<div class="section" id="snapshot-reads">
<h3>Snapshot reads<a class="headerlink" href="#snapshot-reads" title="Permalink to this headline">∞</a></h3>
<dl class="attribute">
<dt id="Transaction.snapshot">
<tt class="descclassname">Transaction.</tt><tt class="descname">snapshot</tt><a class="headerlink" href="#Transaction.snapshot" title="Permalink to this definition">∞</a></dt>
<dd><p>Snapshot reads selectively relax FoundationDB&#8217;s isolation property, reducing <a class="reference internal" href="developer-guide.html#developer-guide-transaction-conflicts"><em>conflicts</em></a> but making it harder to reason about concurrency.</p>
<p>By default, FoundationDB transactions guarantee <a class="reference internal" href="developer-guide.html#acid"><em>serializable isolation</em></a>, resulting in a state that is <em>as if</em> transactions were executed one at a time, even if they were executed concurrently. Serializability has little performance cost when there are few <a class="reference internal" href="developer-guide.html#developer-guide-transaction-conflicts"><em>conflicts</em></a> but can be expensive when there are many. FoundationDB therefore also permits individual reads within a transaction to be done as snapshot reads.</p>
<p>Snapshot reads differ from ordinary (serializable) reads by permitting the values they read to be modified by concurrent transactions, whereas serializable reads cause conflicts in that case. Like serializable reads, snapshot reads see the effects of prior writes in the same transaction. For more information on the use of snapshot reads, see <a class="reference internal" href="developer-guide.html#snapshot-isolation"><em>Snapshot reads</em></a>.</p>
<p>Snapshot reads also interact with transaction commit a little differently than normal reads. If a snapshot read is outstanding when transaction commit is called that read will immediately return an error. (Normally, transaction commit will wait until outstanding reads return before committing.)</p>
</dd></dl>

<dl class="attribute">
<dt id="Transaction.snapshot.db">
<tt class="descclassname">Transaction.snapshot.</tt><tt class="descname">db</tt><a class="headerlink" href="#Transaction.snapshot.db" title="Permalink to this definition">∞</a></dt>
<dd><p>The <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a> that this transaction is interacting with.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.snapshot.get">
<tt class="descclassname">Transaction.snapshot.</tt><tt class="descname">get</tt><big>(</big><em>key</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.snapshot.get" title="Permalink to this definition">∞</a></dt>
<dd><p>Like <a class="reference internal" href="#Transaction.get" title="Transaction.get"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.get()</span></tt></a>, but as a snapshot read.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.snapshot.getKey">
<tt class="descclassname">Transaction.snapshot.</tt><tt class="descname">getKey</tt><big>(</big><em>keySelector</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.snapshot.getKey" title="Permalink to this definition">∞</a></dt>
<dd><p>Like <a class="reference internal" href="#Transaction.getKey" title="Transaction.getKey"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getKey()</span></tt></a>, but as a snapshot read.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.snapshot.getRange">
<tt class="descclassname">Transaction.snapshot.</tt><tt class="descname">getRange</tt><big>(</big><em>begin</em>, <em>end</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.snapshot.getRange" title="Permalink to this definition">∞</a></dt>
<dd><p>Like <a class="reference internal" href="#Transaction.getRange" title="Transaction.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRange()</span></tt></a>, but as a snapshot read.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.snapshot.getRangeStartsWith">
<tt class="descclassname">Transaction.snapshot.</tt><tt class="descname">getRangeStartsWith</tt><big>(</big><em>keyPrefix</em><span class="optional">[</span>, <em>options</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.snapshot.getRangeStartsWith" title="Permalink to this definition">∞</a></dt>
<dd><p>Like <a class="reference internal" href="#Transaction.getRangeStartsWith" title="Transaction.getRangeStartsWith"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRangeStartsWith()</span></tt></a>, but as a snapshot read.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.snapshot.getReadVersion">
<tt class="descclassname">Transaction.snapshot.</tt><tt class="descname">getReadVersion</tt><big>(</big><span class="optional">[</span><em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.snapshot.getReadVersion" title="Permalink to this definition">∞</a></dt>
<dd><p>Identical to <a class="reference internal" href="#Transaction.getReadVersion" title="Transaction.getReadVersion"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getReadVersion()</span></tt></a> (since snapshot and serializable reads use the same read version).</p>
</dd></dl>

</div>
<div class="section" id="writing-data">
<h3>Writing Data<a class="headerlink" href="#writing-data" title="Permalink to this headline">∞</a></h3>
<dl class="function">
<dt id="Transaction.set">
<tt class="descclassname">Transaction.</tt><tt class="descname">set</tt><big>(</big><em>key</em>, <em>value</em><big>)</big><a class="headerlink" href="#Transaction.set" title="Permalink to this definition">∞</a></dt>
<dd><p>Associates the given <a class="reference internal" href="#datatypes"><em>key</em></a> and <a class="reference internal" href="#datatypes"><em>value</em></a>.  Overwrites any prior value associated with <tt class="docutils literal"><span class="pre">key</span></tt>.  Returns immediately, having modified the snapshot represented by this <tt class="docutils literal"><span class="pre">Transaction</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.clear">
<tt class="descclassname">Transaction.</tt><tt class="descname">clear</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#Transaction.clear" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes the specified <a class="reference internal" href="#datatypes"><em>key</em></a> (and any associated value), if it exists.  Returns immediately, having modified the snapshot represented by this <tt class="docutils literal"><span class="pre">Transaction</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.clearRange">
<tt class="descclassname">Transaction.</tt><tt class="descname">clearRange</tt><big>(</big><em>begin</em>, <em>end</em><big>)</big><a class="headerlink" href="#Transaction.clearRange" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes all keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <a class="reference internal" href="#datatypes"><em>begin</em></a> &lt;= k &lt; <a class="reference internal" href="#datatypes"><em>end</em></a>, and their associated values.  Returns immediately, having modified the snapshot represented by this <tt class="docutils literal"><span class="pre">Transaction</span></tt>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unlike in the case of <a class="reference internal" href="#Transaction.getRange" title="Transaction.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRange()</span></tt></a>, <tt class="docutils literal"><span class="pre">begin</span></tt> and <tt class="docutils literal"><span class="pre">end</span></tt> must be <a class="reference internal" href="#datatypes"><em>keys</em></a>, not <a class="reference internal" href="#fdb.KeySelector" title="fdb.KeySelector"><tt class="xref js js-class docutils literal"><span class="pre">KeySelector()s</span></tt></a>. (Resolving arbitrary key selectors would prevent this method from returning immediately, introducing concurrency issues.)</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Transaction.clearRangeStartsWith">
<tt class="descclassname">Transaction.</tt><tt class="descname">clearRangeStartsWith</tt><big>(</big><em>prefix</em><big>)</big><a class="headerlink" href="#Transaction.clearRangeStartsWith" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes all the keys <tt class="docutils literal"><span class="pre">k</span></tt> such that <tt class="docutils literal"><span class="pre">k</span></tt> begins with <a class="reference internal" href="#datatypes"><em>keyPrefix</em></a>, and their associated values.  Returns immediately, having modified the snapshot represented by this transaction.</p>
</dd></dl>

</div>
<div class="section" id="atomic-operations">
<span id="api-node-transaction-atomic-operations"></span><h3>Atomic operations<a class="headerlink" href="#atomic-operations" title="Permalink to this headline">∞</a></h3>
<p>An atomic operation is a single database command that carries out several logical steps: reading the value of a key, performing a transformation on that value, and writing the result. Different atomic operations perform different transformations. Like other database operations, an atomic operation is used within a transaction; however, its use within a transaction will not cause the transaction to conflict.</p>
<p>Atomic operations do not expose the current value of the key to the client but simply send the database the transformation to apply. In regard to conflict checking, an atomic operation is equivalent to a write without a read. It can only cause <em>other</em> transactions performing reads of the key to conflict.</p>
<p>By combining these logical steps into a single, read-free operation, FoundationDB can guarantee that the transaction will not conflict due to the operation. This makes atomic operations ideal for operating on keys that are frequently modified. A common example is the use of a key-value pair as a counter.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If a transaction uses both an atomic operation and a serializable read on the same key, the benefits of using the atomic operation (for both conflict checking and performance) are lost.</p>
</div>
<p>In each of the methods below, <tt class="docutils literal"><span class="pre">param</span></tt> should be a <tt class="docutils literal"><span class="pre">Buffer</span></tt> appropriately packed to represent the desired value. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre># wrong
tr.add(&#39;key&#39;, 1);

# right
var value = new Buffer(4);
value.writeUInt32LE(1, 0);
tr.add(&#39;key&#39;, value);
</pre></div>
</div>
<dl class="function">
<dt id="Transaction.add">
<tt class="descclassname">Transaction.</tt><tt class="descname">add</tt><big>(</big><em>key</em>, <em>param</em><big>)</big><a class="headerlink" href="#Transaction.add" title="Permalink to this definition">∞</a></dt>
<dd><p>Performs an addition of little-endian integers. If the existing value in the database is not present or shorter than <tt class="docutils literal"><span class="pre">param</span></tt>, it is first extended to the length of <tt class="docutils literal"><span class="pre">param</span></tt> with zero bytes.  If <tt class="docutils literal"><span class="pre">param</span></tt> is shorter than the existing value in the database, the existing value is truncated to match the length of <tt class="docutils literal"><span class="pre">param</span></tt>.</p>
<p>The integers to be added must be stored in a little-endian representation.  They can be signed in two&#8217;s complement representation or unsigned. You can add to an integer at a known offset in the value by prepending the appropriate number of zero bytes to <tt class="docutils literal"><span class="pre">param</span></tt> and padding with zero bytes to match the length of the value. However, this offset technique requires that you know the addition will not cause the integer field within the value to overflow.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.bit_and">
<tt class="descclassname">Transaction.</tt><tt class="descname">bit_and</tt><big>(</big><em>key</em>, <em>param</em><big>)</big><a class="headerlink" href="#Transaction.bit_and" title="Permalink to this definition">∞</a></dt>
<dd><p>Performs a bitwise &#8220;and&#8221; operation.  If the existing value in the database is not present or shorter than <tt class="docutils literal"><span class="pre">param</span></tt>, it is first extended to the length of <tt class="docutils literal"><span class="pre">param</span></tt> with zero bytes.  If <tt class="docutils literal"><span class="pre">param</span></tt> is shorter than the existing value in the database, the existing value is truncated to match the length of <tt class="docutils literal"><span class="pre">param</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.bit_or">
<tt class="descclassname">Transaction.</tt><tt class="descname">bit_or</tt><big>(</big><em>key</em>, <em>param</em><big>)</big><a class="headerlink" href="#Transaction.bit_or" title="Permalink to this definition">∞</a></dt>
<dd><p>Performs a bitwise &#8220;or&#8221; operation.  If the existing value in the database is not present or shorter than <tt class="docutils literal"><span class="pre">param</span></tt>, it is first extended to the length of <tt class="docutils literal"><span class="pre">param</span></tt> with zero bytes.  If <tt class="docutils literal"><span class="pre">param</span></tt> is shorter than the existing value in the database, the existing value is truncated to match the length of <tt class="docutils literal"><span class="pre">param</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.bit_xor">
<tt class="descclassname">Transaction.</tt><tt class="descname">bit_xor</tt><big>(</big><em>key</em>, <em>param</em><big>)</big><a class="headerlink" href="#Transaction.bit_xor" title="Permalink to this definition">∞</a></dt>
<dd><p>Performs a bitwise &#8220;xor&#8221; operation.  If the existing value in the database is not present or shorter than <tt class="docutils literal"><span class="pre">param</span></tt>, it is first extended to the length of <tt class="docutils literal"><span class="pre">param</span></tt> with zero bytes.  If <tt class="docutils literal"><span class="pre">param</span></tt> is shorter than the existing value in the database, the existing value is truncated to match the length of <tt class="docutils literal"><span class="pre">param</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.max">
<tt class="descclassname">Transaction.</tt><tt class="descname">max</tt><big>(</big><em>key</em>, <em>param</em><big>)</big><a class="headerlink" href="#Transaction.max" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the value in the database to the larger of the existing value and <tt class="docutils literal"><span class="pre">param</span></tt>. If the existing value in the database is not present or shorter than <tt class="docutils literal"><span class="pre">param</span></tt>, it is first extended to the length of <tt class="docutils literal"><span class="pre">param</span></tt> with zero bytes. If <tt class="docutils literal"><span class="pre">param</span></tt> is shorter than the existing value in the database, the existing value is truncated to match the length of <tt class="docutils literal"><span class="pre">param</span></tt>.</p>
<p>Both the existing value and <tt class="docutils literal"><span class="pre">param</span></tt> are treated as unsigned integers. (This differs from the behavior of atomic addition.)</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.min">
<tt class="descclassname">Transaction.</tt><tt class="descname">min</tt><big>(</big><em>key</em>, <em>param</em><big>)</big><a class="headerlink" href="#Transaction.min" title="Permalink to this definition">∞</a></dt>
<dd><p>Sets the value in the database to the smaller of the existing value and <tt class="docutils literal"><span class="pre">param</span></tt>. If the existing value in the database is not present or shorter than <tt class="docutils literal"><span class="pre">param</span></tt>, it is first extended to the length of <tt class="docutils literal"><span class="pre">param</span></tt> with zero bytes. If <tt class="docutils literal"><span class="pre">param</span></tt> is shorter than the existing value in the database, the existing value is truncated to match the length of <tt class="docutils literal"><span class="pre">param</span></tt>.</p>
<p>Both the existing value and <tt class="docutils literal"><span class="pre">param</span></tt> are treated as unsigned integers. (This differs from the behavior of atomic addition.)</p>
</dd></dl>

</div>
<div class="section" id="committing">
<h3>Committing<a class="headerlink" href="#committing" title="Permalink to this headline">∞</a></h3>
<dl class="function">
<dt>
<tt class="descclassname">fdb.</tt><tt class="descname">transactional</tt><big>(</big><em>func</em><big>)</big></dt>
<dd><p>The <tt class="docutils literal"><span class="pre">fdb.transactional</span></tt> decorator function makes it easy to write transactional functions which automatically commit. See <a class="reference internal" href="#fdb.transactional" title="fdb.transactional"><tt class="xref js js-func docutils literal"><span class="pre">fdb.transactional()</span></tt></a> for explanation and examples.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.doTransaction">
<tt class="descclassname">Transaction.</tt><tt class="descname">doTransaction</tt><big>(</big><em>func</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.doTransaction" title="Permalink to this definition">∞</a></dt>
<dd><p>Executes the provided function <tt class="docutils literal"><span class="pre">func</span></tt> with the transaction and calls <tt class="docutils literal"><span class="pre">callback</span></tt> with the result produced by <tt class="docutils literal"><span class="pre">func</span></tt>. This is the recommended way to do operations transactionally.</p>
<p><tt class="docutils literal"><span class="pre">func</span></tt> must take a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a> as its first argument and an inner <a class="reference internal" href="#callbacks"><em>callback</em></a> as its second argument.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the <tt class="docutils literal"><span class="pre">callback</span></tt> passed to <tt class="xref js js-func docutils literal"><span class="pre">doTransaction()</span></tt> and the inner callback passed to <tt class="docutils literal"><span class="pre">func</span></tt> are distinct.</p>
</div>
<p>This function, along with <tt class="docutils literal"><span class="pre">Database.doTransaction</span></tt>, makes it easy to write transactional functions which automatically commit. See <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> for explanation of their interaction and examples.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.commit">
<tt class="descclassname">Transaction.</tt><tt class="descname">commit</tt><big>(</big><span class="optional">[</span><em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.commit" title="Permalink to this definition">∞</a></dt>
<dd><p>Attempt to commit the changes made in the transaction to the database.</p>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called once the transaction has committed. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to wait for completion.</p>
<p>As with other client/server databases, in some failure scenarios a client may be unable to determine whether a transaction succeeded. In these cases, <a class="reference internal" href="#Transaction.commit" title="Transaction.commit"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.commit()</span></tt></a> will respond with a <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>commit_unknown_result</em></a> error. The <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.onError()</span></tt></a> function treats this error as retryable, so retry loops that don&#8217;t check for <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>commit_unknown_result</em></a> could execute the transaction twice. In these cases, you must consider the idempotence of the transaction. For more information, see <a class="reference internal" href="developer-guide.html#developer-guide-unknown-results"><em>Transactions with unknown results</em></a>.</p>
<p>Normally, commit will wait for outstanding reads to return. However, if those reads were snapshot reads or the transaction option for disabling &#8220;read-your-writes&#8221; has been invoked, any outstanding reads will immediately return errors.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Consider using either the <a class="reference internal" href="#fdb.transactional" title="fdb.transactional"><tt class="xref js js-func docutils literal"><span class="pre">fdb.transactional()</span></tt></a> decorator function or the <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> function, which not only call <a class="reference internal" href="#Database.createTransaction" title="Database.createTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.createTransaction()</span></tt></a> and <a class="reference internal" href="#Transaction.commit" title="Transaction.commit"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.commit()</span></tt></a> for you but also implement the required error handling and retry logic for transactions.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If any operation is performed on a transaction after a commit has been issued but before it has returned, both the commit and the operation will respond with a <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>used_during_commit</em></a> error. In this case, all subsequent operations on this transaction will respond with this error until <a class="reference internal" href="#Transaction.reset" title="Transaction.reset"><tt class="xref js js-func docutils literal"><span class="pre">reset</span></tt></a> is called.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Transaction.onError">
<tt class="descclassname">Transaction.</tt><tt class="descname">onError</tt><big>(</big><em>error</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.onError" title="Permalink to this definition">∞</a></dt>
<dd><p>Determine whether an error returned by a method of <tt class="docutils literal"><span class="pre">Transaction</span></tt> is retryable. This function is asynchronous. If the error is retryable, <tt class="docutils literal"><span class="pre">onError</span></tt> will delay, <a class="reference internal" href="#Transaction.reset" title="Transaction.reset"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.reset()</span></tt></a> the transaction, and call <a class="reference internal" href="#callbacks"><em>callback</em></a> with no result. Otherwise, the <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called immediately with the error. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Consider using either the <a class="reference internal" href="#fdb.transactional" title="fdb.transactional"><tt class="xref js js-func docutils literal"><span class="pre">fdb.transactional()</span></tt></a> decorator function or the <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> function, which call this method for you.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Transaction.reset">
<tt class="descclassname">Transaction.</tt><tt class="descname">reset</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.reset" title="Permalink to this definition">∞</a></dt>
<dd><p>Rollback a transaction, completely resetting it to its initial state. This is logically equivalent to destroying the transaction and creating a new one.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.cancel">
<tt class="descclassname">Transaction.</tt><tt class="descname">cancel</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.cancel" title="Permalink to this definition">∞</a></dt>
<dd><p>Cancels the transaction. All pending or future uses of the transaction will respond with a <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>transaction_cancelled</em></a> error. The transaction can be used again after it is <a class="reference internal" href="#Transaction.reset" title="Transaction.reset"><tt class="xref js js-func docutils literal"><span class="pre">reset</span></tt></a>.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Be careful if you are using <a class="reference internal" href="#Transaction.reset" title="Transaction.reset"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.reset()</span></tt></a> and <a class="reference internal" href="#Transaction.cancel" title="Transaction.cancel"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.cancel()</span></tt></a> concurrently with the same transaction. Since they negate each other&#8217;s effects, a race condition between these calls will leave the transaction in an unknown state.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If your program attempts to cancel a transaction after <a class="reference internal" href="#Transaction.commit" title="Transaction.commit"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.commit()</span></tt></a> has been called but before it returns, unpredictable behavior will result. While it is guaranteed that the transaction will eventually end up in a cancelled state, the commit may or may not occur. Moreover, even if the call to <a class="reference internal" href="#Transaction.commit" title="Transaction.commit"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.commit()</span></tt></a> appears to respond with a <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>transaction_cancelled</em></a> error,  the commit may have occurred or may occur in the future. This can make it more difficult to reason about the order in which transactions occur.</p>
</div>
</dd></dl>

</div>
<div class="section" id="watches">
<h3>Watches<a class="headerlink" href="#watches" title="Permalink to this headline">∞</a></h3>
<dl class="function">
<dt id="Transaction.watch">
<tt class="descclassname">Transaction.</tt><tt class="descname">watch</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#Transaction.watch" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> that will be notified when the value stored at <tt class="docutils literal"><span class="pre">key</span></tt> changes.</p>
<p>A watch&#8217;s behavior is relative to the transaction that created it. A watch will report a change in relation to the key&#8217;s value as readable by that transaction. The initial value used for comparison is either that of the transaction&#8217;s read version or the value as modified by the transaction itself prior to the creation of the watch. If the value changes and then changes back to its initial value, the watch might not report the change.</p>
<p>Until the transaction that created it has been committed, a watch will not report changes made by <em>other</em> transactions. In contrast, a watch will immediately report changes made by the transaction itself. Watches cannot be created if the transaction has set <a class="reference internal" href="#Transaction.options.setReadYourWritesDisable" title="Transaction.options.setReadYourWritesDisable"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.options.setReadYourWritesDisable()</span></tt></a>, and an attempt to do so will respond with an <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>watches_disabled</em></a> error.</p>
<p>If the transaction used to create a watch encounters an error during commit, then the watch will be set with that error. A transaction whose <a class="reference internal" href="developer-guide.html#developer-guide-unknown-results"><em>commit result is unknown</em></a> will set all of its watches with the <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>commit_unknown_result</em></a> error. If an uncommitted transaction is reset or destroyed, then any watches it created will be set with the <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>transaction_cancelled</em></a> error.</p>
<p>By default, each database connection can have no more than 10,000 watches that have not yet reported a change. When this number is exceeded, an attempt to create a watch will respond with a <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>too_many_watches</em></a> error. This limit can be changed using <a class="reference internal" href="#Database.options.setMaxWatches" title="Database.options.setMaxWatches"><tt class="xref js js-func docutils literal"><span class="pre">Database.options.setMaxWatches()</span></tt></a>. Because a watch outlives the transaction that creates it, any watch that is no longer needed should be cancelled by calling <a class="reference internal" href="#Future.cancel" title="Future.cancel"><tt class="xref js js-func docutils literal"><span class="pre">Future.cancel()</span></tt></a> on its returned future.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Unlike most asynchronous function in the FoundationDB API, watches do not take a callback. Instead, one must be passed to the <a class="reference internal" href="#nodefutures"><em>future</em></a> that the watch function returns. A watch will be automatically cancelled if the <a class="reference internal" href="#nodefutures"><em>future</em></a> returned by the watch function is garbage collected.</p>
</div>
</dd></dl>

</div>
<div class="section" id="conflict-ranges">
<h3>Conflict ranges<a class="headerlink" href="#conflict-ranges" title="Permalink to this headline">∞</a></h3>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Most applications will use the serializable isolation that transactions provide by default and will not need to manipulate conflict ranges.</p>
</div>
<p>The following make it possible to add <a class="reference internal" href="developer-guide.html#conflict-ranges"><em>conflict ranges</em></a> to a transaction.</p>
<dl class="function">
<dt id="Transaction.addReadConflictRange">
<tt class="descclassname">Transaction.</tt><tt class="descname">addReadConflictRange</tt><big>(</big><em>begin</em>, <em>end</em><big>)</big><a class="headerlink" href="#Transaction.addReadConflictRange" title="Permalink to this definition">∞</a></dt>
<dd><p>Adds a range of keys to the transaction&#8217;s read conflict ranges as if you had read the range. As a result, other transactions that write a key in this range could cause the transaction to fail with a conflict.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.addReadConflictKey">
<tt class="descclassname">Transaction.</tt><tt class="descname">addReadConflictKey</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#Transaction.addReadConflictKey" title="Permalink to this definition">∞</a></dt>
<dd><p>Adds a key to the transaction&#8217;s read conflict ranges as if you had read the key. As a result, other transactions that concurrently write this key could cause the transaction to fail with a conflict.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.addWriteConflictRange">
<tt class="descclassname">Transaction.</tt><tt class="descname">addWriteConflictRange</tt><big>(</big><em>begin</em>, <em>end</em><big>)</big><a class="headerlink" href="#Transaction.addWriteConflictRange" title="Permalink to this definition">∞</a></dt>
<dd><p>Adds a range of keys to the transaction&#8217;s write conflict ranges as if you had cleared the range. As a result, other transactions that concurrently read a key in this range could fail with a conflict.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.addWriteConflictKey">
<tt class="descclassname">Transaction.</tt><tt class="descname">addWriteConflictKey</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#Transaction.addWriteConflictKey" title="Permalink to this definition">∞</a></dt>
<dd><p>Adds a key to the transaction&#8217;s write conflict ranges as if you had written the key. As a result, other transactions that concurrently read this key could fail with a conflict.</p>
</dd></dl>

</div>
<div class="section" id="versions">
<h3>Versions<a class="headerlink" href="#versions" title="Permalink to this headline">∞</a></h3>
<p>Most applications should use the read version that FoundationDB determines automatically during the transaction&#8217;s first read and ignore all of these methods.</p>
<dl class="function">
<dt id="Transaction.setReadVersion">
<tt class="descclassname">Transaction.</tt><tt class="descname">setReadVersion</tt><big>(</big><em>version</em><big>)</big><a class="headerlink" href="#Transaction.setReadVersion" title="Permalink to this definition">∞</a></dt>
<dd><p><em>Infrequently used</em>. Sets the database version that the transaction will read from the database.  The database cannot guarantee causal consistency if this method is used (the transaction&#8217;s reads will be causally consistent only if the provided read version has that property).</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.getReadVersion">
<tt class="descclassname">Transaction.</tt><tt class="descname">getReadVersion</tt><big>(</big><span class="optional">[</span><em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#Transaction.getReadVersion" title="Permalink to this definition">∞</a></dt>
<dd><p><em>Infrequently used</em>. This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the transaction&#8217;s read version. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.getCommittedVersion">
<tt class="descclassname">Transaction.</tt><tt class="descname">getCommittedVersion</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.getCommittedVersion" title="Permalink to this definition">∞</a></dt>
<dd><p><em>Infrequently used</em>. Gets the version number at which a successful commit modified the database. This must be called only after the successful (non-error) completion of a call to <a class="reference internal" href="#Transaction.commit" title="Transaction.commit"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.commit()</span></tt></a> on this Transaction, or the behavior is undefined. Read-only transactions do not modify the database when committed and will have a committed version of -1. Keep in mind that a transaction which reads keys and then sets them to their current values may be optimized to a read-only transaction.</p>
</dd></dl>

</div>
<div class="section" id="transaction-options">
<h3>Transaction options<a class="headerlink" href="#transaction-options" title="Permalink to this headline">∞</a></h3>
<p>Transaction options alter the behavior of FoundationDB transactions. FoundationDB defaults to extremely safe transaction behavior, and we have worked hard to make the performance excellent with the default setting, so you should not often need to use transaction options.</p>
<span class="target" id="api-node-snapshot-ryw"></span><dl class="function">
<dt id="Transaction.options.setSnapshotRywDisable">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setSnapshotRywDisable</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setSnapshotRywDisable" title="Permalink to this definition">∞</a></dt>
<dd><p>If this option is set more times in this transction than the enable option, snapshot reads will <em>not</em> see the effects of prior writes in the same transaction.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setSnapshotRywEnable">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setSnapshotRywEnable</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setSnapshotRywEnable" title="Permalink to this definition">∞</a></dt>
<dd><p>If this option is set an equal or more times in this transaction than the disable option, snapshot reads <em>will</em> see the effects of prior writes in the same transaction.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setPriorityBatch">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setPriorityBatch</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setPriorityBatch" title="Permalink to this definition">∞</a></dt>
<dd><p>This transaction should be treated as low priority (other transactions should be processed first).  Useful for doing potentially saturating batch work without interfering with the latency of other operations.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setPrioritySystemImmediate">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setPrioritySystemImmediate</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setPrioritySystemImmediate" title="Permalink to this definition">∞</a></dt>
<dd><p>This transaction should be treated as extremely high priority, taking priority over other transactions and bypassing controls on transaction queuing.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is intended for the use of internal database functions and low-level tools; use by applications may result in severe database performance or availability problems.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setCausalReadRisky">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setCausalReadRisky</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setCausalReadRisky" title="Permalink to this definition">∞</a></dt>
<dd><p>This transaction does not require the strict causal consistency guarantee that FoundationDB provides by default.  The read version of the transaction will be a committed version, and usually will be the latest committed, but it might be an older version in the event of a fault or network partition.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setCausalWriteRisky">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setCausalWriteRisky</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setCausalWriteRisky" title="Permalink to this definition">∞</a></dt>
<dd><p>The application either knows that this transaction will be self-conflicting (at least one read overlaps at least one set or clear), or is willing to accept a small risk that the transaction could be committed a second time after its commit apparently succeeds.  This option provides a small performance benefit.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setNextWriteNoWriteConflictRange">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setNextWriteNoWriteConflictRange</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setNextWriteNoWriteConflictRange" title="Permalink to this definition">∞</a></dt>
<dd><p>The next write performed on this transaction will not generate a write conflict range. As a result, other transactions which read the key(s) being modified by the next write will not necessarily conflict with this transaction.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setReadYourWritesDisable">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setReadYourWritesDisable</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setReadYourWritesDisable" title="Permalink to this definition">∞</a></dt>
<dd><p>When this option is invoked, a read performed by a transaction will not see any prior mutations that occured in that transaction, instead seeing the value which was in the database at the transaction&#8217;s read version. This option may provide a small performance benefit for the client, but also disables a number of client-side optimizations which are beneficial for transactions which tend to read and write the same keys within a single transaction.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">It is an error to set this option after performing any reads or writes on the transaction.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setReadAheadDisable">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setReadAheadDisable</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setReadAheadDisable" title="Permalink to this definition">∞</a></dt>
<dd><p>Disables read-ahead caching for range reads. Under normal operation, a transaction will read extra rows from the database into cache if range reads are used to page through a series of data one row at a time (i.e. if a range read with a one row limit is followed by another one row range read starting immediately after the result of the first).</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setAccessSystemKeys">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setAccessSystemKeys</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setAccessSystemKeys" title="Permalink to this definition">∞</a></dt>
<dd><p>Allows this transaction to read and modify system keys (those that start with the byte <tt class="docutils literal"><span class="pre">0xFF</span></tt>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Writing into system keys will likely break your database. Further, even for readers, the format of data in the system keys may change from version to version in FoundationDB.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setReadSystemKeys">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setReadSystemKeys</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setReadSystemKeys" title="Permalink to this definition">∞</a></dt>
<dd><p>Allows this transaction to read system keys (those that start with the byte <tt class="docutils literal"><span class="pre">0xFF</span></tt>).</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">The format of data in the system keys may change from version to version in FoundationDB.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setRetryLimit">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setRetryLimit</tt><big>(</big><em>numRetries</em><big>)</big><a class="headerlink" href="#Transaction.options.setRetryLimit" title="Permalink to this definition">∞</a></dt>
<dd><p>Set a maximum number of retries after which additional calls to <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.onError()</span></tt></a> will throw the most recently seen error code. (By default, a transaction permits an unlimited number of retries.) Valid parameter values are [-1, INT_MAX]. If set to -1, the transaction returns to the default of unlimited retries.</p>
<p>Like all transaction options, the retry limit must be reset after a call to <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.onError()</span></tt></a>. This behavior allows the user to make the retry limit dynamic.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setMaxRetryDelay">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setMaxRetryDelay</tt><big>(</big><em>delay</em><big>)</big><a class="headerlink" href="#Transaction.options.setMaxRetryDelay" title="Permalink to this definition">∞</a></dt>
<dd><p>Set the maximum backoff delay incurred in the call to <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.onError()</span></tt></a> if the error is retryable.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setTimeout">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setTimeout</tt><big>(</big><em>timeoutInMilliseconds</em><big>)</big><a class="headerlink" href="#Transaction.options.setTimeout" title="Permalink to this definition">∞</a></dt>
<dd><p>Set a timeout duration in milliseconds after which the transaction automatically to be cancelled. The time is measured from transaction creation (or the most call to <a class="reference internal" href="#Transaction.reset" title="Transaction.reset"><tt class="xref js js-func docutils literal"><span class="pre">reset</span></tt></a>, if any). Valid parameter values are [0, INT_MAX]. If set to 0, all timeouts will be disabled. Once a transaction has timed out, all pending or future uses of the transaction will respond with a <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>transaction_timed_out</em></a> error. The transaction can be used again after it is <a class="reference internal" href="#Transaction.reset" title="Transaction.reset"><tt class="xref js js-func docutils literal"><span class="pre">reset</span></tt></a>.</p>
<p>Timeouts employ transaction cancellation, so you should note the issues raised by <a class="reference internal" href="#Transaction.cancel" title="Transaction.cancel"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.cancel()</span></tt></a> when using timeouts.</p>
<p>Like all transaction options, a timeout must be reset after a call to <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.onError()</span></tt></a>. This behavior allows the user to make the timeout dynamic. Note that resetting this option resets only the timeout <em>duration</em>, not the starting point from which the time is measured.</p>
</dd></dl>

<dl class="function">
<dt id="Transaction.options.setDurabilityDevNullIsWebScale">
<tt class="descclassname">Transaction.options.</tt><tt class="descname">setDurabilityDevNullIsWebScale</tt><big>(</big><big>)</big><a class="headerlink" href="#Transaction.options.setDurabilityDevNullIsWebScale" title="Permalink to this definition">∞</a></dt>
<dd><p>This option has no effect yet, but may make users migrating from MongoDB more comfortable.</p>
</dd></dl>

</div>
</div>
<div class="section" id="callbacks">
<span id="id1"></span><h2>Callbacks<a class="headerlink" href="#callbacks" title="Permalink to this headline">∞</a></h2>
<p>Many functions in the FoundationDB API are asynchronous and take as their final parameter an optional callback which is called when the function has completed. Unless otherwise stated, these callbacks will always have the following signature:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">callback</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">error</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="p">{</span> <span class="p">}</span>
</pre></div>
</div>
<p>If error is null or undefined, then the function succeeded, and the result it returned (if any) is provided in the second argument.</p>
<p>Functions taking callbacks also return <a class="reference internal" href="#nodefutures"><em>futures</em></a>. If such a function is called without passing it a callback, then one can be set later by passing the callback to the returned future.</p>
<div class="section" id="streamline">
<span id="id2"></span><h3>Streamline<a class="headerlink" href="#streamline" title="Permalink to this headline">∞</a></h3>
<p>The FoundationDB Node bindings also support use of the <a class="reference external" href="/web/20150325003226/https://github.com/Sage/streamlinejs">streamline module</a> for simplified asynchronous development. If using the streamline module, any function which takes a callback may also take an <tt class="docutils literal"><span class="pre">_</span></tt> to execute the function in a blocking manner:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">db</span> <span class="o">=</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">open</span><span class="p">();</span>

<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">);</span> <span class="c1">//Blocks until finished</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="nx">_</span><span class="p">);</span> <span class="c1">//Blocks until finished</span>
</pre></div>
</div>
</div>
<div class="section" id="futures">
<span id="nodefutures"></span><h3>Futures<a class="headerlink" href="#futures" title="Permalink to this headline">∞</a></h3>
<dl class="class">
<dt id="Future">
<em class="property">class </em><tt class="descname">Future</tt><big>(</big><big>)</big><a class="headerlink" href="#Future" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p>Asynchronous functions in the FoundationDB API generally take a <a class="reference internal" href="#callbacks"><em>callback</em></a> argument that will be called when the operation fails or completes. If no callback argument is supplied to an asynchronous FoundationDB function, then it will instead return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// Database.get takes a callback</span>
<span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">))</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got x&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Database.get can instead return a future</span>
<span class="kd">var</span> <span class="nx">future</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you pass a callback to an asynchronous function in the FoundationDB API, it will not return a Future.</p>
</div>
<p>The result of an operation can be retrieved by passing a callback to the future object:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">future</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
<span class="nx">future</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got x&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Futures make it possible to start multiple operations before waiting for the result. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="c1">// Start both reads</span>
<span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>

<span class="c1">// Wait for both reads to complete</span>
<span class="nx">x</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">xErr</span><span class="p">,</span> <span class="nx">xVal</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">y</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">yErr</span><span class="p">,</span> <span class="nx">yVal</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span><span class="p">(</span><span class="nx">xErr</span> <span class="o">||</span> <span class="nx">yErr</span><span class="p">)</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">xErr</span><span class="p">,</span> <span class="nx">yErr</span><span class="p">);</span>
        <span class="k">else</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Finished parallel get:&#39;</span><span class="p">,</span> <span class="nx">xVal</span><span class="p">,</span> <span class="nx">yVal</span><span class="p">);</span>
    <span class="p">});</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Futures can be combined with <a class="reference internal" href="#streamline"><em>Streamline</em></a>:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
<span class="kd">var</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">db</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>

<span class="c1">//This blocks until both gets have completed</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">x</span><span class="p">(</span><span class="nx">_</span><span class="p">)</span> <span class="o">+</span> <span class="nx">y</span><span class="p">(</span><span class="nx">_</span><span class="p">));</span>
</pre></div>
</div>
<div class="section" id="promises">
<span id="api-node-promises"></span><h4>Promises<a class="headerlink" href="#promises" title="Permalink to this headline">∞</a></h4>
<p>Futures also support the <a class="reference external" href="/web/20150325003226/http://promises-aplus.github.io/promises-spec/">Promises/A+ specification</a>, a popular standard for asynchronous operations in JavaScript. In the Promise/A+ interface, a promise is a future that exposes a <tt class="docutils literal"><span class="pre">then</span></tt> function, which registers callbacks to receive either a promise&#8217;s eventual value or the reason why the promise cannot be fulfilled. A promise can be in one of three states: <tt class="docutils literal"><span class="pre">pending</span></tt>, <tt class="docutils literal"><span class="pre">fulfilled</span></tt>, or <tt class="docutils literal"><span class="pre">rejected</span></tt>.</p>
<ul class="simple">
<li>When <tt class="docutils literal"><span class="pre">pending</span></tt>, a promise will eventually transition to either the <tt class="docutils literal"><span class="pre">fulfilled</span></tt> or <tt class="docutils literal"><span class="pre">rejected</span></tt> state.</li>
<li>When <tt class="docutils literal"><span class="pre">fulfilled</span></tt>, a promise has a value, which will not change.</li>
<li>When <tt class="docutils literal"><span class="pre">rejected</span></tt>, a promise has a reason, which will not change.</li>
</ul>
<dl class="function">
<dt id="Future.cancel">
<tt class="descclassname">Future.</tt><tt class="descname">cancel</tt><big>(</big><big>)</big><a class="headerlink" href="#Future.cancel" title="Permalink to this definition">∞</a></dt>
<dd><p>Attempts to cancel the future and its associated asynchronous operation, if possible. If a <a class="reference internal" href="#callbacks"><em>callback</em></a> was passed to the original function or its returned future, it may be called with an <a class="reference internal" href="api-error-codes.html#developer-guide-error-codes"><em>operation_cancelled</em></a> error.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Currently, only <a class="reference internal" href="#Transaction.watch" title="Transaction.watch"><tt class="xref js js-func docutils literal"><span class="pre">watches</span></tt></a> support cancellation. All other asynchronous FoundationDB operations will continue running normally when cancelled.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="Future.then">
<tt class="descclassname">Future.</tt><tt class="descname">then</tt><big>(</big><em>onFulfilled</em>, <em>onRejected</em><big>)</big><a class="headerlink" href="#Future.then" title="Permalink to this definition">∞</a></dt>
<dd><p>Provides access to the promise&#8217;s current or eventual value or the reason it was rejected. <tt class="docutils literal"><span class="pre">then</span></tt> may be called multiple times on the same promise.</p>
<p><tt class="docutils literal"><span class="pre">onFulfilled</span></tt> and <tt class="docutils literal"><span class="pre">onRejected</span></tt> are both optional arguments. If <tt class="docutils literal"><span class="pre">onFulfilled</span></tt> is a function, it will be called after promise is fulfilled, with promise&#8217;s value as its first argument. If <tt class="docutils literal"><span class="pre">onRejected</span></tt> is a function, it will be called after promise is rejected, with promise&#8217;s reason as its first argument. See the <a class="reference external" href="/web/20150325003226/http://promises-aplus.github.io/promises-spec/">specification</a> for further details.</p>
<p>Returns a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a>.</p>
</dd></dl>

<dl class="function">
<dt id="Future.catch">
<tt class="descclassname">Future.</tt><tt class="descname">catch</tt><big>(</big><em>onRejected</em><big>)</big><a class="headerlink" href="#Future.catch" title="Permalink to this definition">∞</a></dt>
<dd><p>Provides access to the reason a promise is rejected. <tt class="docutils literal"><span class="pre">onRejected</span></tt> will be called after promise is rejected, with promise&#8217;s reason as its first argument. <tt class="docutils literal"><span class="pre">catch</span></tt> may be called multiple times on the same promise.</p>
<p>Equivalent to calling <a class="reference internal" href="#Future.then" title="Future.then"><tt class="xref js js-func docutils literal"><span class="pre">Future.then(undefined,</span> <span class="pre">onRejected)</span></tt></a>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="promise-utilities">
<h3>Promise utilities<a class="headerlink" href="#promise-utilities" title="Permalink to this headline">∞</a></h3>
<p>The <tt class="docutils literal"><span class="pre">fdb.future</span></tt> functions provide utilities for working with futures in a manner compatible with the promise interface. <tt class="docutils literal"><span class="pre">fdb.future</span></tt> also exports the prototype of created futures.</p>
<dl class="function">
<dt id="fdb.future.create">
<tt class="descclassname">fdb.future.</tt><tt class="descname">create</tt><big>(</big><em>func</em><span class="optional">[</span>, <em>cb</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#fdb.future.create" title="Permalink to this definition">∞</a></dt>
<dd><p>Creates a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> in the <tt class="docutils literal"><span class="pre">pending</span></tt> state, i.e. neither <tt class="docutils literal"><span class="pre">fulfilled</span></tt> nor <tt class="docutils literal"><span class="pre">rejected</span></tt>, that will be satisfied once <tt class="docutils literal"><span class="pre">func</span></tt> has finished executing (either successfully or with an error). <tt class="docutils literal"><span class="pre">func</span></tt> will be passed a single <a class="reference internal" href="#callbacks"><em>callback</em></a> argument <tt class="docutils literal"><span class="pre">futureCb</span></tt> that <tt class="docutils literal"><span class="pre">func</span></tt> should call when it is complete.</p>
<p>If the <tt class="docutils literal"><span class="pre">cb</span></tt> argument is supplied to <tt class="docutils literal"><span class="pre">fdb.future.create</span></tt>, then no future will be returned; instead <tt class="docutils literal"><span class="pre">cb</span></tt> will be called when <tt class="docutils literal"><span class="pre">func</span></tt> has finished executing. Otherwise, a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> will be returned. This allows an API to provide functions that can take Node-style callbacks or return <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Futures</span></tt></a>. For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">function</span> <span class="nx">getAndClearFoo</span><span class="p">(</span><span class="nx">tr</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">future</span><span class="p">.</span><span class="nx">create</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">futureCb</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">tr</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="k">return</span> <span class="nx">futureCb</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
            <span class="nx">tr</span><span class="p">.</span><span class="nx">clear</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">);</span>
            <span class="nx">futureCb</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="c1">// Or we could use promises</span>
        <span class="c1">// tr.get(&#39;foo&#39;)</span>
        <span class="c1">// .then(function(val) {</span>
        <span class="c1">//    tr.clear(&#39;foo&#39;);</span>
        <span class="c1">//    return val;</span>
        <span class="c1">// })(futureCb);</span>
    <span class="p">},</span> <span class="nx">cb</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Call getAndClearFoo without passing a callback</span>
<span class="kd">var</span> <span class="nx">future</span> <span class="o">=</span> <span class="nx">getAndClearFoo</span><span class="p">(</span><span class="nx">tr</span><span class="p">);</span>
<span class="nx">future</span><span class="p">.</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got value&#39;</span><span class="p">,</span> <span class="nx">value</span><span class="p">);</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">reason</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got error&#39;</span><span class="p">,</span> <span class="nx">reason</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Call getAndClearFoo with a callback</span>
<span class="nx">getAndClearFoo</span><span class="p">(</span><span class="nx">tr</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">val</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got error&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;got value&#39;</span><span class="p">,</span> <span class="nx">val</span><span class="p">);</span>
<span class="p">});</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="fdb.future.resolve">
<tt class="descclassname">fdb.future.</tt><tt class="descname">resolve</tt><big>(</big><em>value</em><big>)</big><a class="headerlink" href="#fdb.future.resolve" title="Permalink to this definition">∞</a></dt>
<dd><p>Creates a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> that is <tt class="docutils literal"><span class="pre">fulfilled</span></tt> with <tt class="docutils literal"><span class="pre">value</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.future.reject">
<tt class="descclassname">fdb.future.</tt><tt class="descname">reject</tt><big>(</big><em>reason</em><big>)</big><a class="headerlink" href="#fdb.future.reject" title="Permalink to this definition">∞</a></dt>
<dd><p>Creates a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> that is <tt class="docutils literal"><span class="pre">rejected</span></tt> with <tt class="docutils literal"><span class="pre">reason</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.future.all">
<tt class="descclassname">fdb.future.</tt><tt class="descname">all</tt><big>(</big><em>futureArray</em><big>)</big><a class="headerlink" href="#fdb.future.all" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> that is <tt class="docutils literal"><span class="pre">fulfilled</span></tt> if and when all futures in <tt class="docutils literal"><span class="pre">futureArray</span></tt> are <tt class="docutils literal"><span class="pre">fulfilled</span></tt>, or is <tt class="docutils literal"><span class="pre">rejected</span></tt> if and when any future in <tt class="docutils literal"><span class="pre">futureArray</span></tt> is <tt class="docutils literal"><span class="pre">rejected</span></tt>. If <tt class="docutils literal"><span class="pre">fulfilled</span></tt>, its value will be an array containing the values that <tt class="docutils literal"><span class="pre">fulfilled</span></tt> each of the futures in <tt class="docutils literal"><span class="pre">futureArray</span></tt>, in the same order. If <tt class="docutils literal"><span class="pre">rejected</span></tt>, the reason will be the same as the first future that was <tt class="docutils literal"><span class="pre">rejected</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.future.race">
<tt class="descclassname">fdb.future.</tt><tt class="descname">race</tt><big>(</big><em>futureArray</em><big>)</big><a class="headerlink" href="#fdb.future.race" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> that is <tt class="docutils literal"><span class="pre">fulfilled</span></tt> if and when any future in <tt class="docutils literal"><span class="pre">futureArray</span></tt> is <tt class="docutils literal"><span class="pre">fulfilled</span></tt>, or is <tt class="docutils literal"><span class="pre">rejected</span></tt> if and when any future in <tt class="docutils literal"><span class="pre">futureArray</span></tt> is <tt class="docutils literal"><span class="pre">rejected</span></tt>. It&#8217;s <tt class="docutils literal"><span class="pre">fullfilled</span></tt> value or <tt class="docutils literal"><span class="pre">rejected</span></tt> reason will be the same as the first future that was <tt class="docutils literal"><span class="pre">fulfilled</span></tt> or <tt class="docutils literal"><span class="pre">rejected</span></tt>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="lazy-iterators">
<h2>Lazy iterators<a class="headerlink" href="#lazy-iterators" title="Permalink to this headline">∞</a></h2>
<dl class="class">
<dt id="LazyIterator">
<em class="property">class </em><tt class="descname">LazyIterator</tt><big>(</big><big>)</big><a class="headerlink" href="#LazyIterator" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p><a class="reference internal" href="#Transaction.getRange" title="Transaction.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRange()</span></tt></a> and similar interfaces all return <tt class="docutils literal"><span class="pre">LazyIterator</span></tt> objects. A <tt class="docutils literal"><span class="pre">LazyIterator</span></tt> efficiently manages fetching the results of a query in batches as you iterate so that you can avoid receiving more data than you need (see <a class="reference internal" href="#fdb.streamingMode" title="fdb.streamingMode"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode</span></tt></a> for more information). The interface of a <tt class="docutils literal"><span class="pre">LazyIterator</span></tt> consists of functions that follow a common pattern.</p>
<p>Except for <a class="reference internal" href="#LazyIterator.next" title="LazyIterator.next"><tt class="xref js js-func docutils literal"><span class="pre">LazyIterator.next()</span></tt></a>, the <tt class="docutils literal"><span class="pre">LazyIterator</span></tt> functions always start iteration from the beginning of the results, even if the iterator has been used before or is being used concurrently.</p>
<dl class="function">
<dt id="LazyIterator.forEach">
<tt class="descclassname">LazyIterator.</tt><tt class="descname">forEach</tt><big>(</big><em>func</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#LazyIterator.forEach" title="Permalink to this definition">∞</a></dt>
<dd><p>Iterates over the requested results by calling <tt class="docutils literal"><span class="pre">func</span></tt> for each item being iterated over.</p>
<p><tt class="docutils literal"><span class="pre">func</span></tt> will be passed the next item in the iteration as its first argument and a <a class="reference internal" href="#callbacks"><em>callback</em></a> as its second. <tt class="docutils literal"><span class="pre">func</span></tt> must call its callback upon completion. If its callback is called with any error or defined result, then iteration will terminate immediately.</p>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called when either all results have been exhausted or <tt class="docutils literal"><span class="pre">func</span></tt> terminates prematurely. It will be called with the result returned through <tt class="docutils literal"><span class="pre">func</span></tt>&#8216;s callback, if any. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the <tt class="docutils literal"><span class="pre">callback</span></tt> passed to <tt class="xref js js-func docutils literal"><span class="pre">forEach()</span></tt> and the callback passed to <tt class="docutils literal"><span class="pre">func</span></tt> are distinct.</p>
</div>
<p>For example, the following will print the first 10 keys and values in the range [&#8216;apple&#8217;, &#8216;cherry&#8217;):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">numKeys</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">itr</span> <span class="o">=</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;cherry&#39;</span><span class="p">);</span>
<span class="nx">itr</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">kv</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">kv</span><span class="p">.</span><span class="nx">key</span><span class="p">,</span> <span class="nx">kv</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>

    <span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="nx">numKeys</span> <span class="o">===</span> <span class="mi">10</span><span class="p">)</span>
        <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="nx">cb</span><span class="p">();</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Finished forEach&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="LazyIterator.forEachBatch">
<tt class="descclassname">LazyIterator.</tt><tt class="descname">forEachBatch</tt><big>(</big><em>func</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#LazyIterator.forEachBatch" title="Permalink to this definition">∞</a></dt>
<dd><p>Iterates over the requested range by calling <tt class="docutils literal"><span class="pre">func</span></tt> for each batch of items fetched from the database. The size of batches is determined by which <a class="reference internal" href="#fdb.streamingMode" title="fdb.streamingMode"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode</span></tt></a> is used.</p>
<p><tt class="docutils literal"><span class="pre">func</span></tt> will be passed an array of items containing the current batch of results as its first argument and a <a class="reference internal" href="#callbacks"><em>callback</em></a> as its second. <tt class="docutils literal"><span class="pre">func</span></tt> must call its callback upon completion. If its callback is called with any error or defined result, then iteration will terminate immediately.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called when either all results have been exhausted or <tt class="docutils literal"><span class="pre">func</span></tt> terminates prematurely. It will be called with the result returned through <tt class="docutils literal"><span class="pre">func</span></tt>&#8216;s callback, if any. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that the <tt class="docutils literal"><span class="pre">callback</span></tt> passed to <tt class="xref js js-func docutils literal"><span class="pre">forEachBatch()</span></tt> and the callback passed to <tt class="docutils literal"><span class="pre">func</span></tt> are distinct.</p>
</div>
<p>For example, the following will print the first 10 keys and values in the range [&#8216;apple&#8217;, &#8216;cherry&#8217;):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">numKeys</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">itr</span> <span class="o">=</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;cherry&#39;</span><span class="p">);</span>
<span class="nx">itr</span><span class="p">.</span><span class="nx">forEachBatch</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">key</span><span class="p">,</span> <span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">value</span><span class="p">);</span>
        <span class="k">if</span><span class="p">(</span><span class="o">++</span><span class="nx">numKeys</span> <span class="o">===</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">cb</span><span class="p">(</span><span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nx">cb</span><span class="p">();</span>
<span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Finished forEachBatch&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">,</span> <span class="nx">res</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="LazyIterator.toArray">
<tt class="descclassname">LazyIterator.</tt><tt class="descname">toArray</tt><big>(</big><span class="optional">[</span><em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#LazyIterator.toArray" title="Permalink to this definition">∞</a></dt>
<dd><p>Converts the requested results to an array. Unless you intend to use the entire result, it may be more efficient to use one of <a class="reference internal" href="#LazyIterator.forEachBatch" title="LazyIterator.forEachBatch"><tt class="xref js js-func docutils literal"><span class="pre">LazyIterator.forEachBatch()</span></tt></a> or <a class="reference internal" href="#LazyIterator.forEach" title="LazyIterator.forEach"><tt class="xref js js-func docutils literal"><span class="pre">LazyIterator.forEach()</span></tt></a>.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with an array containing all items in the iteration. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
<p>For example, the following will print all keys and values in the range [&#8216;apple&#8217;, &#8216;cherry&#8217;):</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">tr</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="s1">&#39;apple&#39;</span><span class="p">,</span> <span class="s1">&#39;cherry&#39;</span><span class="p">).</span><span class="nx">toArray</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">kvArr</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">&#39;Error:&#39;</span><span class="p">,</span> <span class="nx">err</span><span class="p">);</span>
    <span class="k">else</span>
        <span class="k">for</span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="o">++</span><span class="nx">i</span><span class="p">)</span>
            <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">kvArr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">key</span><span class="p">,</span> <span class="nx">kvArr</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">value</span><span class="p">);</span>
<span class="p">};</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="LazyIterator.next">
<tt class="descclassname">LazyIterator.</tt><tt class="descname">next</tt><big>(</big><span class="optional">[</span><em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#LazyIterator.next" title="Permalink to this definition">∞</a></dt>
<dd><p>Gets the next item in the iteration. It is generally easier to use one of <a class="reference internal" href="#LazyIterator.forEachBatch" title="LazyIterator.forEachBatch"><tt class="xref js js-func docutils literal"><span class="pre">LazyIterator.forEachBatch()</span></tt></a>, <a class="reference internal" href="#LazyIterator.forEach" title="LazyIterator.forEach"><tt class="xref js js-func docutils literal"><span class="pre">LazyIterator.forEach()</span></tt></a>, or <a class="reference internal" href="#LazyIterator.toArray" title="LazyIterator.toArray"><tt class="xref js js-func docutils literal"><span class="pre">LazyIterator.toArray()</span></tt></a>.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the next item in the results. If there are no more results, then <tt class="docutils literal"><span class="pre">null</span></tt> is returned. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

</div>
<div class="section" id="streaming-modes">
<h2>Streaming modes<a class="headerlink" href="#streaming-modes" title="Permalink to this headline">∞</a></h2>
<dl class="attribute">
<dt id="fdb.streamingMode">
<tt class="descclassname">fdb.</tt><tt class="descname">streamingMode</tt><a class="headerlink" href="#fdb.streamingMode" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p>When using <a class="reference internal" href="#Transaction.getRange" title="Transaction.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRange()</span></tt></a> and similar interfaces, API clients can request large ranges of the database to iterate over.  Making such a request doesn&#8217;t necessarily mean that the client will consume all of the data in the range - sometimes the client doesn&#8217;t know how far it intends to iterate in advance.  FoundationDB tries to balance latency and bandwidth by requesting data for iteration in batches.</p>
<p>Streaming modes permit the API client to customize this performance tradeoff by providing extra information about how the iterator will be used.</p>
<p>The following streaming modes are available:</p>
<dl class="attribute">
<dt id="fdb.streamingMode.iterator">
<tt class="descclassname">fdb.streamingMode.</tt><tt class="descname">iterator</tt><a class="headerlink" href="#fdb.streamingMode.iterator" title="Permalink to this definition">∞</a></dt>
<dd><p><em>The default.</em>  The client doesn&#8217;t know how much of the range it is likely to use and wants different performance concerns to be balanced.</p>
<p>Only a small portion of data is transferred to the client initially (in order to minimize costs if the client doesn&#8217;t read the entire range), and as the caller iterates over more items in the range larger batches will be transferred in order to maximize throughput.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.streamingMode.want_all">
<tt class="descclassname">fdb.streamingMode.</tt><tt class="descname">want_all</tt><a class="headerlink" href="#fdb.streamingMode.want_all" title="Permalink to this definition">∞</a></dt>
<dd><p>The client intends to consume the entire range and would like it all transferred as early as possible.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.streamingMode.small">
<tt class="descclassname">fdb.streamingMode.</tt><tt class="descname">small</tt><a class="headerlink" href="#fdb.streamingMode.small" title="Permalink to this definition">∞</a></dt>
<dd><p><em>Infrequently used</em>. Transfer data in batches small enough to not be much more expensive than reading individual rows, to minimize cost if iteration stops early.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.streamingMode.medium">
<tt class="descclassname">fdb.streamingMode.</tt><tt class="descname">medium</tt><a class="headerlink" href="#fdb.streamingMode.medium" title="Permalink to this definition">∞</a></dt>
<dd><p><em>Infrequently used</em>. Transfer data in batches sized in between small and large.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.streamingMode.large">
<tt class="descclassname">fdb.streamingMode.</tt><tt class="descname">large</tt><a class="headerlink" href="#fdb.streamingMode.large" title="Permalink to this definition">∞</a></dt>
<dd><p><em>Infrequently used</em>. Transfer data in batches large enough to be, in a high-concurrency environment, nearly as efficient as possible.  If the client stops iteration early, some disk and network bandwidth may be wasted.  The batch size may still be too small to allow a single client to get high throughput from the database, so if that is what you need consider <a class="reference internal" href="#fdb.streamingMode.serial" title="fdb.streamingMode.serial"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode.serial</span></tt></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.streamingMode.serial">
<tt class="descclassname">fdb.streamingMode.</tt><tt class="descname">serial</tt><a class="headerlink" href="#fdb.streamingMode.serial" title="Permalink to this definition">∞</a></dt>
<dd><p>Transfer data in batches large enough that an individual client can get reasonable read bandwidth from the database.  If the client stops iteration early, considerable disk and network bandwidth may be wasted.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.streamingMode.exact">
<tt class="descclassname">fdb.streamingMode.</tt><tt class="descname">exact</tt><a class="headerlink" href="#fdb.streamingMode.exact" title="Permalink to this definition">∞</a></dt>
<dd><p><em>Infrequently used</em>. The client has passed a specific row limit and wants that many rows delivered in a single batch.  This is not particularly useful in Node.js because iterator functionality makes batches of data transparent, so use <a class="reference internal" href="#fdb.streamingMode.want_all" title="fdb.streamingMode.want_all"><tt class="xref js js-attr docutils literal"><span class="pre">fdb.streamingMode.want_all</span></tt></a> instead.</p>
</dd></dl>

</div>
<div class="section" id="errors">
<h2>Errors<a class="headerlink" href="#errors" title="Permalink to this headline">∞</a></h2>
<p>Errors in the FoundationDB API are raised as exceptions of type <a class="reference internal" href="#fdb.FDBError" title="fdb.FDBError"><tt class="xref js js-class docutils literal"><span class="pre">FDBError()</span></tt></a>. These errors may be displayed for diagnostic purposes, but generally should be passed to <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.onError()</span></tt></a>. When using <a class="reference internal" href="#Database.doTransaction" title="Database.doTransaction"><tt class="xref js js-func docutils literal"><span class="pre">Database.doTransaction()</span></tt></a> or <a class="reference internal" href="#fdb.transactional" title="fdb.transactional"><tt class="xref js js-func docutils literal"><span class="pre">fdb.transactional()</span></tt></a>, appropriate errors will be retried automatically.</p>
<dl class="class">
<dt id="fdb.FDBError">
<em class="property">class </em><tt class="descclassname">fdb.</tt><tt class="descname">FDBError</tt><big>(</big><big>)</big><a class="headerlink" href="#fdb.FDBError" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<dl class="attribute">
<dt id="fdb.FDBError.code">
<tt class="descclassname">fdb.FDBError.</tt><tt class="descname">code</tt><a class="headerlink" href="#fdb.FDBError.code" title="Permalink to this definition">∞</a></dt>
<dd><p>An integer associated with the error type.</p>
</dd></dl>

<dl class="attribute">
<dt id="fdb.FDBError.message">
<tt class="descclassname">fdb.FDBError.</tt><tt class="descname">message</tt><a class="headerlink" href="#fdb.FDBError.message" title="Permalink to this definition">∞</a></dt>
<dd><p>A somewhat human-readable description of the error.</p>
</dd></dl>

<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">You should use only <a class="reference internal" href="#fdb.FDBError.code" title="fdb.FDBError.code"><tt class="xref js js-attr docutils literal"><span class="pre">FDBError.code</span></tt></a> for programmatic comparisons, as the message of the error may change at any time. Whenever possible, use the <a class="reference internal" href="#Transaction.onError" title="Transaction.onError"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.onError()</span></tt></a> method to handle <a class="reference internal" href="#fdb.FDBError" title="fdb.FDBError"><tt class="xref js js-class docutils literal"><span class="pre">FDBError()</span></tt></a> exceptions.</p>
</div>
</div>
<div class="section" id="tuple-layer">
<span id="api-node-tuple-layer"></span><h2>Tuple layer<a class="headerlink" href="#tuple-layer" title="Permalink to this headline">∞</a></h2>
<dl class="attribute">
<dt id="fdb.tuple">
<tt class="descclassname">fdb.</tt><tt class="descname">tuple</tt><a class="headerlink" href="#fdb.tuple" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p>The FoundationDB API comes with a built-in layer for encoding tuples into keys usable by FoundationDB. The encoded key maintains the same sort order as the original tuple: sorted first by the first element, then by the second element, etc. This makes the tuple layer ideal for building a variety of higher-level data models.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For general guidance on tuple usage, see the discussion in the document on <a class="reference internal" href="data-modeling.html#data-modeling-tuples"><em>Data Modeling</em></a>.</p>
</div>
<p id="tupledatatypes">In the FoundationDB Node.js API, a tuple is a JavaScript array that contains elements of the following data types:</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="67%" />
<col width="14%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Type</th>
<th class="head">Legal Values</th>
<th class="head">Canonical Value</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Null value</td>
<td><tt class="docutils literal"><span class="pre">null</span></tt></td>
<td><tt class="docutils literal"><span class="pre">null</span></tt></td>
</tr>
<tr class="row-odd"><td>Byte string</td>
<td>Any value of type <tt class="docutils literal"><span class="pre">Buffer</span></tt>, <tt class="docutils literal"><span class="pre">ArrayBuffer</span></tt>, or <tt class="docutils literal"><span class="pre">Uint8Array</span></tt></td>
<td><tt class="docutils literal"><span class="pre">Buffer</span></tt></td>
</tr>
<tr class="row-even"><td>Unicode string</td>
<td>Any value of type <tt class="docutils literal"><span class="pre">String</span></tt></td>
<td><tt class="docutils literal"><span class="pre">String</span></tt></td>
</tr>
<tr class="row-odd"><td>54-bit signed integer</td>
<td><tt class="docutils literal"><span class="pre">Number</span></tt> in the range [-2<sup>53</sup>, 2<sup>53</sup>) that has no fractional part</td>
<td><tt class="docutils literal"><span class="pre">Number</span></tt></td>
</tr>
</tbody>
</table>
<p>If <tt class="docutils literal"><span class="pre">T</span></tt> is a JavaScript array meeting these criteria, then conceptually:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">T</span> <span class="o">==</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">tuple</span><span class="p">.</span><span class="nx">unpack</span><span class="p">(</span><span class="nx">fdb</span><span class="p">.</span><span class="nx">tuple</span><span class="p">.</span><span class="nx">pack</span><span class="p">(</span><span class="nx">T</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Unpacking a tuple always returns an array of elements in a canonical representation, so packing and then unpacking a tuple may result in an equivalent but not identical representation.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In general, FoundationDB tuples can contain 64-bit integers. Node.js, however, lacks an appropriate data type to handle integers larger than 54 bits. If you intend to use the Node.js bindings with other language bindings, keep in mind that attempting to decode a tuple with signed integers larger than 54 bits will result in an error being thrown.</p>
</div>
<dl class="function">
<dt id="fdb.tuple.pack">
<tt class="descclassname">fdb.tuple.</tt><tt class="descname">pack</tt><big>(</big><em>tuple</em><big>)</big><a class="headerlink" href="#fdb.tuple.pack" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a key (Buffer) encoding the specified array <tt class="docutils literal"><span class="pre">tuple</span></tt></p>
<p><strong>Throws</strong> an error if <tt class="docutils literal"><span class="pre">tuple</span></tt> contains any elements that are not one of the <a class="reference internal" href="#tupledatatypes"><em>encodable data types</em></a>.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.tuple.unpack">
<tt class="descclassname">fdb.tuple.</tt><tt class="descname">unpack</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#fdb.tuple.unpack" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the tuple encoded by the given key as an array</p>
<div class="line-block">
<div class="line"><strong>Throws</strong> an error if the unpacked tuple contains any integers outside the range of a 54-bit signed integer.</div>
<div class="line"><strong>Throws</strong> an error if the encoded tuple contains unknown data types.</div>
</div>
</dd></dl>

<dl class="function">
<dt id="fdb.tuple.range">
<tt class="descclassname">fdb.tuple.</tt><tt class="descname">range</tt><big>(</big><em>tuple</em><big>)</big><a class="headerlink" href="#fdb.tuple.range" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the range containing all keys that encode tuples strictly starting with the array <tt class="docutils literal"><span class="pre">tuple</span></tt> (that is, all tuples of greater length than <tt class="docutils literal"><span class="pre">tuple</span></tt> of which <tt class="docutils literal"><span class="pre">tuple</span></tt> is a prefix).</p>
<p>The range will be an object of the form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="c1">// A Buffer containing the beginning of the range, inclusive</span>
    <span class="nx">end</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>    <span class="c1">// A Buffer containing the end of the range, exclusive</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This range can be used to call <a class="reference internal" href="#Transaction.getRange" title="Transaction.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRange()</span></tt></a>.  For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">tuple</span><span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
<span class="kd">var</span> <span class="nx">itr</span> <span class="o">=</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">end</span><span class="p">);</span>
</pre></div>
</div>
<p>returns a <a class="reference internal" href="#LazyIterator" title="LazyIterator"><tt class="xref js js-class docutils literal"><span class="pre">LazyIterator()</span></tt></a> over all <a class="reference internal" href="#keyvaluepairs"><em>key-value pairs</em></a> in the database whose keys would unpack to tuples like (&#8216;A&#8217;, 2, x), (&#8216;A&#8217;, 2, x, y), etc.</p>
<p><strong>Throws</strong> an error if <tt class="docutils literal"><span class="pre">tuple</span></tt> contains any elements that are not one of the <a class="reference internal" href="#tupledatatypes"><em>encodable data types</em></a>.</p>
</dd></dl>

</div>
<div class="section" id="subspaces">
<span id="api-node-subspaces"></span><h2>Subspaces<a class="headerlink" href="#subspaces" title="Permalink to this headline">∞</a></h2>
<p>Subspaces provide a convenient way to use the <a class="reference internal" href="#api-node-tuple-layer"><em>tuple layer</em></a> to define namespaces for different categories of data. The namespace is specified by a prefix tuple which is prepended to all tuples packed by the subspace. When unpacking a key with the subspace, the prefix tuple will be removed from the result.</p>
<p>As a best practice, API clients should use at least one subspace for application data.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For general guidance on subspace usage, see the discussion in the <a class="reference internal" href="developer-guide.html#developer-guide-sub-keyspaces"><em>Developer Guide</em></a>.</p>
</div>
<dl class="class">
<dt id="fdb.Subspace">
<em class="property">class </em><tt class="descclassname">fdb.</tt><tt class="descname">Subspace</tt><big>(</big><span class="optional">[</span><em>prefixArray=</em><span class="optional">[</span><span class="optional">]</span>, <em>rawPrefix=new Buffer(0)</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#fdb.Subspace" title="Permalink to this definition">∞</a></dt>
<dd><p>Creates a subspace with the specified prefix tuple. If the raw prefix byte string is specified, then it will be prepended to all packed keys. Likewise, the raw prefix will be removed from all unpacked keys.</p>
</dd></dl>

<dl class="function">
<dt id="Subspace.key">
<tt class="descclassname">Subspace.</tt><tt class="descname">key</tt><big>(</big><big>)</big><a class="headerlink" href="#Subspace.key" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the key encoding the prefix used for the subspace. This is equivalent to packing the empty tuple.</p>
</dd></dl>

<dl class="function">
<dt id="Subspace.pack">
<tt class="descclassname">Subspace.</tt><tt class="descname">pack</tt><big>(</big><em>arr</em><big>)</big><a class="headerlink" href="#Subspace.pack" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the key encoding the specified tuple in the subspace. For example, if you have a subspace with prefix tuple <tt class="docutils literal"><span class="pre">('users')</span></tt> and you use it to pack the tuple <tt class="docutils literal"><span class="pre">('Smith')</span></tt>, the result is the same as if you packed the tuple <tt class="docutils literal"><span class="pre">('users',</span> <span class="pre">'Smith')</span></tt> with the <a class="reference internal" href="#api-node-tuple-layer"><em>tuple layer</em></a>.</p>
</dd></dl>

<dl class="function">
<dt id="Subspace.unpack">
<tt class="descclassname">Subspace.</tt><tt class="descname">unpack</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#Subspace.unpack" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the tuple encoded by the given key, with the subspace&#8217;s prefix tuple and raw prefix removed.</p>
</dd></dl>

<dl class="function">
<dt id="Subspace.range">
<tt class="descclassname">Subspace.</tt><tt class="descname">range</tt><big>(</big><em>arr=</em><span class="optional">[</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#Subspace.range" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a range representing all keys in the subspace that encode tuples strictly starting with the specifed tuple.</p>
<p>The range will be an object of the form:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">range</span> <span class="o">=</span> <span class="p">{</span>
    <span class="nx">begin</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">),</span> <span class="c1">// A Buffer containing the beginning of the range, inclusive</span>
    <span class="nx">end</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Buffer</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>    <span class="c1">// A Buffer containing the end of the range, exclusive</span>
<span class="p">};</span>
</pre></div>
</div>
<p>This range can be used to call <a class="reference internal" href="#Transaction.getRange" title="Transaction.getRange"><tt class="xref js js-func docutils literal"><span class="pre">Transaction.getRange()</span></tt></a>.  For example:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">subspace</span><span class="p">.</span><span class="nx">range</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
<span class="kd">var</span> <span class="nx">itr</span> <span class="o">=</span> <span class="nx">tr</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">begin</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">end</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="Subspace.contains">
<tt class="descclassname">Subspace.</tt><tt class="descname">contains</tt><big>(</big><em>key</em><big>)</big><a class="headerlink" href="#Subspace.contains" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns true if <tt class="docutils literal"><span class="pre">key</span></tt> starts with <a class="reference internal" href="#Subspace.key" title="Subspace.key"><tt class="xref js js-func docutils literal"><span class="pre">Subspace.key()</span></tt></a>, indicating that the subspace logically contains <tt class="docutils literal"><span class="pre">key</span></tt>.</p>
</dd></dl>

<dl class="function">
<dt id="Subspace.asFoundationDBKey">
<tt class="descclassname">Subspace.</tt><tt class="descname">asFoundationDBKey</tt><big>(</big><big>)</big><a class="headerlink" href="#Subspace.asFoundationDBKey" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the key encoding the prefix used for the subspace, like <a class="reference internal" href="#Subspace.key" title="Subspace.key"><tt class="xref js js-func docutils literal"><span class="pre">Subspace.key()</span></tt></a>. This method serves to support the <a class="reference internal" href="#api-node-keys"><em>asFoundationdbKey()</em></a> convenience interface.</p>
</dd></dl>

<dl class="function">
<dt id="Subspace.subspace">
<tt class="descclassname">Subspace.</tt><tt class="descname">subspace</tt><big>(</big><em>arr</em><big>)</big><a class="headerlink" href="#Subspace.subspace" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a new subspace which is equivalent to this subspace with its prefix tuple extended by the specified tuple.</p>
</dd></dl>

<dl class="function">
<dt id="Subspace.get">
<tt class="descclassname">Subspace.</tt><tt class="descname">get</tt><big>(</big><em>item</em><big>)</big><a class="headerlink" href="#Subspace.get" title="Permalink to this definition">∞</a></dt>
<dd><p>Shorthand for subspace.subspace([item]). This function can be combined with the <a class="reference internal" href="#Subspace.asFoundationDBKey" title="Subspace.asFoundationDBKey"><tt class="xref js js-func docutils literal"><span class="pre">Subspace.asFoundationDBKey()</span></tt></a> convenience to turn this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">Subspace</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">]);</span>
<span class="nx">tr</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">pack</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">]),</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="nx">tr</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">pack</span><span class="p">([</span><span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span><span class="p">]),</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
<p>into this:</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">fdb</span><span class="p">.</span><span class="nx">Subspace</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">]);</span>
<span class="nx">tr</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
<span class="nx">tr</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;foo&#39;</span><span class="p">).</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;bar&#39;</span><span class="p">),</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="directories">
<span id="api-node-directories"></span><h2>Directories<a class="headerlink" href="#directories" title="Permalink to this headline">∞</a></h2>
<p>The FoundationDB API provides <a class="reference internal" href="developer-guide.html#developer-guide-directories"><em>directories</em></a> as a tool for managing related <a class="reference internal" href="#api-node-subspaces"><em>subspaces</em></a>. Directories are a recommended approach for administering applications. Each application should create or open at least one directory to manage its subspaces.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">For general guidance on directory usage, see the discussion in the <a class="reference internal" href="developer-guide.html#developer-guide-directories"><em>Developer Guide</em></a>.</p>
</div>
<p>Directories are identified by hierarchical paths analogous to the paths in a Unix-like file system. A path is represented as an array of strings. Each directory has an associated subspace used to store its content. The directory layer maps each path to a short prefix used for the corresponding subspace. In effect, directories provide a level of indirection for access to subspaces.</p>
<p>Except where noted, directory methods interpret the provided path(s) relative to the path of the directory object. When opening a directory, a byte string <tt class="docutils literal"><span class="pre">layer</span></tt> option may be specified as a metadata identifier.</p>
<dl class="attribute">
<dt id="fdb.directory">
<tt class="descclassname">fdb.</tt><tt class="descname">directory</tt><a class="headerlink" href="#fdb.directory" title="Permalink to this definition">∞</a></dt>
<dd><p>The default instance of <tt class="xref js js-class docutils literal"><span class="pre">DirectoryLayer()</span></tt>.</p>
</dd></dl>

<dl class="class">
<dt id="fdb.DirectoryLayer">
<em class="property">class </em><tt class="descclassname">fdb.</tt><tt class="descname">DirectoryLayer</tt><big>(</big><em>nodeSubspace=new fdb.Subspace(</em>, <span class="optional">[</span><span class="optional">]</span><em>fdb.buffer.fromByteLiteral('\xFE'))</em>, <em>contentSubspace=new fdb.Subspace()</em>, <em>allowManualPrefixes=false</em><big>)</big><a class="headerlink" href="#fdb.DirectoryLayer" title="Permalink to this definition">∞</a></dt>
<dd><p>Each instance defines a new root directory. The subspaces <tt class="docutils literal"><span class="pre">nodeSubspace</span></tt> and <tt class="docutils literal"><span class="pre">contentSubspace</span></tt> control where the directory metadata and contents, respectively, are stored. The default root directory has a <tt class="docutils literal"><span class="pre">nodeSubspace</span></tt> with raw prefix <tt class="docutils literal"><span class="pre">\xFE</span></tt> and a <tt class="docutils literal"><span class="pre">contentSubspace</span></tt> with no prefix. Specifying more restrictive values for <tt class="docutils literal"><span class="pre">nodeSubspace</span></tt> and <tt class="docutils literal"><span class="pre">contentSubspace</span></tt> will allow using the directory layer alongside other content in a database. If <tt class="docutils literal"><span class="pre">allowManualPrefixes</span></tt> is false, attempts to create a directory with a manual prefix under the directory layer will respond with an error. The default root directory does not allow manual prefixes.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.createOrOpen">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">createOrOpen</tt><big>(</big><em>databaseOrTransaction</em>, <em>path</em><span class="optional">[</span>, <em>options</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.createOrOpen" title="Permalink to this definition">∞</a></dt>
<dd><p>Opens the directory with <tt class="docutils literal"><span class="pre">path</span></tt> specified as an array of strings. <tt class="docutils literal"><span class="pre">path</span></tt> can also be a string, in which case it will be automatically wrapped in an array. All string values in a path will be converted to unicode. If the directory does not exist, it is created (creating parent directories if necessary).</p>
<p>If the <a class="reference internal" href="#datatypes"><em>value</em></a> <tt class="docutils literal"><span class="pre">options.layer</span></tt> is specified and the directory is new, it is recorded as the layer for this directory; if <tt class="docutils literal"><span class="pre">layer</span></tt> is specified and the directory already exists, it is compared against the layer specified when the directory was created, and an error is raised if they differ.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the present release, multiple directories may not be concurrently created within a single transaction. This restriction will be removed in a future release.</p>
</div>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the existing or newly created <a class="reference internal" href="#api-node-directory-subspace"><em>DirectorySubspace</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.open">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">open</tt><big>(</big><em>databaseOrTransaction</em>, <em>path</em><span class="optional">[</span>, <em>options</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.open" title="Permalink to this definition">∞</a></dt>
<dd><p>Opens the directory with <tt class="docutils literal"><span class="pre">path</span></tt> specified as an array of strings. <tt class="docutils literal"><span class="pre">path</span></tt> can also be a string, in which case it will be automatically wrapped in an array. All string values in a path will be converted to unicode. The method will respond with an error if the directory does not exist.</p>
<p>If the <a class="reference internal" href="#datatypes"><em>value</em></a> <tt class="docutils literal"><span class="pre">options.layer</span></tt> is specified, it is compared against the layer specified when the directory was created, and an error is raised if they differ.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the opened <a class="reference internal" href="#api-node-directory-subspace"><em>DirectorySubspace</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.create">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">create</tt><big>(</big><em>databaseOrTransaction</em>, <em>path</em><span class="optional">[</span>, <em>options</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.create" title="Permalink to this definition">∞</a></dt>
<dd><p>Creates a directory with <tt class="docutils literal"><span class="pre">path</span></tt> specified as an array of strings. <tt class="docutils literal"><span class="pre">path</span></tt> can also be a string, in which case it will be automatically wrapped in an array. All string values in a path will be converted to unicode. Parent directories are created if necessary. The method will respond with an error if the given directory already exists.</p>
<p>If the <a class="reference internal" href="#datatypes"><em>key</em></a> <tt class="docutils literal"><span class="pre">options.prefix</span></tt> is specified, the directory is created with the given physical prefix; otherwise a prefix is allocated automatically.</p>
<p>If the <a class="reference internal" href="#datatypes"><em>value</em></a> <tt class="docutils literal"><span class="pre">options.layer</span></tt> is specified, it is recorded with the directory and will be checked by future calls to open.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">In the present release, multiple directories may not be concurrently created within a single transaction. This restriction will be removed in a future release.</p>
</div>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the newly created <a class="reference internal" href="#api-node-directory-subspace"><em>DirectorySubspace</em></a>. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.move">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">move</tt><big>(</big><em>tr</em>, <em>oldPath</em>, <em>newPath</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.move" title="Permalink to this definition">∞</a></dt>
<dd><p>Moves the directory at <tt class="docutils literal"><span class="pre">old_path</span></tt> to <tt class="docutils literal"><span class="pre">new_path</span></tt>. There is no effect on the physical prefix of the given directory or on clients that already have the directory open. The method will respond with an error if a directory does not exist at <tt class="docutils literal"><span class="pre">old_path</span></tt>, a directory already exists at <tt class="docutils literal"><span class="pre">new_path</span></tt>, or the parent directory of <tt class="docutils literal"><span class="pre">new_path</span></tt> does not exist.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the <a class="reference internal" href="#api-node-directory-subspace"><em>DirectorySubspace</em></a> at its new location. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.remove">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">remove</tt><big>(</big><em>tr</em><span class="optional">[</span>, <em>path</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.remove" title="Permalink to this definition">∞</a></dt>
<dd><p>Removes the directory at <tt class="docutils literal"><span class="pre">path</span></tt>, its contents, and all subdirectories. The method will respond with an error if the directory does not exist.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Clients that have already opened the directory might still insert data into its contents after removal.</p>
</div>
<p>This function is asynchronous. <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called when the directory is removed. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to wait for completion.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.removeIfExists">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">removeIfExists</tt><big>(</big><em>tr</em><span class="optional">[</span>, <em>path</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.removeIfExists" title="Permalink to this definition">∞</a></dt>
<dd><p>Checks if the directory at <tt class="docutils literal"><span class="pre">path</span></tt> exists and, if so, removes the directory, its contents, and all subdirectories. Returns <tt class="docutils literal"><span class="pre">true</span></tt> if the directory existed and <tt class="docutils literal"><span class="pre">false</span></tt> otherwise.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">Clients that have already opened the directory might still insert data into its contents after removal.</p>
</div>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with <tt class="docutils literal"><span class="pre">true</span></tt> if the directory existed prior to this call and <tt class="docutils literal"><span class="pre">false</span></tt> otherwise. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.list">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">list</tt><big>(</big><em>tr</em><span class="optional">[</span>, <em>path</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.list" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns an array of names of the immediate subdirectories of the directory at <tt class="docutils literal"><span class="pre">path</span></tt>. Each name is a unicode string representing the last component of a subdirectory&#8217;s path.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the array of subdirectory names. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.exists">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">exists</tt><big>(</big><em>tr</em><span class="optional">[</span>, <em>path</em>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectoryLayer.exists" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns <tt class="docutils literal"><span class="pre">true</span></tt> if the directory at <tt class="docutils literal"><span class="pre">path</span></tt> exists and <tt class="docutils literal"><span class="pre">false</span></tt> otherwise.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with <tt class="docutils literal"><span class="pre">true</span></tt> if the directory exists and <tt class="docutils literal"><span class="pre">false</span></tt> if not. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.getLayer">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">getLayer</tt><big>(</big><big>)</big><a class="headerlink" href="#DirectoryLayer.getLayer" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the layer specified when the directory was created.</p>
</dd></dl>

<dl class="function">
<dt id="DirectoryLayer.getPath">
<tt class="descclassname">DirectoryLayer.</tt><tt class="descname">getPath</tt><big>(</big><big>)</big><a class="headerlink" href="#DirectoryLayer.getPath" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns the path with which the directory was opened.</p>
</dd></dl>

<div class="section" id="directorysubspace">
<span id="api-node-directory-subspace"></span><h3>DirectorySubspace<a class="headerlink" href="#directorysubspace" title="Permalink to this headline">∞</a></h3>
<p>A directory subspace represents a specific directory and its contents. It stores the <tt class="docutils literal"><span class="pre">path</span></tt> with which it was opened and supports all <a class="reference internal" href="#fdb.DirectoryLayer" title="fdb.DirectoryLayer"><tt class="xref js js-class docutils literal"><span class="pre">DirectoryLayer</span></tt></a> methods for operating on itself and its subdirectories. It also implements all <a class="reference internal" href="#fdb.Subspace" title="fdb.Subspace"><tt class="xref js js-class docutils literal"><span class="pre">Subspace</span></tt></a> methods for working with the contents of that directory.</p>
<dl class="function">
<dt id="DirectorySubspace.moveTo">
<tt class="descclassname">DirectorySubspace.</tt><tt class="descname">moveTo</tt><big>(</big><em>databaseOrTransaction</em>, <em>newAbsoluteNameOrPath</em><span class="optional">[</span>, <em>callback</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#DirectorySubspace.moveTo" title="Permalink to this definition">∞</a></dt>
<dd><p>Moves this directory to <tt class="docutils literal"><span class="pre">new_path</span></tt>, interpreting <tt class="docutils literal"><span class="pre">new_path</span></tt> absolutely. There is no effect on the physical prefix of the given directory or on clients that already have the directory open. The method will respond with an error if a directory already exists at <tt class="docutils literal"><span class="pre">new_path</span></tt> or the parent directory of <tt class="docutils literal"><span class="pre">new_path</span></tt> does not exist.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with the <a class="reference internal" href="#api-node-directory-subspace"><em>DirectorySubspace</em></a> at its new location. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

</div>
</div>
<div class="section" id="locality-information">
<h2>Locality information<a class="headerlink" href="#locality-information" title="Permalink to this headline">∞</a></h2>
<dl class="attribute">
<dt id="fdb.locality">
<tt class="descclassname">fdb.</tt><tt class="descname">locality</tt><a class="headerlink" href="#fdb.locality" title="Permalink to this definition">∞</a></dt>
<dd></dd></dl>

<p>The FoundationDB API comes with a set of functions for discovering the storage locations of keys within your cluster. This information can be useful for advanced users who wish to take into account the location of keys in the design of applications or processes.</p>
<dl class="function">
<dt id="fdb.locality.getBoundaryKeys">
<tt class="descclassname">fdb.locality.</tt><tt class="descname">getBoundaryKeys</tt><big>(</big><em>databaseOrTransaction</em>, <em>begin</em>, <em>end</em>, <em>callback</em><big>)</big><a class="headerlink" href="#fdb.locality.getBoundaryKeys" title="Permalink to this definition">∞</a></dt>
<dd><p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with a <a class="reference internal" href="#LazyIterator" title="LazyIterator"><tt class="xref js js-class docutils literal"><span class="pre">LazyIterator()</span></tt></a> of <a class="reference internal" href="#datatypes"><em>keys</em></a> <tt class="docutils literal"><span class="pre">k</span></tt> such that <tt class="docutils literal"><span class="pre">begin</span> <span class="pre">&lt;=</span> <span class="pre">k</span> <span class="pre">&lt;</span> <span class="pre">end</span></tt> and <tt class="docutils literal"><span class="pre">k</span></tt> is located at the start of a contiguous range stored on a single server. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
<p>The first parameter to this function may be either a <a class="reference internal" href="#Database" title="Database"><tt class="xref js js-class docutils literal"><span class="pre">Database()</span></tt></a> or a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a>. If it is passed a <a class="reference internal" href="#Transaction" title="Transaction"><tt class="xref js js-class docutils literal"><span class="pre">Transaction()</span></tt></a>, the transaction will not be committed, reset, or modified in any way, nor will its transaction options (such as retry limit) be applied within the function. However, if the database is unavailable prior to the function call, any timeout set on the transaction will still trigger.</p>
<p>This method is not transactional. It will return an answer no older than the Transaction or Database object it is passed, but the returned boundaries are an estimate and may not represent the exact boundary locations at any database version.</p>
</dd></dl>

<dl class="function">
<dt id="fdb.locality.getAddressesForKey">
<tt class="descclassname">fdb.locality.</tt><tt class="descname">getAddressesForKey</tt><big>(</big><em>transaction</em>, <em>key</em>, <em>callback</em><big>)</big><a class="headerlink" href="#fdb.locality.getAddressesForKey" title="Permalink to this definition">∞</a></dt>
<dd><p>Returns a list of public network addresses as strings, one for each of the storage servers responsible for storing <tt class="docutils literal"><span class="pre">key</span></tt> and its associated value.</p>
<p>This function is asynchronous. When complete, <a class="reference internal" href="#callbacks"><em>callback</em></a> will be called with an array of network address strings. If the <a class="reference internal" href="#callbacks"><em>callback</em></a> argument is omitted, then the function will return a <a class="reference internal" href="#Future" title="Future"><tt class="xref js js-class docutils literal"><span class="pre">Future()</span></tt></a> object that can be used to access the result.</p>
</dd></dl>

</div>
</div>


  </div>
  <div id="search-documentation">
    <form action="search.html" method="get">
      <input type="text" name="q" class="search-query" placeholder="Search Documentation" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <div id="docs-page-nav">
      <h3>Navigate this page</h3>
      <ul><li><a class="reference internal" href="#">Node.js API</a><ul><li><a class="reference internal" href="#installation">Installation</a></li><li><a class="reference internal" href="#api-versioning">API versioning</a></li><li><a class="reference internal" href="#opening-a-database">Opening a database</a></li><li><a class="reference internal" href="#cluster-objects">Cluster objects</a></li><li><a class="reference internal" href="#keys-and-values">Keys and values</a><ul><li><a class="reference internal" href="#asfoundationdbkey-and-asfoundationdbvalue"><tt class="docutils literal"><span class="pre">asFoundationDBKey</span></tt> and <tt class="docutils literal"><span class="pre">asFoundationDBValue</span></tt></a></li></ul></li><li><a class="reference internal" href="#buffer-conversion">Buffer conversion</a></li><li><a class="reference internal" href="#key-value-pairs">Key-value pairs</a></li><li><a class="reference internal" href="#key-selectors">Key selectors</a></li><li><a class="reference internal" href="#database-objects">Database objects</a><ul><li><a class="reference internal" href="#database-options">Database options</a></li></ul></li><li><a class="reference internal" href="#transactional-decoration">Transactional decoration</a></li><li><a class="reference internal" href="#transaction-objects">Transaction objects</a><ul><li><a class="reference internal" href="#attributes">Attributes</a></li><li><a class="reference internal" href="#reading-data">Reading data</a></li><li><a class="reference internal" href="#snapshot-reads">Snapshot reads</a></li><li><a class="reference internal" href="#writing-data">Writing Data</a></li><li><a class="reference internal" href="#atomic-operations">Atomic operations</a></li><li><a class="reference internal" href="#committing">Committing</a></li><li><a class="reference internal" href="#watches">Watches</a></li><li><a class="reference internal" href="#conflict-ranges">Conflict ranges</a></li><li><a class="reference internal" href="#versions">Versions</a></li><li><a class="reference internal" href="#transaction-options">Transaction options</a></li></ul></li><li><a class="reference internal" href="#callbacks">Callbacks</a><ul><li><a class="reference internal" href="#streamline">Streamline</a></li><li><a class="reference internal" href="#futures">Futures</a><ul><li><a class="reference internal" href="#promises">Promises</a></li></ul></li><li><a class="reference internal" href="#promise-utilities">Promise utilities</a></li></ul></li><li><a class="reference internal" href="#lazy-iterators">Lazy iterators</a></li><li><a class="reference internal" href="#streaming-modes">Streaming modes</a></li><li><a class="reference internal" href="#errors">Errors</a></li><li><a class="reference internal" href="#tuple-layer">Tuple layer</a></li><li><a class="reference internal" href="#subspaces">Subspaces</a></li><li><a class="reference internal" href="#directories">Directories</a><ul><li><a class="reference internal" href="#directorysubspace">DirectorySubspace</a></li></ul></li><li><a class="reference internal" href="#locality-information">Locality information</a></li></ul></li></ul>
    </div>
    <div id="docs-global-nav">
      <h3>Navigate All Docs</h3>
    </div>
  </div>
</div>


</div>
<footer id='footer'>
<div class='container'>
<ul>
<li>
<h3>Get Help</h3>
<ul id='get-help-list'>
<li><a href="/web/20150325003226/https://foundationdb.com/contact">Contact Us</a></li>
</ul>
</li>
<li>
<h3>Social</h3>
<ul>
<li><a href="/web/20150325003226/https://twitter.com/foundationdb">Twitter</a></li>
</ul>
</li>
<li>
<h3>Legal</h3>
<ul>
<li><a href="/web/20150325003226/https://foundationdb.com/legal/privacy">Privacy Policy</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/legal/terms">Terms of Service</a></li>
<li><a href="/web/20150325003226/https://foundationdb.com/legal/trademark">Trademark Disclaimer</a></li>
</ul>
</li>
</ul>
</div>
<div id='copyright'>&copy; 2015 FoundationDB</div>
</footer>
<div class='modal' id='login-modal'>
<div class='cover'></div>
<div class='inner'>
<h2>FoundationDB Log In</h2>
<div class='content'>
<div id='explanation'></div>
<form>
<fieldset>
<div class='errors'></div>
<ul>
<li>
<label for="email">Email Address</label>
<input id='email' type='email' value=''>
</li>
<li>
<label for="password">Password</label>
<input id='password' type='password'>
</li>
<li class='actions'>
<button>
Log In
<span class='spinner'></span>
</button>
<a href="#signup">Need an account?</a>
<a href="#reset-password" id="login-reset-link">Need to reset your password?</a>
</li>
</ul>
</fieldset>
</form>
</div>
<a class='close' href='#close'>
<i class='icon-cancel'></i>
</a>
</div>
</div>
<div class='modal' id='reset-password-modal'>
<div class='cover'></div>
<div class='inner'>
<h2>Reset Your Password</h2>
<div class='content'>
<form>
<p class='note'>Enter your email address below and we'll send you password reset instructions.</p>
<fieldset>
<div class='errors'></div>
<ul>
<li>
<label for="email">Email Address</label>
<input autocapitalize="false" id="email" name="email" type="email" value="" />
</li>
<li class='actions'>
<button>
Send Instructions
<span class='spinner'></span>
</button>
<a href="#cancel">Cancel</a>
</li>
</ul>
</fieldset>
</form>
<div id='done'>
<p>Please check your email. Your password reset instructions have been emailed to you.</p>
</div>
</div>
<a class='close' href='#close'>
<i class='icon-cancel'></i>
</a>
</div>
</div>
<div class='modal' id='video-modal'>
<div class='cover'></div>
<div class='inner'>
<iframe></iframe>
<a class='close' href='#close'>
<i class='icon-cancel'></i>
</a>
</div>
</div>

<script src="/web/20150325003226js_/https://d3glfbbr3jeumb.cloudfront.net/assets/application-a7f51eff68dda15563d95dd6b13ee7ae.js" type="text/javascript"></script>
<!--[if lt IE 9]>
<script src="//html5shiv.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
<![endif]-->

</body>
</html>





<!--
     FILE ARCHIVED ON 0:32:26 Mar 25, 2015 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 15:14:45 Oct 16, 2016.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
